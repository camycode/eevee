module("plugins.enterkey"),test("br做回车,选区非闭合",function(){te.dom[0].parentNode.removeChild(te.dom[0]);var t=document.body.appendChild(document.createElement("div"));$(t).css("width","500px").css("height","500px").css("border","1px solid #ccc"),te.dom.push(t),baidu.editor.plugins.table=function(){};var e=new baidu.editor.Editor({initialContent:"<p>欢迎使用ueditor</p>",autoFloatEnabled:!1,enterTag:"br"});te.obj.push(e),e.render(t),stop(),e.ready(function(){var t=new baidu.editor.dom.Range(e.document);te.obj.push(t),e.setContent("<p>hello</p>"),te.obj[4].setStart(e.body.firstChild.firstChild,1).setEnd(e.body.firstChild.firstChild,3).select(),ua.keydown(e.body,{keyCode:13}),setTimeout(function(){ua.manualDeleteFillData(te.obj[3].body);var t="h<br>lo";equal(ua.getChildHTML(te.obj[3].body.firstChild),t,"<br>做回车"),e.setContent('<h1>hello<br></h1><p><img src="http://img.baidu.com/hi/jx2/j_0015.gif" /><a href="http://www.baidu.com"></a></p>'),te.obj[4].setStart(e.body.lastChild,0).setEnd(e.body.lastChild,1).select(),ua.keydown(e.body,{keyCode:13}),setTimeout(function(){ua.manualDeleteFillData(te.obj[3].body);var t="hello<br>";equal(ua.getChildHTML(te.obj[3].body.firstChild),t,"<br>做回车"),e.setContent('<h1>hello<br></h1><p>he<img src="http://img.baidu.com/hi/jx2/j_0015.gif" />oll</p>'),te.obj[4].setStart(e.body.lastChild,1).setEnd(e.body.lastChild,2).select(),ua.keydown(e.body,{keyCode:13}),setTimeout(function(){ua.manualDeleteFillData(te.obj[3].body);var t="hello<br>";equal(ua.getChildHTML(te.obj[3].body.firstChild),t,"<br>做回车"),e.setContent('<h1>hello<br></h1><p><img src="http://img.baidu.com/hi/jx2/j_0015.gif" /><br></p>'),te.obj[4].setStart(e.body.lastChild,0).setEnd(e.body.lastChild,1).select(),ua.keydown(e.body,{keyCode:13}),setTimeout(function(){ua.manualDeleteFillData(te.obj[3].body);var t="hello<br>";equal(ua.getChildHTML(te.obj[3].body.firstChild),t,"<br>做回车"),e.setContent('<h1>hello<br></h1><p><img src="http://img.baidu.com/hi/jx2/j_0015.gif" /><a href="http://www.baidu.com">www.baidu.com</a></p>'),te.obj[4].setStart(e.body.lastChild,0).setEnd(e.body.lastChild,1).select(),ua.keydown(e.body,{keyCode:13}),setTimeout(function(){ua.manualDeleteFillData(te.obj[3].body);var t="hello<br>";equal(ua.getChildHTML(te.obj[3].body.firstChild),t,"<br>做回车"),te.dom[1].parentNode.removeChild(te.dom[1]),start()},20)},20)},20)},20)},20)})}),test("br做回车，选区闭合",function(){te.dom[0].parentNode.removeChild(te.dom[0]);var t=document.body.appendChild(document.createElement("div"));$(t).css("width","500px").css("height","500px").css("border","1px solid #ccc"),te.dom.push(t),baidu.editor.plugins.table=function(){};var e=new baidu.editor.Editor({initialContent:"<p>欢迎使用ueditor</p>",autoFloatEnabled:!1,enterTag:"br"});te.obj.push(e),e.render(t),stop(),e.ready(function(){var t=new baidu.editor.dom.Range(e.document);te.obj.push(t),e.setContent("<p>hello</p>"),setTimeout(function(){te.obj[4].setStart(e.body.firstChild.firstChild,1).collapse(!0).select(),ua.keydown(e.body,{keyCode:13}),setTimeout(function(){ua.manualDeleteFillData(te.obj[3].body);var t="h<br>ello";equal(ua.getChildHTML(te.obj[3].body.firstChild),t,"<br>做回车，选区闭合"),te.dom[1].parentNode.removeChild(te.dom[1]),start()},50)},50)})}),test("br做回车，选区闭合,在节点尾部输入回车，要插入2个br",function(){te.dom[0].parentNode.removeChild(te.dom[0]);var t=document.body.appendChild(document.createElement("div"));$(t).css("width","500px").css("height","500px").css("border","1px solid #ccc"),te.dom.push(t),baidu.editor.plugins.table=function(){};var e=new baidu.editor.Editor({initialContent:"<p>欢迎使用ueditor</p>",autoFloatEnabled:!1,enterTag:"br"});te.obj.push(e),e.render(t),stop(),e.ready(function(){var t=new baidu.editor.dom.Range(e.document);te.obj.push(t),e.setContent("<p>hello</p>"),setTimeout(function(){te.obj[4].setStart(e.body.firstChild.firstChild,5).collapse(!0).select(),ua.keydown(e.body,{keyCode:13}),setTimeout(function(){ua.manualDeleteFillData(te.obj[3].body);var t="hello<br><br>";equal(ua.getChildHTML(te.obj[3].body.firstChild),t,"<br>做回车，选区闭合,在节点尾部输入回车"),te.dom[1].parentNode.removeChild(te.dom[1]),start()},50)},50)})}),test("table首行中回车",function(){var t=te.obj[0];if(!ua.browser.ie){var e=new baidu.editor.dom.Range(t.document);t.setContent(' <table width="100%" border="1" bordercolor="#000000"><tbody><tr><td ><br /></td></tr></tbody></table>'),e.selectNode(t.body.firstChild.firstChild.firstChild.firstChild).select(),ua.keydown(t.body,{keyCode:13}),stop(),setTimeout(function(){equal(ua.getChildHTML(te.obj[0].body.firstChild),"<br>","加入p"),start()},20)}}),test("去除_moz_dirty",function(){if(browser.gecko){var t=te.obj[0],e=te.obj[1];t.setContent('<strong>迎使</strong><em  _moz_dirty=""><strong  _moz_dirty="">用ued</strong>it</em>'),e.selectNode(t.body.firstChild.lastChild.firstChild).select(),ua.keydown(t.body,{keyCode:13}),setTimeout(function(){equal(ua.getChildHTML(t.body),"<p><strong>迎使</strong><em><strong>用ued</strong>it</em></p>",""),start()},20),stop()}}),test("chrome删除div",function(){var t=te.obj[0],e=te.obj[1],o=t.body;if(ua.browser.webkit){t.body.innerHTML="<h1>一级标题</h1><div><br/></div>",e.setStart(o.firstChild.firstChild,4).collapse(1).select(),ua.keydown(t.body,{keyCode:13}),e.selectNode(o.lastChild.firstChild).select();t.undoManger.index,ua.browser.ie?"":"<br>";ua.keyup(t.body,{keyCode:13}),equal(t.undoManger.list.length,2,"保存现场"),setTimeout(function(){equal(o.childNodes.length,2,"2个子节点"),equal(o.lastChild.tagName.toLowerCase(),"p","div转成p"),equal(ua.getChildHTML(o),"<h1>一级标题</h1><p><br></p>","检查内容"),start()},60),stop()}}),test("formatBlock",function(){if(!ua.browser.ie){var t=te.obj[0],e=te.obj[1];t.setContent("<table><tbody><tr><td>  hello1</td><td ></td></tr><tr><td >hello2</td><td ></td></tr></tbody></table>"),setTimeout(function(){var o=t.body.getElementsByTagName("td");e.setStart(o[0],1).collapse(!0).select(),ua.keydown(t.body,{keyCode:13}),setTimeout(function(){ua.keyup(t.body,{keyCode:13}),setTimeout(function(){var e=t.body.getElementsByTagName("td")[0];equal(e.firstChild&&e.firstChild.tagName.toLowerCase(),"p","加上p"),equal(e.firstChild.innerHTML,"hello1","hello1"),start()},60)},60)},60),stop()}}),test("跨td不删",function(){var t=te.obj[0],e=te.obj[1];t.setContent("<table><tbody><tr><td>  hello1</td><td ></td></tr><tr><td >hello2</td><td ></td></tr></tbody></table>"),t.addListener("keydown",function(t,e){setTimeout(function(){ok(e.defaultPrevented||!e.returnValue,"keydown"),start()},60)}),setTimeout(function(){var o=t.body.getElementsByTagName("td");e.setStart(o[0],0).setEnd(o[2],1).select(),ua.keydown(t.body,{keyCode:13})},60),stop()});