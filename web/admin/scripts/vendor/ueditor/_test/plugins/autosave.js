module("plugins.autosave"),test("自动保存",function(){expect(8);var e=te.obj[0].container,t=null,n=0;UE.delEditor(te.obj[0]),e.parentNode.removeChild(e),e=document.createElement("div"),e.id="container",document.body.appendChild(e),t=UE.getEditor("container",{initialContent:"",saveInterval:0}),t.addListener("beforeautosave",function(e,t){t.content=t.content.toLowerCase(),equal(!0,!0,"成功触发beforeautosave事件"),equal("<p>http://www.baidu.com</p>"===t.content||"<p>disable</p>"===t.content,!0,"事件携带数据正确")}),t.addListener("beforeautosave",function(e,t){return t.content=t.content.toLowerCase(),"<p>disable</p>"===t.content?!1:void n++}),t.addListener("afterautosave",function(e,n){n.content=n.content.toLowerCase(),equal(n.content,"<p>http://www.baidu.com</p>","成功触发afterautosave事件"),equal(null!==t.execCommand("getlocaldata"),!0,"getlocaldata命令正常"),t.execCommand("clearlocaldata"),equal(""===t.execCommand("getlocaldata"),!0,"clearlocaldata命令正常")}),stop(),window.setTimeout(function(){t.setContent("<p>disable</p>"),window.setTimeout(function(){t.setContent("<p>http://www.baidu.com</p>"),window.setTimeout(function(){equal(n,1,"触发事件次数"),start()},500),UE.delEditor("container"),e.parentNode.removeChild(e)},50)},500)}),test("重建编辑器,加载草稿箱",function(){UE.delEditor(te.obj[0]),te.obj[0].container.parentNode.removeChild(te.obj[0].container);var e=document.body.appendChild(document.createElement("div"));e.id="ue";var t=UE.getEditor("ue",{saveInterval:0});setTimeout(function(){var e="<p>内容</p>";t.setContent(e),setTimeout(function(){UE.delEditor("ue"),document.getElementById("ue")&&document.getElementById("ue").parentNode.removeChild(document.getElementById("ue"));var t=document.body.appendChild(document.createElement("div"));t.id="ue";var n=UE.getEditor("ue");setTimeout(function(){equal(n.queryCommandState("drafts"),0,"草稿箱可用"),n.execCommand("drafts"),ua.checkSameHtml(n.body.innerHTML,e,"内容加载正确"),UE.delEditor("ue"),document.getElementById("ue")&&document.getElementById("ue").parentNode.removeChild(document.getElementById("ue")),start()},500)},200)},500),stop()});