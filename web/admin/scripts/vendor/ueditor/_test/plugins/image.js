module("plugins.image"),test("trace1491 修改动图的宽高",function(){setTimeout(function(){expect(3);var e=te.obj[0],t=te.obj[1],a=e.body;e.setContent("<p><br></p>"),setTimeout(function(){t.setStart(a.firstChild,0).collapse(1).select(),e.execCommand("insertimage",{src:"../data/test.JPG"}),setTimeout(function(){ua.manualDeleteFillData(e.body),t.selectNode(a.firstChild.firstChild).select();var i=a.getElementsByTagName("img")[0];e.execCommand("insertimage",{src:"../data/test.JPG",width:50,height:80}),setTimeout(function(){equal($(i).attr("width"),"50","比较width"),equal($(i).attr("height"),"80","比较width"),ok(/data\/test\.JPG/.test(i.getAttribute("src")),"比较src"),start()},500)},100)},100)},100),stop()}),test("插入新图像",function(){var e=te.obj[0],t=te.obj[1],a=e.body;e.setContent("<p><br></p>"),t.setStart(a.firstChild,0).collapse(1).select(),e.execCommand("insertimage",{src:"http://img.baidu.com/hi/jx2/j_0001.gif",width:50,height:51}),ua.manualDeleteFillData(e.body);var i=a.getElementsByTagName("img")[0];equal(i.getAttribute("src"),"http://img.baidu.com/hi/jx2/j_0001.gif","比较src"),equal(i.getAttribute("width"),"50","比较width"),equal(i.getAttribute("height"),"51","比较height")}),test("trace 1490 不设宽高，插入图片",function(){var e=te.obj[0],t=te.obj[1],a=e.body;e.setContent("<p><br></p>"),t.setStart(a.firstChild,0).collapse(1).select(),e.execCommand("insertimage",{src:"http://img.baidu.com/hi/jx2/j_0001.gif"}),ua.manualDeleteFillData(e.body);var i=a.getElementsByTagName("img")[0];equal(i.getAttribute("src"),"http://img.baidu.com/hi/jx2/j_0001.gif","比较src")}),test("插入对齐方式为居中对齐的图像，新建一个p，在p上设置居中对齐",function(){var e=te.obj[0],t=te.obj[1],a=e.body;e.setContent("<p>hello</p>"),t.setStart(a.firstChild,0).collapse(1).select(),e.execCommand("insertimage",{src:"http://img.baidu.com/hi/jx2/j_0001.gif",width:50,height:51,floatStyle:"center"}),ua.manualDeleteFillData(e.body);var i=a.getElementsByTagName("img")[0];equal(a.childNodes.length,2,"2个p");var l=a.firstChild;equal(l.style.textAlign,"center","居中对齐"),ok(l.nextSibling.innerHTML.indexOf("hello")>-1,"第二个p里面是hello"),baidu.editor.browser.ie?equal(i.style.styleFloat,"","float为空"):equal(i.style.cssFloat,"","float为空"),equal(i.getAttribute("src"),"http://img.baidu.com/hi/jx2/j_0001.gif","比较src"),equal(i.getAttribute("width"),"50","比较width"),equal(i.getAttribute("height"),"51","比较height")}),test("修改已有图片的属性",function(){var e=te.obj[0],t=te.obj[1],a=e.body;e.setContent('<p><img src="http://img.baidu.com/hi/jx2/j_0004.gif" >hello<img src="http://img.baidu.com/hi/jx2/j_0053.gif" ></p>'),t.selectNode(a.firstChild.firstChild).select(),e.execCommand("insertimage",{src:"http://img.baidu.com/hi/jx2/j_0018.gif"}),equal(ua.getChildHTML(a.firstChild),'<img src="http://img.baidu.com/hi/jx2/j_0018.gif" _src="http://img.baidu.com/hi/jx2/j_0004.gif">hello<img src="http://img.baidu.com/hi/jx2/j_0053.gif" _src="http://img.baidu.com/hi/jx2/j_0053.gif">',"检查插入的图像地址"),equal(a.firstChild.childNodes.length,3,"2个img孩子")}),test("选区不闭合插入图像",function(){var e=te.obj[0],t=te.obj[1],a=e.body;e.setContent('<p>hello1</p><p>hello2<img src="http://img.baidu.com/hi/jx2/j_0004.gif"></p>'),setTimeout(function(){t.setStart(a.firstChild.firstChild,2).setEnd(a.lastChild,2).select(),e.execCommand("insertimage",{src:"http://img.baidu.com/hi/jx2/j_0016.gif",width:"100",height:"100"}),ua.manualDeleteFillData(e.body),equal(a.childNodes.length,1,"只有一个p"),ua.clearWhiteNode(a.firstChild);var i=a.firstChild.lastChild;equal(i.getAttribute("src"),"http://img.baidu.com/hi/jx2/j_0016.gif","比较src"),equal(i.getAttribute("width"),"100","比较width"),equal(i.getAttribute("height"),"100","比较height"),start()},50),stop()}),test("图像设置左右浮动",function(){var e=te.obj[0],t=te.obj[1],a=e.body;e.setContent('<p>hello1</p><p>hello2<img src="http://img.baidu.com/hi/jx2/j_0004.gif"></p>'),t.selectNode(a.lastChild.lastChild).select(),e.execCommand("imagefloat","left"),equal(a.getElementsByTagName("img")[0].style.cssFloat||a.getElementsByTagName("img")[0].style.styleFloat,"left","左浮动"),equal(e.queryCommandValue("imagefloat"),"left"),e.execCommand("imagefloat","right"),equal(a.getElementsByTagName("img")[0].style.cssFloat||a.getElementsByTagName("img")[0].style.styleFloat,"right","右浮动"),equal(e.queryCommandValue("imagefloat"),"right"),equal(e.queryCommandState("imagefloat"),0,"图片被选中，因此图片菜单高亮"),t.setStart(a.firstChild,0).collapse(1).select(),equal(e.queryCommandState("imagefloat"),-1,"光标闭合，因此图片菜单高不高亮"),equal(e.queryCommandValue("justify"),"left","段落的对齐方式为左对齐"),equal(e.queryCommandValue("imagefloat"),"none","图片对齐方式在闭合情况获取为空"),t.selectNode(a.firstChild.firstChild).select(),equal(e.queryCommandValue("imagefloat"),"none","选中文本，因此图片菜单高不高亮")}),test("左浮动变为默认的样式和居中",function(){var e=te.obj[0],t=te.obj[1],a=e.body;e.setContent('<p>hello1</p><p>hello2<img src="http://img.baidu.com/hi/jx2/j_0004.gif" style="float:left"></p>'),t.selectNode(a.lastChild.lastChild).select(),e.execCommand("imagefloat","none"),equal(ua.getFloatStyle(a.getElementsByTagName("img")[0]),"","没有浮动方式"),equal(e.queryCommandValue("imagefloat"),"none"),$(a.getElementsByTagName("img")[0]).css("float"),t.selectNode(a.getElementsByTagName("img")[0]).select(),e.execCommand("imagefloat","center"),equal(e.queryCommandValue("imagefloat"),"center"),equal(a.childNodes.length,3,"3个p，image被切出一个p出来了");var i=a.childNodes[2];equal(i.tagName.toLowerCase(),"p","第2个是p"),equal(i.firstChild.tagName.toLowerCase(),"img","p的孩子为image"),equal(ua.getFloatStyle(i.firstChild),"","image对齐方式float为空"),equal(e.queryCommandValue("justify"),"center","段落的对齐方式为居中")}),test(" 带有超链接的图片",function(){var e=te.obj[0],t=te.obj[1],a=e.body;e.setContent('<p>hello1</p><p>hello2<a href="www.baidu.com"><img src="http://img.baidu.com/hi/jx2/j_0004.gif" style="float:left"></a></p>'),t.selectNode(a.lastChild.lastChild).select(),e.execCommand("imagefloat","center");var i=a.childNodes[2];equal(i.firstChild.tagName.toLowerCase(),"a","p的孩子为a"),equal(ua.getFloatStyle(i.firstChild),"","image对齐方式float为空"),equal(e.queryCommandValue("justify"),"center","段落的对齐方式为居中"),e.execCommand("imagefloat","left"),equal(i.firstChild.tagName.toLowerCase(),"a","p的孩子为a"),equal(ua.getFloatStyle(i.firstChild.firstChild),"left","image对齐方式float为left"),e.execCommand("imagefloat","none"),equal(i.firstChild.tagName.toLowerCase(),"a","p的孩子为a"),equal(ua.getFloatStyle(i.firstChild.firstChild),"","image对齐方式float为空")}),test(" 默认样式切换到居中再切换回默认，会把居中导致的3个p合并",function(){var e=te.obj[0],t=te.obj[1],a=e.body;e.setContent('<p>hello2<a href="www.baidu.com"><img src="http://img.baidu.com/hi/jx2/j_0004.gif" style="float:left"></a>hello3</p>'),setTimeout(function(){t.selectNode(a.getElementsByTagName("a")[0]).select(),e.execCommand("imagefloat","center");var i=a.childNodes[1];equal(i.firstChild.tagName.toLowerCase(),"a","p的孩子为a"),equal(ua.getFloatStyle(i.firstChild),"","image对齐方式float为空"),equal(e.queryCommandValue("justify"),"center","段落的对齐方式为居中"),e.execCommand("imagefloat","none"),equal(a.childNodes.length,1,"3个p合并为1个");var l=a.firstChild.firstChild.nextSibling;equal(l.tagName.toLowerCase(),"a","p的孩子为a"),equal(l.firstChild.tagName.toLowerCase(),"img","a的孩子是img"),equal(ua.getFloatStyle(l.firstChild),"","image对齐方式float为空"),start()},50),stop()});