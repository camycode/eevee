module("plugins.insertcode"),test("trace 3343：插入代码中有空行",function(){var e=te.obj[0],r=te.obj[1];e.setContent("hello"),ua.keydown(e.body,{keyCode:65,ctrlKey:!0}),e.execCommand("insertcode","Java"),r.setStart(e.body.firstChild,0).collapse(!0).select(),ua.keydown(e.body,{keyCode:13}),r.setStart(e.body.firstChild,0).collapse(!0).select(),ua.keydown(e.body,{keyCode:13}),r.setStart(e.body.firstChild,0).collapse(!0).select(),r.insertNode(e.document.createTextNode("hello"));var t=ua.browser.ie?"":"<br>";ua.browser.ie?ua.checkSameHtml(e.body.innerHTML,"<PRE class=brush:Java;toolbar:false>​<BR>hello​​<BR>​​hello</PRE><P></P>","插入代码"):ua.browser.gecko||ua.browser.webkit?ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:Java;toolbar:false">hello<br><br>hello</pre>',"插入代码"):ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:Java;toolbar:false">hello<br><br>hello</pre><p>'+t+"</p>","插入代码"),setTimeout(function(){e.execCommand("source"),setTimeout(function(){e.execCommand("source");ua.browser.ie?"":"<br>";ua.browser.ie&&ua.browser.ie<9?ua.checkSameHtml(e.body.innerHTML,"<PRE class=brush:Java;toolbar:false>hello<BR>hello<BR></PRE><P>&nbsp;</P>","样式不变"):(ua.browser.gecko||ua.browser.webkit)&&ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:Java;toolbar:false">hello<br><br>hello<br></pre>',"样式不变"),start()},20)},20),stop()}),test("trace 3355：不闭合选区插入代码",function(){var e=te.obj[0],r="&lt;div id=&quot;upload&quot; style=&quot;display: none&quot; &gt;&lt;img id=&quot;uploadBtn&quot;&gt;&lt;/div&gt;";e.setContent(r),setTimeout(function(){ua.keydown(e.body,{keyCode:65,ctrlKey:!0}),e.execCommand("insertcode","html");var r=ua.browser.ie?"":"<br>";ua.browser.gecko||ua.browser.opera||ua.browser.webkit?ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">&lt;div id="upload" style="display: none" &gt;&lt;img id="uploadBtn"&gt;&lt;/div&gt;</pre>',"检查插入了html"):ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">&lt;div id="upload" style="display: none" &gt;&lt;img id="uploadBtn"&gt;&lt;/div&gt;</pre><p>'+r+"</p>","检查插入了html"),start()},50),stop()}),test("trace 3395：插入代码为空时，清空编辑器",function(){var e=te.obj[0],r=te.obj[1];e.setContent(""),e.execCommand("insertcode","html");var t=ua.browser.ie?"&nbsp;":"<br>";ua.browser.gecko||ua.browser.ie>10?ua.checkSameHtml(e.body.firstChild.outerHTML,'<pre class="brush:html;toolbar:false"><br></pre>',"检查插入了html"):ua.browser.ie>8?ua.checkSameHtml(e.body.firstChild.outerHTML,'<pre class="brush:html;toolbar:false"></pre>',"检查插入了html"):ua.checkSameHtml(e.body.firstChild.outerHTML,'<pre class="brush:html;toolbar:false">'+t+"</pre>","检查插入了html"),r.setStart(e.body.firstChild,0).collapse(!0).select(),r.insertNode(e.document.createTextNode("hello")),ua.keydown(e.body,{keyCode:65,ctrlKey:!0}),ua.keydown(e.body,{keyCode:8}),t=ua.browser.ie?"":"<br>",ua.checkSameHtml(e.body.innerHTML,"<p>"+t+"</p>","检查编辑器清空")}),test("trace 3396：多次切换源码，不会产生空行",function(){var e=te.obj[0];e.setContent("<p>&lt;body&gt;</p><p>&lt;/body&gt;</p>"),ua.keydown(e.body,{keyCode:65,ctrlKey:!0}),e.execCommand("insertcode","html");var r=9==ua.browser.ie||10==ua.browser.ie?"\n":"<br>",t=e.body.firstChild.outerHTML.toLowerCase(),a='"';ua.browser.ie<9&&ua.browser.ie&&(a=""),equal(t,"<pre class="+a+"brush:html;toolbar:false"+a+">&lt;body&gt;"+r+"&lt;/body&gt;</pre>","检查插入了html"),ua.checkSameHtml(e.body.firstChild.outerHTML,'<pre class="brush:html;toolbar:false">&lt;body&gt;'+r+"&lt;/body&gt;</pre>","检查插入了html"),setTimeout(function(){e.execCommand("source"),setTimeout(function(){e.execCommand("source");var t=9==ua.browser.ie||10==ua.browser.ie?"":"<br>";r=9==ua.browser.ie||10==ua.browser.ie?"\n":"<br>";var a=ua.browser.ie&&ua.browser.ie<9?"\n":"";ua.checkSameHtml(e.body.firstChild.innerHTML,"&lt;body&gt;"+a+r+"&lt;/body&gt;"+t,"切回源码无影响"),start()},20)},20),stop()}),test("trace 3407：表格中插入代码",function(){var e=te.obj[0],r=te.obj[1];e.setContent(""),e.execCommand("inserttable"),stop(),setTimeout(function(){var t=e.body.getElementsByTagName("td");t[1].innerHTML="asd",r.setStart(t[1],0).setEnd(t[1],1).select(),e.execCommand("insertcode","Javascript");ua.browser.ie?"&nbsp;":"<br>";ua.checkSameHtml(t[1].innerHTML,'<pre class="brush:Javascript;toolbar:false">asd</pre>',"检查插入了html"),start()},50)}),test("test-beforeInsertHTML",function(){var e=te.obj[0],r=te.obj[1];e.setContent('<pre class="brush:html;toolbar:false"><br/></pre>'),r.setStart(e.body.firstChild,0).collapse(!0).select();var t="text";e.execCommand("inserthtml",t),9==ua.browser.ie||10==ua.browser.ie?ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">'+t+"</pre>","插入IE"):ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">'+t+"<br></pre>","插入chrome/ff/ie11+"),ua.manualDeleteFillData(e.body),r.setStart(e.body.firstChild.firstChild,0).collapse(!0).select(),t="<p>I</p>",e.execCommand("inserthtml",t),9==ua.browser.ie||10==ua.browser.ie?ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">Itext</pre>',"插入IE"):ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">Itext<br></pre>',"插入chrome/ff/ie11+"),ua.manualDeleteFillData(e.body),r.setStart(e.body.firstChild.firstChild,1).collapse(!0).select(),t="<br>br",e.execCommand("inserthtml",t),9==ua.browser.ie||10==ua.browser.ie?ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">\nbrItext</pre>',"插入IE"):ua.browser.ie>10?ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">I\nbrtext<br></pre>',"插入IE11+"):ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">I​<br>brtext<br></pre>',"插入chrome/ff"),ua.manualDeleteFillData(e.body),r.setStart(e.body.firstChild,0).collapse(!0).select(),t="<p>PPP<p>222</p><span>SSS</span><br>BBB</p>",e.execCommand("inserthtml",t),9==ua.browser.ie||10==ua.browser.ie?ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">PPP222SSS\nBBB\nbrItext</pre>',"插入IE"):ua.browser.ie>10?ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">PPP222SSS\nBBBI\nbrtext<br></pre>',"插入IE11+"):ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">PPP222SSS<br>BBBI<br>brtext<br></pre>',"插入chrome/ff/ie11+"),ua.manualDeleteFillData(e.body),r.setStart(e.body.firstChild,0).setEnd(e.body.firstChild,4).select(),t="replace",e.execCommand("inserthtml",t),9==ua.browser.ie||10==ua.browser.ie?ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">replace</pre>',"插入IE"):ua.browser.ie>10?ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">replace<br></pre>',"插入IE11+"):ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">replaceBBBI<br>brtext<br></pre>',"插入chrome/ff/ie11+"),ua.manualDeleteFillData(e.body),r.setStart(e.body.firstChild,0).setEnd(e.body.firstChild,0).select(),t="<p>PPP</p>",e.execCommand("inserthtml",t),9==ua.browser.ie||10==ua.browser.ie?ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">PPPreplace</pre>',"插入IE"):ua.browser.ie>10?ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">PPPreplace<br></pre>',"插入IE11+"):ua.checkSameHtml(e.body.innerHTML,'<pre class="brush:html;toolbar:false">PPPreplaceBBBI<br>brtext<br></pre>',"插入chrome/ff/ie11+"),ua.manualDeleteFillData(e.body)}),test("关于pre中的tabKey",function(){var e=te.obj[0],r=te.obj[1];e.setContent('<pre class="brush:Javascript;toolbar:false">function a(){var a = true;}</pre>');var t=e.body.firstChild.firstChild;r.setStart(t,13).setEnd(t,16).select(),ua.keydown(e.body,{shiftKey:!1,keyCode:9}),ua.keyup(e.body,{shiftKey:!1,keyCode:9}),8==ua.browser.ie||9==ua.browser.ie?equal(e.getContent(),'<pre class="brush:Javascript;toolbar:false">&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;a(){var&nbsp;a&nbsp;=&nbsp;true;}</pre>'):ua.browser.ie>9?equal(e.getContent(),'<pre class="brush:Javascript;toolbar:false">&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;a(){var&nbsp;a&nbsp;=&nbsp;true;}</pre>',"验证pre下tabKey1"):equal(e.getContent(),'<pre class="brush:Javascript;toolbar:false">&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;a(){var&nbsp;a&nbsp;=&nbsp;true;}</pre>',"验证pre下tabKey1"),e.setContent('<pre class="brush:Javascript;toolbar:false"><br>function a(){var a = true;}</pre>');var t=e.body.firstChild.firstChild;if(r.setStart(t,13).setEnd(t,16).select(),ua.keydown(e.body,{shiftKey:!1,keyCode:9}),ua.keyup(e.body,{shiftKey:!1,keyCode:9}),8==ua.browser.ie||9==ua.browser.ie){var a="\n";9==ua.browser.ie&&(a=""),equal(e.getContent(),'<pre class="brush:Javascript;toolbar:false">&nbsp;&nbsp;&nbsp;&nbsp;'+a+"function&nbsp;a(){var&nbsp;a&nbsp;=&nbsp;true;}</pre>","验证pre下tabKey2")}else if(ua.browser.ie>9){var s="",o="&nbsp;&nbsp;&nbsp;&nbsp;";11==ua.browser.ie&&(s="&nbsp;&nbsp;&nbsp;&nbsp;",o="\n"),equal(e.getContent(),'<pre class="brush:Javascript;toolbar:false">'+o+"function&nbsp;a(){var&nbsp;a&nbsp;=&nbsp;true;}</pre>"+s,"验证pre下tabKey2")}else equal(e.getContent(),'<pre class="brush:Javascript;toolbar:false">\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;a(){var&nbsp;a&nbsp;=&nbsp;true;}</pre>',"验证pre下tabKey2");e.setContent('<pre class="brush:Javascript;toolbar:false">function a(){<br>var a = true;}</pre>');var t=e.body.firstChild.firstChild;if(r.setStart(t,13).setEnd(t,16).select(),ua.keydown(e.body,{shiftKey:!1,keyCode:9}),ua.keyup(e.body,{shiftKey:!1,keyCode:9}),8==ua.browser.ie)equal(e.getContent(),'<pre class="brush:Javascript;toolbar:false">function&nbsp;a(){&nbsp;&nbsp;&nbsp;&nbsp;\nvar&nbsp;a&nbsp;=&nbsp;true;}</pre>',"验证pre下tabKey3");else if(ua.browser.ie>8){var b="&nbsp;&nbsp;&nbsp;&nbsp;",l="";11==ua.browser.ie&&(b="",l="&nbsp;&nbsp;&nbsp;&nbsp;"),equal(e.getContent(),'<pre class="brush:Javascript;toolbar:false">'+b+"function&nbsp;a(){"+l+"\nvar&nbsp;a&nbsp;=&nbsp;true;}</pre>","验证pre下tabKey3")}else equal(e.getContent(),'<pre class="brush:Javascript;toolbar:false">function&nbsp;a(){&nbsp;&nbsp;&nbsp;&nbsp;\nvar&nbsp;a&nbsp;=&nbsp;true;}</pre>',"验证pre下tabKey3")});