UE.plugins.fiximgclick=function(){function e(){this.editor=null,this.resizer=null,this.cover=null,this.doc=document,this.prePos={x:0,y:0},this.startPos={x:0,y:0}}var t=!1;return function(){var o=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];e.prototype={init:function(e){var t=this;t.editor=e,t.startPos=this.prePos={x:0,y:0},t.dragId=-1;var o=[],s=t.cover=document.createElement("div"),r=t.resizer=document.createElement("div");for(s.id=t.editor.ui.id+"_imagescale_cover",s.style.cssText="position:absolute;display:none;z-index:"+t.editor.options.zIndex+";filter:alpha(opacity=0); opacity:0;background:#CCC;",domUtils.on(s,"mousedown click",function(){t.hide()}),i=0;i<8;i++)o.push('<span class="edui-editor-imagescale-hand'+i+'"></span>');r.id=t.editor.ui.id+"_imagescale",r.className="edui-editor-imagescale",r.innerHTML=o.join(""),r.style.cssText+=";display:none;border:1px solid #3b77ff;z-index:"+t.editor.options.zIndex+";",t.editor.ui.getDom().appendChild(s),t.editor.ui.getDom().appendChild(r),t.initStyle(),t.initEvents()},initStyle:function(){utils.cssRule("imagescale",".edui-editor-imagescale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;-webkit-box-sizing: content-box;-moz-box-sizing: content-box;box-sizing: content-box;}.edui-editor-imagescale span{position:absolute;width:6px;height:6px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-editor-imagescale .edui-editor-imagescale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-editor-imagescale .edui-editor-imagescale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-editor-imagescale .edui-editor-imagescale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},initEvents:function(){var e=this;e.startPos.x=e.startPos.y=0,e.isDraging=!1},_eventHandler:function(e){var i=this;switch(e.type){case"mousedown":var o,o=e.target||e.srcElement;-1!=o.className.indexOf("edui-editor-imagescale-hand")&&-1==i.dragId&&(i.dragId=o.className.slice(-1),i.startPos.x=i.prePos.x=e.clientX,i.startPos.y=i.prePos.y=e.clientY,domUtils.on(i.doc,"mousemove",i.proxy(i._eventHandler,i)));break;case"mousemove":-1!=i.dragId&&(i.updateContainerStyle(i.dragId,{x:e.clientX-i.prePos.x,y:e.clientY-i.prePos.y}),i.prePos.x=e.clientX,i.prePos.y=e.clientY,t=!0,i.updateTargetElement());break;case"mouseup":-1!=i.dragId&&(i.updateContainerStyle(i.dragId,{x:e.clientX-i.prePos.x,y:e.clientY-i.prePos.y}),i.updateTargetElement(),i.target.parentNode&&i.attachTo(i.target),i.dragId=-1),domUtils.un(i.doc,"mousemove",i.proxy(i._eventHandler,i)),t&&(t=!1,i.editor.fireEvent("contentchange"))}},updateTargetElement:function(){var e=this;domUtils.setStyles(e.target,{width:e.resizer.style.width,height:e.resizer.style.height}),e.target.width=parseInt(e.resizer.style.width),e.target.height=parseInt(e.resizer.style.height),e.attachTo(e.target)},updateContainerStyle:function(e,t){var i,s=this,r=s.resizer;0!=o[e][0]&&(i=parseInt(r.style.left)+t.x,r.style.left=s._validScaledProp("left",i)+"px"),0!=o[e][1]&&(i=parseInt(r.style.top)+t.y,r.style.top=s._validScaledProp("top",i)+"px"),0!=o[e][2]&&(i=r.clientWidth+o[e][2]*t.x,r.style.width=s._validScaledProp("width",i)+"px"),0!=o[e][3]&&(i=r.clientHeight+o[e][3]*t.y,r.style.height=s._validScaledProp("height",i)+"px")},_validScaledProp:function(e,t){var i=this.resizer,o=document;switch(t=isNaN(t)?0:t,e){case"left":return 0>t?0:t+i.clientWidth>o.clientWidth?o.clientWidth-i.clientWidth:t;case"top":return 0>t?0:t+i.clientHeight>o.clientHeight?o.clientHeight-i.clientHeight:t;case"width":return 0>=t?1:t+i.offsetLeft>o.clientWidth?o.clientWidth-i.offsetLeft:t;case"height":return 0>=t?1:t+i.offsetTop>o.clientHeight?o.clientHeight-i.offsetTop:t}},hideCover:function(){this.cover.style.display="none"},showCover:function(){var e=this,t=domUtils.getXY(e.editor.ui.getDom()),i=domUtils.getXY(e.editor.iframe);domUtils.setStyles(e.cover,{width:e.editor.iframe.offsetWidth+"px",height:e.editor.iframe.offsetHeight+"px",top:i.y-t.y+"px",left:i.x-t.x+"px",position:"absolute",display:""})},show:function(e){var t=this;t.resizer.style.display="block",e&&t.attachTo(e),domUtils.on(this.resizer,"mousedown",t.proxy(t._eventHandler,t)),domUtils.on(t.doc,"mouseup",t.proxy(t._eventHandler,t)),t.showCover(),t.editor.fireEvent("afterscaleshow",t),t.editor.fireEvent("saveScene")},hide:function(){var e=this;e.hideCover(),e.resizer.style.display="none",domUtils.un(e.resizer,"mousedown",e.proxy(e._eventHandler,e)),domUtils.un(e.doc,"mouseup",e.proxy(e._eventHandler,e)),e.editor.fireEvent("afterscalehide",e)},proxy:function(e,t){return function(i){return e.apply(t||this,arguments)}},attachTo:function(e){var t=this,i=t.target=e,o=this.resizer,s=domUtils.getXY(i),r=domUtils.getXY(t.editor.iframe),n=domUtils.getXY(o.parentNode);domUtils.setStyles(o,{width:i.width+"px",height:i.height+"px",left:r.x+s.x-t.editor.document.body.scrollLeft-n.x-parseInt(o.style.borderLeftWidth)+"px",top:r.y+s.y-t.editor.document.body.scrollTop-n.y-parseInt(o.style.borderTopWidth)+"px"})}}}(),function(){var t,i=this;i.setOpt("imageScaleEnabled",!0),!browser.ie&&i.options.imageScaleEnabled&&i.addListener("click",function(o,s){var r=i.selection.getRange(),n=r.getClosedNode();if(n&&"IMG"==n.tagName&&"false"!=i.body.contentEditable){if(-1!=n.className.indexOf("edui-faked-music")||n.getAttribute("anchorname")||domUtils.hasClass(n,"loadingclass")||domUtils.hasClass(n,"loaderrorclass"))return;if(!t){t=new e,t.init(i),i.ui.getDom().appendChild(t.resizer);var a,d=function(e){t.hide(),t.target&&i.selection.getRange().selectNode(t.target).select()},l=function(e){var t=e.target||e.srcElement;!t||void 0!==t.className&&-1!=t.className.indexOf("edui-editor-imagescale")||d(e)};i.addListener("afterscaleshow",function(e){i.addListener("beforekeydown",d),i.addListener("beforemousedown",l),domUtils.on(document,"keydown",d),domUtils.on(document,"mousedown",l),i.selection.getNative().removeAllRanges()}),i.addListener("afterscalehide",function(e){i.removeListener("beforekeydown",d),i.removeListener("beforemousedown",l),domUtils.un(document,"keydown",d),domUtils.un(document,"mousedown",l);var o=t.target;o.parentNode&&i.selection.getRange().selectNode(o).select()}),domUtils.on(t.resizer,"mousedown",function(e){i.selection.getNative().removeAllRanges();var o=e.target||e.srcElement;o&&-1==o.className.indexOf("edui-editor-imagescale-hand")&&(a=setTimeout(function(){t.hide(),t.target&&i.selection.getRange().selectNode(o).select()},200))}),domUtils.on(t.resizer,"mouseup",function(e){var t=e.target||e.srcElement;t&&-1==t.className.indexOf("edui-editor-imagescale-hand")&&clearTimeout(a)})}t.show(n)}else t&&"none"!=t.resizer.style.display&&t.hide()}),browser.webkit&&i.addListener("click",function(e,t){if("IMG"==t.target.tagName&&"false"!=i.body.contentEditable){var o=new dom.Range(i.document);o.selectNode(t.target).select()}})}}();