define(["app","role","user","typing","css!../css/directives/role.editor"],function(e){e.directive("role.editor",function(){return{restrict:"A",replace:!0,templateUrl:"views/directives/role.editor.html",controller:["$scope","role","user","typing",function(e,s,i,o){var r="post",n={name:"",description:"",permissions:[]},t=function(){$("#directive-role-editor").addClass("animated slideOutRight")},p=function(){$("#directive-role-editor").hide().removeClass("animated slideOutRight").addClass("animated slideInRight").show()},c=function(i){s.getRolePermissions(i).success(function(s){if(200==s.code){for(var i in s.data)for(var r in s.data[i].permissions)for(var n in e.permissions[i].permissions)if(s.data[i].permissions[r].id==e.permissions[i].permissions[n].id){e.permissions[i].permissions[n].checked="primary",e.permissions[i].permissions[n].icon="checkmark";break}}else o.warning(s.message)}).error(function(){o.error("网络错误")})};e.role={},e.permissions={},e.submitRole=function(t){e.role.parent=i.info().role,"post"==r?s.postRole(e.role).success(function(s){if(200==s.code){o.success("角色添加成功"),e.$emit("app.role.posted",s.data),e.role=$.extend({},n);for(var i in e.permissions)for(var r in e.permissions[i].permissions)e.permissions[i].permissions[r].checked=null,e.permissions[i].permissions[r].icon=null}else if(2001==s.code)for(var r in s.data)o.warning(s.data[r][0]);else o.warning(s.message)}).error(function(){o.error("网络错误")}):"put"==r&&s.putRole(t,e.role).success(function(s){if(200==s.code){o.success("角色编辑成功"),e.$emit("app.role.putted",s.data),e.role=$.extend({},n);for(var i in e.permissions)for(var r in e.permissions[i].permissions)e.permissions[i].permissions[r].checked=null,e.permissions[i].permissions[r].icon=null}else if(2001==s.code)for(var r in s.data)o.warning(s.data[r][0]);else o.warning(s.message)}).error(function(){o.error("网络错误")})},e.clickPermission=function(s,i){if("undefined"!=typeof e.permissions[s])for(var o in e.permissions[s].permissions)if(e.permissions[s].permissions[o].id==i)if("undefined"!=typeof e.permissions[s].permissions[o].checked||e.permissions[s].permissions[o].checked){delete e.permissions[s].permissions[o].checked,delete e.permissions[s].permissions[o].icon;for(var o in e.role.permissions)e.role.permissions[o]==i&&e.role.permissions.splice(o,1)}else e.permissions[s].permissions[o].checked="primary",e.permissions[s].permissions[o].icon="checkmark",e.role.permissions.push(i)},e.$on("app.role.editor.show",function(t,d){p(),r="undefined"!=typeof d?"put":"post",s.getRolePermissions(i.info().role).success(function(s){200==s.code?(e.permissions=s.data,e.loadPermissionsDone=!0,"undefined"!=typeof d&&c(d)):o.warning(s.message)}).error(function(){o.error("网络错误")}),"undefined"!=typeof d?s.getRole(d).success(function(s){200==s.code?e.role=s.data:o.warning(s.message)}).error(function(){o.error("网络错误")}):e.role=$.extend({},n)}),e.$on("app.role.editor.hide",function(e){t()}),e.closeRoleEditor=function(){t()}}]}})});