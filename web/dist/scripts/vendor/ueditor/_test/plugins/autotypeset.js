module("plugins.autotypeset"),test("全角半角转换",function(){window.localStorage.clear();var t=te.obj[0];t.setContent("<p>Mayday123,.Ｍａｙｄａｙ１２３，．</p>");var e=t.getContent();equal(e,"<p>Mayday123,.Ｍａｙｄａｙ１２３，．</p>","半角全角内容输入正确"),t.execCommand("autotypeset");var o=t.body.firstChild.innerHTML;equal(o,"Mayday123,.Ｍａｙｄａｙ１２３，．","半角全角内容输入正确2"),t.options.autotypeset.tobdc=!0,t.execCommand("autotypeset"),equal(t.body.firstChild.innerHTML,"Ｍａｙｄａｙ１２３，．Ｍａｙｄａｙ１２３，．","内容转为全角：正确"),t.options.autotypeset.tobdc=!1,t.setContent("<p>Mayday123,.Ｍａｙｄａｙ１２３，．</p>"),t.options.autotypeset.bdc2sb=!0,t.execCommand("autotypeset"),equal(t.body.firstChild.innerHTML,"Mayday123,.Mayday123,.","内容转为半角：正确"),t.options.autotypeset.bdc2sb=!1}),test("文本居中",function(){var t=te.obj[0];t.setContent("<p>p文本<br></p>"),setTimeout(function(){t.options.autotypeset.textAlign="center",t.execCommand("autotypeset"),equal($(t.body.firstChild).css("text-align"),"center","文本居中"),start()},100),stop()}),test("trace:2183 h1标题居中",function(){var t=te.obj[0];t.setContent("<h1>h1标题<br /></h1>"),setTimeout(function(){t.options.autotypeset.textAlign="center",t.execCommand("autotypeset"),equal($(t.body.firstChild).css("text-align"),"center","h1标题居中"),start()},50),stop()}),test("合并空行",function(){var t=te.obj[0];t.setContent("<p>欢迎使用</p><p><br /></p><p><br /></p><p>ueditor!</p>"),setTimeout(function(){t.options.autotypeset.mergeEmptyline=!0,delete t.options.autotypeset.textAlign,t.execCommand("autotypeset"),ua.manualDeleteFillData(t.body);var e=t.body.innerHTML.toLowerCase().replace(/\r\n/gi,"");equal(e,"<p>欢迎使用</p><p><br></p><p>ueditor!</p>","合并空行"),start()},50),stop()}),test("带有图片表情",function(){var t=te.obj[0];t.setContent('<p>欢迎使用ueditor!<img src="http://img.baidu.com/hi/jx2/j_0015.gif" /></p>'),t.execCommand("autotypeset"),equal($(t.body.lastChild).css("text-align"),"center","图片居中"),t.options.autotypeset.imageBlockLine="left",t.execCommand("autotypeset"),equal($(t.body.lastChild).css("text-align"),"left","图片居左")}),test("删除空行",function(){var t=te.obj[0];t.setContent("<p>欢迎使用</p><p><br /></p><p><br /></p><p>ueditor!</p>"),setTimeout(function(){t.options.autotypeset.mergeEmptyline=!1,t.options.autotypeset.removeEmptyline=!0,delete t.options.autotypeset.textAlign,t.execCommand("autotypeset"),ua.manualDeleteFillData(t.body),equal(t.body.innerHTML.toLowerCase().replace(/\r\n/gi,""),"<p>欢迎使用</p><p>ueditor!</p>","删除空行"),start()},50),stop()}),test("首行缩进",function(){var t=te.obj[0];t.setContent("<p>欢迎使用ueditor!</p>"),setTimeout(function(){t.options.autotypeset.indent=!0,t.options.autotypeset.textAlign="left",t.execCommand("autotypeset"),ua.manualDeleteFillData(t.body);var e='<p style="text-indent: 2em; text-align: left; ">欢迎使用ueditor!</p>';ua.checkHTMLSameStyle(e,t.document,t.body,"首行缩进"),start()},50),stop()}),test("trace 3277：图像对齐",function(){var t=te.obj[0];t.setContent('<p><img src="http://img.baidu.com/hi/jx2/j_0001.gif" width="50" height="51" _src="http://img.baidu.com/hi/jx2/j_0001.gif"></p>'),setTimeout(function(){t.options.autotypeset.imageBlockLine="center",delete t.options.autotypeset.textAlign;var e='<p style="text-align:center"><img src="http://img.baidu.com/hi/jx2/j_0001.gif" width="50" height="51" _src="http://img.baidu.com/hi/jx2/j_0001.gif"/></p>';t.execCommand("autotypeset"),ua.checkHTMLSameStyle(e,t.document,t.body,"图像对齐"),start()},50),stop()}),test("trace 2651：字体样式",function(){var t=te.obj[0];t.setContent('<p><span style="font-size:24px;font-family:黑体, simhei;">欢迎使用ue</span>ditor!</p>'),setTimeout(function(){t.options.autotypeset.clearFontSize=t.options.autotypeset.clearFontFamily=!0,delete t.options.autotypeset.textAlign,t.execCommand("autotypeset"),equal(ua.getChildHTML(t.body),"<p>欢迎使用ueditor!</p>","恢复字体默认样式"),start()},50),stop()}),test("去掉class,去掉多余节点",function(){var t=te.obj[0];t.setContent('<p class="noBorder">欢迎使用ueditor!</p>'),t.options.autotypeset.removeClass=!0,delete t.options.autotypeset.textAlign,t.execCommand("autotypeset"),equal(ua.getChildHTML(t.body),"<p>欢迎使用ueditor!</p>","去掉class")}),test("粘贴过滤",function(){var t=(document.body.appendChild(document.createElement("div")),te.obj[0]);t.setContent(""),t.options.autotypeset.pasteFilter=!0,t.options.autotypeset.removeEmptyline=!0,delete t.options.autotypeset.textAlign,t.execCommand("autotypeset");var e={html:'<img src="http://img.baidu.com/hi/jx2/j_0015.gif" />hello1'};t.fireEvent("beforepaste",e),t.execCommand("insertHtml",e.html,!0),t.fireEvent("afterpaste");var o='<p style="text-align:center;"><img src="http://img.baidu.com/hi/jx2/j_0015.gif"></p>hello1';ua.checkHTMLSameStyle(o,t.document,t.body,"文字左对齐，表情居中"),t.setContent(""),t.options.autotypeset.imageBlockLine="none",t.options.autotypeset.textAlign="center",t.options.autotypeset.removeEmptyline=!0,t.options.autotypeset.pasteFilter=!0,t.execCommand("autotypeset"),e={html:'<p>hello1</p><p style="text-align:center;"><img src="http://img.baidu.com/hi/jx2/j_0001.gif"/></p><p>hello2</p>'},t.fireEvent("beforepaste",e),t.execCommand("insertHtml",e.html,!0),t.fireEvent("afterpaste"),o='<p style="text-align:center;">hello1<img src="http://img.baidu.com/hi/jx2/j_0001.gif" style="float: none;">hello2</p>',ua.checkHTMLSameStyle(o,t.document,t.body,"文字居中，表情居左")}),test("trace:4018，4012",function(){var t=document.body.appendChild(document.createElement("div"));t.id="ue2";var e=UE.getEditor("ue2");e.ready(function(){e.setContent("Mayday123,.Ｍａｙｄａｙ１２３，．");var t=$("#edui18_state div");ua.click(t[4]),ua.click($("input")[19]);var o=$(".edui-autotypesetpicker-body tr"),n=o[7].getElementsByTagName("input");ua.click(n[0]);var a=$(".edui-autotypesetpicker-body button");ua.click(a[0]),ua.browser.ie&&8==ua.browser.ie?equal(e.getContent(),'<p style="TEXT-ALIGN: left">Ｍａｙｄａｙ１２３，．Ｍａｙｄａｙ１２３，．</p>',"未执行半角转全角"):equal(e.getContent(),'<p style="text-align: left;">Mayday123,.Ｍａｙｄａｙ１２３，．</p>',"未执行半角转全角"),setTimeout(function(){UE.delEditor("ue2"),window.localStorage.clear(),start()},100)}),stop()}),test("trace:3991",function(){var t=te.obj[0];setTimeout(function(){t.setContent(""),t.execCommand("inserttable",{numCols:3,numRows:3});var e=t.body.getElementsByTagName("td")[0],o=new baidu.editor.dom.Range(t.document);o.setStart(e,0).collapse(1).select(),t.execCommand("inserttitlecol"),equal(t.queryCommandState("inserttitlecol"),-1,"标题列不能向右合并");$("#edui538_state")[0];start()},100),stop()}),test("trace:3967",function(){var t=te.obj[0];t.setContent("123<br/>"),t.execCommand("insertorderedlist","decimal"),t.execCommand("source"),setTimeout(function(){t.execCommand("source"),setTimeout(function(){t.execCommand("source");var e=t.getContent();ok(e.indexOf("br")==e.lastIndexOf("br"),"只有一个<br/>"),start()},50)},50),stop()});