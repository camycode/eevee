test("框选",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),setTimeout(function(){t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable",{numCols:3,numRows:3});var o=e.body.getElementsByTagName("td");ua.mousedown(o[0]),ua.mouseover(o[4]),ua.mouseup(o[4]),setTimeout(function(){var o=e.getUETable(e.body.firstChild).selectedTds,a=e.body.getElementsByTagName("td");equal(o.length,4,"框选"),ua.browser.ie>8&&ua.browser.ie<11?ua.checkResult(e.selection.getRange(),a[0].firstChild,a[0].firstChild,1,1,!0,"检查选中的range"):ua.checkResult(e.selection.getRange(),a[0],a[0],0,0,!0,"检查选中的range"),t.setStart(a[4],0).collapse(!0).select(),ua.mousedown(a[4],{button:2}),setTimeout(function(){var t=e.getUETable(e.body.firstChild).selectedTds,o=e.body.getElementsByTagName("td");equal(t.length,4,"右键框选不变"),ua.browser.ie>8&&ua.browser.ie<11?ua.checkResult(e.selection.getRange(),o[0].firstChild,o[0].firstChild,1,1,!0,"检查选中的range"):ua.checkResult(e.selection.getRange(),o[0],o[0],0,0,!0,"检查选中的range"),start()},50)},50)},80),stop()}),test("tableDragable-显示和消失",function(){if(!(browser.ie&&browser.version<8)){var e=document.body.appendChild(document.createElement("div"));e.id="ue";var t=UE.getEditor("ue",{tableDragable:!0});t.ready(function(){var e=new baidu.editor.dom.Range(t.document);t.setContent("<p></p>"),setTimeout(function(){e.setStart(t.body.firstChild,0).collapse(!0).select(),t.execCommand("inserttable",{numCols:3,numRows:3});t.body.getElementsByTagName("td");ua.mousemove(t.body.firstChild);var o=domUtils.getXY(t.body.firstChild),a=ua.browser.webkit?"-webkit-user-select: none;":ua.browser.gecko?"-moz-user-select: none;":ua.browser.ie>8?"-ms-user-select: none":"",l='<div contenteditable="false" style="width:15px;height:15px;background-image:url('+t.options.UEDITOR_HOME_URL+"dialogs/table/dragicon.png);position: absolute;cursor:move;top:"+(o.y-15)+"px;left:"+o.x+"px; "+a+'"'+(ua.browser.ie&&ua.browser.ie<9?'unselectable="on"':"")+"></div>";setTimeout(function(){var e=t.body.lastChild;ua.checkSameHtml(e.outerHTML.replace("&quot;",""),l,"DragButton显示"),ua.mouseout(e),ua.mousemove(t.body),setTimeout(function(){equal(t.body.getElementsByTagName("div").length,0,"按钮没有了"),UE.delEditor("ue"),te.dom.push(document.getElementById("ue")),te.dom.push(document.getElementById("edui_fixedlayer")),start()},2100)},20)},50)}),stop()}}),test("tableDragable-单击",function(){if(!(browser.ie&&browser.version<8)){var e=document.body.appendChild(document.createElement("div"));e.id="ue";var t=UE.getEditor("ue",{tableDragable:!0});expect(1),t.ready(function(){var e=new baidu.editor.dom.Range(t.document);t.setContent("<p></p>"),setTimeout(function(){e.setStart(t.body.firstChild,0).collapse(!0).select(),t.execCommand("inserttable",{numCols:3,numRows:3});t.body.getElementsByTagName("td");ua.mousemove(t.body.firstChild),setTimeout(function(){var e=t.body.lastChild;t.addListener("tableClicked",function(e,o,a){same(o,t.body.getElementsByTagName("table")[0],"tableClicked事件,传入的参数正确"),setTimeout(function(){UE.delEditor("ue"),te.dom.push(document.getElementById("ue")),te.dom.push(document.getElementById("edui_fixedlayer")),start()},500)}),ua.click(e)},20)},50)}),stop()}}),test("tableDragable-双击",function(){if(!(browser.ie&&browser.version<8)){var e=document.body.appendChild(document.createElement("div"));e.id="ue";var t=UE.getEditor("ue",{tableDragable:!0});t.ready(function(){var e=new baidu.editor.dom.Range(t.document);t.setContent("<p></p>"),setTimeout(function(){e.setStart(t.body.firstChild,0).collapse(!0).select(),t.execCommand("inserttable",{numCols:3,numRows:3});t.body.getElementsByTagName("td");ua.mousemove(t.body.firstChild),setTimeout(function(){var e=t.body.lastChild;ua.dblclick(e),setTimeout(function(){var e=t.getUETable(t.body.firstChild).selectedTds,o=t.body.getElementsByTagName("td");equal(e.length,9,"全选"),ua.browser.ie>8&&ua.browser.ie<11?ua.checkResult(t.selection.getRange(),o[0].firstChild,o[0].firstChild,1,1,!0,"检查选中的range"):ua.checkResult(t.selection.getRange(),o[0],o[0],0,0,!0,"检查选中的range"),setTimeout(function(){UE.delEditor("ue"),te.dom.push(document.getElementById("ue")),te.dom.push(document.getElementById("edui_fixedlayer")),start()},500)},100)},100)},100)}),stop()}}),test("从外面粘贴表格",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select();var o={html:'<table style="width:992px"><tbody><tr><td style="border-color: rgb(247, 150, 70);width:198px" >hello1</td><td  style="background-color: rgb(255, 0, 0); border-color: rgb(247, 150, 70);width:198px" ></td></tr><tr><td >hello2</td><td ></td></tr></tbody></table><p>hello2</p>'};e.fireEvent("beforepaste",o),stop(),setTimeout(function(){var e=ua.browser.ie?"":"<br/>",t=ua.browser.ie&&ua.browser.ie<9?"border-bottom-color: rgb(247,150,70); border-top-color: rgb(247,150,70); border-right-color: rgb(247,150,70); border-left-color: rgb(247,150,70)":"border-color: rgb(247, 150, 70)",a='<table width="992"><tbody><tr><td  style="'+t+';" width="198">hello1</td><td  style="background-color: rgb(255, 0, 0); '+t+';" width="198">'+e+"</td></tr><tr><td>hello2</td><td>"+e+"</td></tr></tbody></table><p>hello2</p>";ua.checkSameHtml(o.html.toLowerCase(),a.toLowerCase(),"粘贴的表格规范格式"),start()},50)}),test("从外面粘贴表格到表格-表格中不能粘完整的表格",function(){var e=te.obj[0],t=te.obj[1];e.setContent(""),e.execCommand("inserttable",{numCols:3,numRows:3});var o=e.body.getElementsByTagName("td");t.setStart(o[0],0).collapse(!0).select();var a={html:"<table><tbody><tr><td>hello1</td><td ></td></tr><tr><td >hello2</td><td ></td></tr></tbody></table><p>hello2</p>"};e.fireEvent("beforepaste",a),stop(),setTimeout(function(){equal(a.html,"<p>hello2</p>","表格中不能粘完整的表格"),start()},50)}),test("  trace 3729 从外面粘贴表格到表格-在caption中粘贴,只粘贴文本内容",function(){var e=te.obj[0],t=te.obj[1];e.setContent(""),e.execCommand("inserttable",{numCols:3,numRows:3});var o=e.body.getElementsByTagName("td");t.setStart(o[0],0).collapse(!0).select(),e.execCommand("insertcaption"),t.setStart(e.body.getElementsByTagName("caption")[0],0).collapse(!0).select();var a={html:"<table><tbody><tr><td>hello1</td><td ></td></tr></tbody></table>"};e.fireEvent("beforepaste",a),stop(),setTimeout(function(){equal(a.html,"hello1","在caption中粘贴,只粘贴文本内容"),start()},50)}),test("getText,取表格内的文本",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<table><tbody><tr><td>  hello1</td><td ></td></tr><tr><td >hello2</td><td ></td></tr></tbody></table>"),stop(),setTimeout(function(){var o=e.body.firstChild.getElementsByTagName("tr");t.setStart(o[0].cells[0],0).collapse(!0).select();var a=e.getUETable(e.body.firstChild),l=a.getCellsRange(o[0].cells[0],o[1].cells[0]);a.setSelected(l),setTimeout(function(){ua.manualDeleteFillData(e.body),equal(e.selection.getText(),"hello1hello2"),start()},50)},50)}),test("在第一个单元格里最前面回车,且表格前面没有内容",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable",{numCols:3,numRows:3});var o=e.body.firstChild.getElementsByTagName("tr"),a=e.getUETable(e.body.firstChild),l=a.getCellsRange(o[0].cells[0],o[1].cells[0]);a.setSelected(l),t.setStart(o[0].cells[0],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:13}),stop(),setTimeout(function(){ua.manualDeleteFillData(e.body),equal(e.body.firstChild.innerHTML,ua.browser.ie?"&nbsp;":"<br>","表格前插入空行"),equal(e.body.firstChild.tagName.toLowerCase(),"p","表格前插入空行"),equal(e.body.childNodes[1].tagName.toLowerCase(),"table","表格在空行后面"),start()},50)}),test("delete 事件",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable",{numCols:3,numRows:3}),expect(4),e.addListener("saveScene",function(){ok(!0)});var o=e.body.firstChild.getElementsByTagName("tr");o[0].cells[0].innerHTML="hello",o[1].cells[0].innerHTML="hello";var a=e.getUETable(e.body.firstChild),l=a.getCellsRange(o[0].cells[0],o[1].cells[0]);a.setSelected(l),t.setStart(o[0].cells[0],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:46}),stop(),setTimeout(function(){ua.manualDeleteFillData(e.body),o=e.body.firstChild.getElementsByTagName("tr"),equal(o[0].cells[0].innerHTML,ua.browser.ie?"":"<br>","内容"),equal(o[1].cells[0].innerHTML,ua.browser.ie?"":"<br>","内容"),start()},20)}),test("trace 3047 ,3545 全屏插入表格",function(){if(!(ua.browser.gecko||ua.browser.ie&&ua.browser.ie<9)){var e=document.body.appendChild(document.createElement("div"));$(e).css("width","500px").css("height","500px").css("border","1px solid #ccc");var t=te.obj[2];t.render(e),stop(),t.ready(function(){t.setContent("<p></p>"),t.ui.setFullScreen(!t.ui.isFullScreen()),t.execCommand("inserttable");var o=t.body.getElementsByTagName("td")[0].width;setTimeout(function(){t.ui.setFullScreen(!t.ui.isFullScreen()),setTimeout(function(){var a=t.body.getElementsByTagName("td")[0].width;ok(o-a>10,"页面宽度自适应"),e.parentNode.removeChild(e),start()},500)},500)})}}),test("backspace事件:删除caption",function(){if(!(ua.browser.ie&&ua.browser.ie>8)){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable",{numCols:3,numRows:3}),stop(),setTimeout(function(){var o=e.body.firstChild.getElementsByTagName("tr");t.setStart(o[0].cells[0],0).collapse(!0).select(),e.execCommand("insertcaption"),ua.keydown(e.body,{keyCode:8}),setTimeout(function(){equal(e.body.getElementsByTagName("caption").length,0,"删除caption"),equal(e.selection.getRange().collapsed,!0,"检查光标"),equal(e.selection.getRange().startContainer,e.body.getElementsByTagName("td")[0],"检查光标"),start()},500)},50)}}),test("backspace事件:deleterow",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable",{numCols:3,numRows:3}),stop(),setTimeout(function(){var o=e.body.firstChild.getElementsByTagName("tr"),a=e.getUETable(e.body.firstChild),l=a.getCellsRange(o[0].cells[0],o[0].cells[2]);a.setSelected(l),t.setStart(o[0].cells[0],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:8}),setTimeout(function(){equal(e.body.getElementsByTagName("tr").length,2,"删除整行"),(!ua.browser.ie||ua.browser.ie<9)&&(equal(e.selection.getRange().collapsed,!0,"检查光标"),equal(e.selection.getRange().startContainer,e.body.getElementsByTagName("td")[0],"检查光标")),start()},100)},50)}),test("backspace事件:deletecol",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable",{numCols:3,numRows:3}),stop(),setTimeout(function(){var o=e.body.firstChild.getElementsByTagName("tr"),a=e.getUETable(e.body.firstChild),l=a.getCellsRange(o[0].cells[0],o[2].cells[0]);a.setSelected(l),t.setStart(o[0].cells[0],0).collapse(!0).select(),setTimeout(function(){ua.keydown(o[0].cells[0],{keyCode:8}),setTimeout(function(){equal(e.body.getElementsByTagName("tr")[0].getElementsByTagName("td").length,2,"删除整列"),(!ua.browser.ie||ua.browser.ie<9)&&(equal(e.selection.getRange().collapsed,!0,"检查光标"),equal(e.selection.getRange().startContainer,e.body.getElementsByTagName("td")[0],"检查光标")),start()},100)},50)},100)}),test("表格名称中backspace键",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable",{numCols:3,numRows:3}),stop(),setTimeout(function(){var o=e.body.firstChild.getElementsByTagName("tr");t.setStart(o[0].cells[0],0).collapse(!0).select(),e.execCommand("insertcaption"),t.setStart(e.body.getElementsByTagName("caption")[0],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:8}),setTimeout(function(){equal(e.body.getElementsByTagName("caption").length,0,"删除caption"),equal(e.body.getElementsByTagName("table").length,1,"不会增加表格数量"),equal(e.body.getElementsByTagName("tr").length,3,"不会增加表格行数量"),equal(e.body.getElementsByTagName("tr")[0].cells.length,3,"不会增加表格列数量"),(!ua.browser.ie||ua.browser.ie<9)&&(equal(e.selection.getRange().collapsed,!0,"检查光标"),equal(e.selection.getRange().startContainer,e.body.getElementsByTagName("td")[0],"检查光标")),start()},100)},200)}),test("trace 3097 标题行中backspace键",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable",{numCols:3,numRows:3});var o=e.body.firstChild.getElementsByTagName("tr");t.setStart(o[0].cells[0],0).collapse(!0).select(),e.execCommand("insertcaption"),t.setStart(e.body.getElementsByTagName("caption")[0],0).collapse(!0).select();t.cloneRange();e.execCommand("inserttitle"),t.setStart(e.body.getElementsByTagName("th")[0],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:8}),stop(),setTimeout(function(){e=te.obj[0],equal(e.body.getElementsByTagName("caption").length,1,"不会删除caption"),equal(e.body.getElementsByTagName("th").length,3,"不会误删除标题行"),equal(e.body.getElementsByTagName("table").length,1,"不会增加表格数量"),equal(e.body.getElementsByTagName("tr").length,4,"不会增加表格行数量"),equal(e.body.getElementsByTagName("tr")[0].cells.length,3,"不会增加表格列数量"),equal(e.selection.getRange().collapsed,!0,"检查光标"),o[0].cells[0].innerHTML="hello",equal(o[0].cells[0].innerHTML,"hello","检查光标"),start()},50)}),test("拖拽",function(){if(!(ua.browser.ie&&ua.browser.ie<8)){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable"),ua.manualDeleteFillData(e.body);var o=te.obj[0].body.getElementsByTagName("td"),a=o[1].width;ua.mousemove(o[1],{clientX:199,clientY:100}),equal(e.body.style.cursor,"col-resize","检查鼠标显示"),ua.mousedown(o[1],{clientX:199,clientY:100}),setTimeout(function(){ua.mousemove(o[1],{clientX:299,clientY:100}),ua.mouseup(o[1],{clientX:299,clientY:100});ua.getMousePosition;setTimeout(function(){var e=o[1].width;ok(e-a>50,"拖拽后单元格宽度改变"),start()},50)},400),stop()}}),test("拖拽_row-resize鼠标显示",function(){if(!(ua.browser.ie&&ua.browser.ie<8)){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable"),ua.manualDeleteFillData(e.body);var o=te.obj[0].body.getElementsByTagName("td");o[1].width;ua.mousemove(o[4],{clientX:450,clientY:39}),equal(e.body.style.cursor,"row-resize","row-resize鼠标显示"),expect(3),setTimeout(function(){e.addListener("tablemouseout",function(t,o,a){same(o,e.body.getElementsByTagName("table")[0],"tablemouseout事件,传入的参数正确")}),ua.mouseout(o[1],{clientX:299,clientY:35}),setTimeout(function(){equal(e.body.style.cursor,"text","焦点转移,row-resize不显示"),start()},50)},20),stop()}}),test("拖拽-最右边的单元格",function(){if(!(ua.browser.ie&&ua.browser.ie<8)){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable"),ua.manualDeleteFillData(e.body);var o=te.obj[0].body.getElementsByTagName("td"),a=o[4].width;ua.mousemove(o[4],{clientX:492,clientY:21}),equal(e.body.style.cursor,"col-resize","检查鼠标显示"),ua.mousedown(o[4],{clientX:492,clientY:21}),setTimeout(function(){ua.mousemove(o[4],{clientX:481,clientY:21}),ua.mouseup(o[4],{clientX:481,clientY:21}),setTimeout(function(){var e=te.obj[0].body.getElementsByTagName("td")[4].width;ok(a!=e,"拖拽后单元格宽度改变"),start()},50)},400),stop()}}),test("拖拽-最下边的单元格",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable");var o=te.obj[0].body.getElementsByTagName("td"),a=o[20].height;ua.mousemove(o[24],{clientX:439,clientY:512}),ua.mousedown(o[24],{clientX:439,clientY:512}),equal(e.body.style.cursor,"row-resize","检查鼠标显示"),setTimeout(function(){ua.mousemove(o[24],{clientX:439,clientY:562}),ua.mouseup(o[24],{clientX:439,clientY:562}),setTimeout(function(){var e=te.obj[0].body.getElementsByTagName("td")[20].height;ok(e-a>10,"拖拽后单元格宽度改变"),start()},50)},400),stop()}),test("trace 3022 表格名称中backspace、ctrl+z、enter",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable",{numCols:3,numRows:3}),e.addListener("saveScene",function(){ok(!0)}),stop(),setTimeout(function(){var o=e.body.firstChild.getElementsByTagName("tr");t.setStart(o[0].cells[0],0).collapse(!0).select(),e.execCommand("insertcaption"),ua.keydown(e.body,{keyCode:8}),setTimeout(function(){t.setStart(o[0].cells[0],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:90,ctrlKey:!0}),setTimeout(function(){ua.keydown(e.body,{keyCode:13}),equal(te.obj[0].body.getElementsByTagName("caption").length,1,"撤销删除caption"),equal(te.obj[0].body.getElementsByTagName("th").length,0,"不会误插入标题行"),equal(te.obj[0].body.getElementsByTagName("table").length,1,"不会增加表格数量"),equal(te.obj[0].body.getElementsByTagName("tr").length,3,"不会增加表格行数量"),equal(te.obj[0].body.getElementsByTagName("tr")[0].cells.length,3,"不会增加表格列数量"),equal(te.obj[0].selection.getRange().collapsed,!0,"检查光标"),ua.browser.gecko||ua.browser.webkit||equal(te.obj[0].selection.getRange().startContainer.parentNode,te.obj[0].body.getElementsByTagName("td")[0],"检查光标"),start()},20)},20)},50)}),test("trace 3067 向右合并--tab键",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable",{numCols:2,numRows:2}),ua.manualDeleteFillData(e.body);var o=e.body.getElementsByTagName("td");t.setStart(o[0],0).collapse(!0).select(),e.execCommand("mergeright"),t.setStart(o[0],0).collapse(!0).select(),t=e.selection.getRange();var a=t.getCommonAncestor(!0,!0);equal(a.colSpan,2,"tab键前光标位于合并后的单元格中"),ua.keydown(e.body,{keyCode:9}),setTimeout(function(){t=e.selection.getRange(),a=t.getCommonAncestor(!0,!0),equal(a.colSpan,1,"tab键前光标跳到合并后单元格的下一个单元格中"),start()},20),stop()}),test("trace 3100 表格名称中tab键",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable",{numCols:3,numRows:3});var o=e.body.firstChild.getElementsByTagName("tr");t.setStart(o[0].cells[0],0).collapse(!0).select(),e.execCommand("insertcaption"),t.setStart(e.body.getElementsByTagName("caption")[0],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:9}),stop(),setTimeout(function(){e=te.obj[0],equal(e.body.getElementsByTagName("caption").length,1,"不会删除caption"),equal(e.body.getElementsByTagName("th").length,0,"不会误插入标题行"),equal(e.body.getElementsByTagName("table").length,1,"不会增加表格数量"),equal(e.body.getElementsByTagName("tr").length,3,"不会增加表格行数量"),equal(e.body.getElementsByTagName("tr")[0].cells.length,3,"不会增加表格列数量"),equal(e.selection.getRange().collapsed,!0,"检查光标"),ua.browser.ie||equal(e.selection.getRange().startContainer,te.obj[0].body.getElementsByTagName("td")[0],"检查光标"),start()},50)}),test("trace 3059 表格右浮动",function(){if(!ua.browser.ie){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable"),ua.manualDeleteFillData(e.body);var o=te.obj[0].body.getElementsByTagName("td"),a=o[0].offsetWidth;ua.mousemove(o[0],{clientX:105,clientY:20}),ua.mousedown(o[0],{clientX:105,clientY:20}),ua.mouseup(o[0],{clientX:105,clientY:20}),setTimeout(function(){ua.mousedown(o[0],{clientX:105,clientY:20}),ua.mouseup(o[0],{clientX:105,clientY:20}),setTimeout(function(){o=e.body.firstChild.getElementsByTagName("td"),ok(o[0].offsetWidth<a,"第一列宽度变小"),t.setStart(o[0],0).collapse(!0).select(),e.execCommand("tablealignment","right");var l=te.obj[0].body.getElementsByTagName("table")[0];equal(l.align,"right","表格右浮动"),start()},500)},50),stop()}}),test("trace 3378：拖拽后tab，不影响表格样式",function(){if(!(ua.browser.ie&&ua.browser.ie<8)){var e=te.obj[0],t=te.obj[1];e.setContent("<p></p>"),t.setStart(e.body.firstChild,0).collapse(!0).select(),e.execCommand("inserttable"),ua.manualDeleteFillData(e.body);var o=te.obj[0].body.getElementsByTagName("td"),a=o[1].width;ua.mousemove(o[1],{clientX:199,clientY:100}),ua.mousedown(o[1],{clientX:199,clientY:100}),setTimeout(function(){ua.mousemove(o[1],{clientX:299,clientY:100}),ua.mouseup(o[1],{clientX:299,clientY:100});var l=o[1].width;ok(l-a>50,"拖拽后单元格宽度改变"),t.setStart(o[24],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:9}),setTimeout(function(){equal(o[1].width,l,"tab键不影响单元格宽度"),start()},20)},400),stop()}}),test("表格粘贴",function(){var e=(document.body.appendChild(document.createElement("div")),te.obj[0]),t=te.obj[1];e.setContent(""),e.execCommand("inserttable");var o=e.body.getElementsByTagName("td"),a=e.getUETable(e.body.firstChild),l=a.getCellsRange(o[0],o[24]);a.setSelected(l),t.setStart(o[0],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:67,ctrlKey:!0});var s={html:e.body.innerHTML};t.setStart(e.body.lastChild,0).collapse(!0).select(),equal(e.body.getElementsByTagName("table").length,"1","触发粘贴事件前有1个table"),e.fireEvent("beforepaste",s),e.fireEvent("afterpaste"),equal(e.body.getElementsByTagName("table").length,"2","触发粘贴事件后有2个table")}),test("trace 3105 在表格名称中粘贴",function(){var e=(document.body.appendChild(document.createElement("div")),te.obj[0]),t=te.obj[1];e.setContent(""),e.execCommand("inserttable",{numCols:2,numRows:2}),t.setStart(e.body.getElementsByTagName("td")[0],0).collapse(!0).select(),e.execCommand("insertcaption");var o=ua.getChildHTML(e.body),a=e.getUETable(e.body.firstChild),l=e.body.getElementsByTagName("td"),s=a.getCellsRange(l[0],l[1]);a.setSelected(s),t.setStart(l[0],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:67,ctrlKey:!0});var n={html:e.body.innerHTML};t.setStart(e.body.getElementsByTagName("caption")[0],0).collapse(!0).select(),e.fireEvent("beforepaste",n),e.fireEvent("afterpaste"),a.clearSelected(),equal(e.body.getElementsByTagName("table").length,"1","触发粘贴事件后有1个table"),equal(ua.getChildHTML(e.body),o,"粘贴无效")}),test("trace 3106 粘贴标题行",function(){var e=(document.body.appendChild(document.createElement("div")),te.obj[0]),t=te.obj[1];e.setContent(""),e.execCommand("inserttable");var o=e.body.getElementsByTagName("td");t.setStart(o[0],0).collapse(!0).select(),e.execCommand("inserttitle");var a=e.getUETable(e.body.firstChild),l=e.body.getElementsByTagName("th"),s=a.getCellsRange(l[0],l[4]);a.setSelected(s),t.setStart(l[0],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:67,ctrlKey:!0});var n={html:e.body.innerHTML};t.setStart(e.body.lastChild,0).collapse(!0).select(),e.fireEvent("beforepaste",n),e.fireEvent("afterpaste"),equal(e.body.getElementsByTagName("table").length,"2","触发粘贴事件后有2个table"),ua.browser.gecko?(t.setStart(e.body.firstChild.firstChild.firstChild.firstChild,0).collapse(!0).select(),equal(e.queryCommandState("inserttable"),-1,"应当不可以插入表格"),equal(e.queryCommandState("mergeright"),0,"应当可以右合并单元格")):(t.setStart(e.body.firstChild.nextSibling.firstChild.firstChild.firstChild,0).collapse(!0).select(),equal(e.queryCommandState("inserttable"),-1,"应当不可以插入表格"),equal(e.queryCommandState("mergeright"),0,"应当可以右合并单元格"))}),test("trace 3114 在单元格内粘贴行",function(){var e=(document.body.appendChild(document.createElement("div")),te.obj[0]),t=te.obj[1];e.setContent(""),e.execCommand("inserttable");var o=e.body.getElementsByTagName("td"),a=e.getUETable(e.body.firstChild),l=a.getCellsRange(o[0],o[9]);a.setSelected(l),t.setStart(o[0],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:67,ctrlKey:!0});var s={html:e.body.innerHTML};t.setStart(o[0],0).collapse(!0).select(),e.fireEvent("beforepaste",s),e.fireEvent("afterpaste"),equal(e.body.getElementsByTagName("table").length,"1","触发粘贴事件后有1个table"),stop(),setTimeout(function(){e.execCommand("source"),setTimeout(function(){e.execCommand("source"),equal(e.body.getElementsByTagName("tr").length,"7","触发粘贴事件后有7个tr"),start()},50)},50)}),test("在单元格中粘贴_粘到最后",function(){var e=te.obj[0],t=te.obj[1];e.setContent(""),e.execCommand("inserttable",{numCols:3,numRows:3});var o=e.body.getElementsByTagName("td"),a=e.getUETable(e.body.firstChild),l=a.getCellsRange(o[0],o[4]);a.setSelected(l),t.setStart(o[0],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:67,ctrlKey:!0});var s={html:e.body.innerHTML};t.setStart(o[8],0).collapse(!0).select(),equal(e.body.getElementsByTagName("tr").length,3,"触发粘贴事件前有3个tr"),equal(e.body.getElementsByTagName("td").length,9,"触发粘贴事件前有9个td"),e.fireEvent("beforepaste",s),e.fireEvent("afterpaste"),equal(e.body.getElementsByTagName("tr").length,4,"触发粘贴事件后有4个tr"),equal(e.body.getElementsByTagName("td").length,16,"触发粘贴事件后有12个td")}),test("在单元格中粘贴_整列",function(){var e=te.obj[0],t=te.obj[1];e.setContent(""),e.execCommand("inserttable",{numCols:3,numRows:3});var o=e.body.getElementsByTagName("td");t.setStart(o[0],0).collapse(!0).select(),e.execCommand("inserttitle");var a=e.getUETable(e.body.firstChild),l=a.getCellsRange(o[0],o[6]);a.setSelected(l),t.setStart(o[0],0).collapse(!0).select(),ua.keydown(e.body,{keyCode:67,ctrlKey:!0});var s={html:e.body.innerHTML};t.setStart(o[6],0).collapse(!0).select(),equal(e.body.getElementsByTagName("tr").length,4,"触发粘贴事件前有4个tr"),equal(e.body.getElementsByTagName("th").length,3,"触发粘贴事件前有3个th"),equal(e.body.getElementsByTagName("td").length,9,"触发粘贴事件前有9个td"),e.fireEvent("beforepaste",s),e.fireEvent("afterpaste"),equal(e.body.getElementsByTagName("tr").length,4,"触发粘贴事件后有4个tr"),equal(e.body.getElementsByTagName("th").length,4,"触发粘贴事件前有4个th"),equal(e.body.getElementsByTagName("td").length,12,"触发粘贴事件后有12个td")}),test("点击一行的最左边,选中一行",function(){if(!(ua.browser.ie&&ua.browser.ie<9)){var e=te.obj[0];te.obj[1];e.setContent(""),e.execCommand("inserttable",{numCols:2,numRows:3}),setTimeout(function(){var t=e.body.getElementsByTagName("td");t[0].innerHTML="hello1",t[1].innerHTML="hello2",ua.mousemove(t[0],{clientX:8,clientY:24}),ua.click(t[0],{clientX:8,clientY:24}),setTimeout(function(){var t=ua.browser.ie?"":" ",o=ua.browser.gecko?'"':"";equal(e.body.style.cursor,"url("+o+e.options.cursorpath+"v.png"+o+"),"+t+"pointer");var a=e.getUETable(e.body.firstChild).selectedTds;equal(a.length,2,"选中一行"),equal(a[0].className,"selectTdClass","检查样式"),equal(a[1].className,"selectTdClass","检查样式"),equal(a[0].innerHTML,"hello1","检查内容"),equal(a[1].innerHTML,"hello2","检查内容"),start()},50)},50),stop()}}),test("点击一行的最左边,但是每行只有一列,这时选中单元格中的内容",function(){if(!(ua.browser.ie&&ua.browser.ie<9)){var e=te.obj[0];e.setContent(""),e.execCommand("inserttable",{numCols:1,numRows:1});var t=e.body.getElementsByTagName("td");t[0].innerHTML="hello",setTimeout(function(){window.scrollTo(0,0),ua.click(t[0],{clientX:10,clientY:23}),setTimeout(function(){var o=e.getUETable(e.body.firstChild).selectedTds;equal(o.length,0,"不选中行"),ua.browser.ie>8?ua.checkResult(e.selection.getRange(),t[0].firstChild,t[0].firstChild,0,5,!1,"检查选中的range"):ua.checkResult(e.selection.getRange(),t[0],t[0],0,1,!1,"检查选中的range"),start()},500)},500),stop()}}),test("点击一列的最上边,但是每列只有一行,这时选中单元格中的内容",function(){if(!(ua.browser.ie&&ua.browser.ie<9)){var e=te.obj[0];te.obj[1];e.setContent(""),e.execCommand("inserttable",{numCols:1,numRows:1}),stop(),setTimeout(function(){var t=e.body.getElementsByTagName("td");t[0].innerHTML="hello",window.scrollTo(0,0),ua.click(t[0],{clientX:81,clientY:9,pageX:81,pageY:9}),setTimeout(function(){var o=e.getUETable(e.body.firstChild).selectedTds;equal(o.length,0,"不选中列"),ua.browser.ie>8?ua.checkResult(e.selection.getRange(),t[0].firstChild,t[0].firstChild,0,5,!1,"检查选中的range"):ua.checkResult(e.selection.getRange(),t[0],t[0],0,1,!1,"检查选中的range"),start()},10)},50)}}),test("点击一列的最上边,选中一列",function(){if(!(ua.browser.ie&&ua.browser.ie<9)){var e=te.obj[0];te.obj[1];e.setContent(""),e.execCommand("inserttable",{numCols:3,numRows:3}),stop(),setTimeout(function(){var t=e.body.getElementsByTagName("td");t[0].innerHTML="hello",window.scrollTo(0,0),ua.mousemove(t[0],{clientX:81,clientY:9});var o=ua.browser.ie?"":" ",a=ua.browser.gecko?'"':"";equal(e.body.style.cursor,"url("+a+e.options.cursorpath+"h.png"+a+"),"+o+"pointer"),ua.click(t[0],{clientX:81,clientY:9}),setTimeout(function(){var t=e.getUETable(e.body.firstChild).selectedTds;equal(t.length,3,"选中一列"),equal(t[0].innerHTML,"hello","检查内容"),equal(t[0].className,"selectTdClass","检查样式"),equal(t[1].className,"selectTdClass","检查样式"),equal(t[2].className,"selectTdClass","检查样式"),start()},500)},50)}});