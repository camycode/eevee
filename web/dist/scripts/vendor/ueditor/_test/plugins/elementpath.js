module("plugins.elementpath"),test("表格",function(){var e=document.body.appendChild(document.createElement("div"));e.id="ue";var t=UE.getEditor("ue",{initialContent:"<p>欢迎使用ueditor</p>",elementPathEnabled:!0,autoFloatEnabled:!1});t.ready(function(){var e=new baidu.editor.dom.Range(t.document);t.setContent('<table><tbody><tr><td>hello1</td><td><strong>strongText</strong>hello2<span style="text-decoration: underline">spanText</span></td></tr></tbody></table>');var a=t.body;e.selectNode(a.firstChild).select();var d=t.queryCommandValue("elementpath");ua.checkElementPath(d,["body","table","tbody","tr","td"],"选中整个表格");var l=a.getElementsByTagName("td");e.setStart(l[0].firstChild,0).collapse(!0).select(),ua.checkElementPath(d,["body","table","tbody","tr","td"],"在单元格中单击"),ua.manualDeleteFillData(t.body),e.setStart(l[1].firstChild.firstChild,1).collapse(!0).select(),d=t.queryCommandValue("elementpath"),ua.checkElementPath(d,["body","table","tbody","tr","td","strong"],"在单元格中的加粗文本中单击"),ua.manualDeleteFillData(t.body),e.setStart(l[1].lastChild.firstChild,1).collapse(!0).select(),d=t.queryCommandValue("elementpath"),ua.checkElementPath(d,["body","table","tbody","tr","td","span"],"在单元格中的下划线文本中单击"),ua.manualDeleteFillData(t.body),e.setStart(l[1].lastChild.lastChild,1).setEnd(l[1].lastChild.lastChild,4).select(),d=t.queryCommandValue("elementpath"),ua.checkElementPath(d,["body","table","tbody","tr","td","span"],"选中有下划线的文本"),setTimeout(function(){UE.delEditor("ue"),te.dom.push(document.getElementById("ue")),start()},200)}),stop()}),test(" 通过选区路径取range",function(){var e=te.obj[0],t=te.obj[1];e.options.elementPathEnabled=!0,e.setContent("<table><tbody><tr><td>1</td><td>2</td></tr><tr><td>3</td><td>45</td></tr></tbody></table>"),stop(),setTimeout(function(){var a=e.body.getElementsByTagName("td"),d=e.body.getElementsByTagName("tr"),l=e.body.getElementsByTagName("tbody"),n=e.body.getElementsByTagName("table");t.setStart(a[3].firstChild,0).collapse(!0).select(),e.queryCommandValue("elementpath"),e.execCommand("elementpath","4"),setTimeout(function(){t=e.selection.getRange(),ua.browser.gecko||ua.browser.webkit?ua.checkResult(t,d[1],d[1],1,2,!1,"取range--td"):ua.browser.ie?ua.checkResult(t,a[3].firstChild,a[3].lastChild,0,2,!1,"取range--td"):ua.checkResult(t,a[3].firstChild,e.body,0,1,!1,"取range--td"),t.setStart(a[3].firstChild,1).collapse(1).select(),e.execCommand("elementpath","3"),setTimeout(function(){t=e.selection.getRange(),ua.browser.gecko||ua.browser.webkit?ua.checkResult(t,l[0],l[0],1,2,!1,"取range--tr"):ua.browser.ie?ua.checkResult(t,a[2].firstChild,a[3].lastChild,0,2,!1,"取range--tr"):ua.checkResult(t,a[2].firstChild,e.body,0,1,!1,"取range--tr"),t.setStart(a[3].firstChild,0).collapse(1).select(),e.execCommand("elementpath","2"),setTimeout(function(){t=e.selection.getRange(),ua.browser.gecko||ua.browser.webkit?ua.checkResult(t,n[0],n[0],0,1,!1,"取range--tbody"):ua.browser.ie?ua.checkResult(t,a[0].firstChild,a[3].lastChild,0,2,!1,"取range--tbody"):ua.checkResult(t,e.body,e.body,0,1,!1,"取range--tbody"),e.setContent("<p>45645</p>"),t.selectNode(e.body.firstChild).select(),e.queryCommandValue("elementpath"),e.execCommand("elementpath",1),setTimeout(function(){t=e.selection.getRange();var a=e.body.firstChild;ua.browser.gecko||ua.browser.webkit?ua.checkResult(t,e.body,e.body,0,1,!1,"取range--p"):ua.checkResult(t,a.firstChild,a.firstChild,0,5,!1,"取range--p"),start()},20)},20)},100)},20)},50)}),test("trace 1539:列表",function(){var e=document.body.appendChild(document.createElement("div")),t=new baidu.editor.Editor({initialContent:"<p>欢迎使用ueditor</p>",elementPathEnabled:!0,autoFloatEnabled:!1});stop(),setTimeout(function(){t.render(e),t.ready(function(){var a=new baidu.editor.dom.Range(t.document);t.setContent("<ol><li>hello1</li><li>hello2<br><table><tbody><tr><td>hello3</td></tr></tbody></table></li></ol>");var d=t.body;a.selectNode(d.firstChild).select();var l=t.queryCommandValue("elementpath");ua.checkElementPath(l,["body","ol","li","p"],"选中整个列表"),a.selectNode(d.firstChild.getElementsByTagName("table")[0]).select(),l=t.queryCommandValue("elementpath"),ua.checkElementPath(l,["body","ol","li","table","tbody","tr","td"],"选中列表中的表格"),a.setStart(d.firstChild.firstChild.nextSibling.firstChild.firstChild,6).collapse(!0).select(),l=t.queryCommandValue("elementpath"),ua.checkElementPath(l,["body","ol","li","p"],"选中列表中的br"),e.parentNode.removeChild(e),start()})},20)}),test("文本和超链接",function(){var e=document.body.appendChild(document.createElement("div")),t=new baidu.editor.Editor({initialContent:"<p>欢迎使用ueditor</p>",elementPathEnabled:!0,autoFloatEnabled:!1});t.render(e),stop(),t.ready(function(){var a=new baidu.editor.dom.Range(t.document);t.setContent("<div><p>hello<a>a_link</a></p></div>");var d=t.body;a.selectNode(d.firstChild.firstChild).select();var l=t.queryCommandValue("elementpath");ua.checkElementPath(l,["body","p"],"选中文本"),a.selectNode(d.firstChild.lastChild.firstChild).select(),l=t.queryCommandValue("elementpath"),ua.checkElementPath(l,["body","p","a"],"选中文本"),e.parentNode.removeChild(e),start()})}),test("图片",function(){if(!(ua.browser.ie>8)){var e=document.body.appendChild(document.createElement("div"));e.id="ue";var t=UE.getEditor("ue",{initialContent:"<p>欢迎使用ueditor</p>",elementPathEnabled:!0,autoFloatEnabled:!1});stop(),t.ready(function(){var e=new baidu.editor.dom.Range(t.document);t.setContent("<div><p>hello<img /></p></div>");var a=t.body;setTimeout(function(){e.selectNode(a.firstChild.lastChild).select();var d=t.queryCommandValue("elementpath");ua.checkElementPath(d,["body","p","img"],"选中图片"),setTimeout(function(){UE.delEditor("ue"),te.dom.push(document.getElementById("ue")),start()},200)},20)})}}),test("锚点",function(){if(!(ua.browser.ie>8)){var e=document.body.appendChild(document.createElement("div")),t=new baidu.editor.Editor({initialContent:"<p>欢迎使用ueditor</p>",elementPathEnabled:!0,autoFloatEnabled:!1});t.render(e),stop(),t.ready(function(){var a=new baidu.editor.dom.Range(t.document);t.setContent('<div><p>hello<img anchorname="hello" class="anchorclass"></p></div>');var d=t.body;setTimeout(function(){a.selectNode(d.firstChild.lastChild).select();var l=t.queryCommandValue("elementpath");ua.checkElementPath(l,["body","p","anchor"],"选中锚点"),e.parentNode.removeChild(e),start()},20)})}}),test("文本",function(){var e=document.body.appendChild(document.createElement("div")),t=new baidu.editor.Editor({initialContent:"<p>欢迎使用ueditor</p>",elementPathEnabled:!0,autoFloatEnabled:!1});t.render(e),stop(),t.ready(function(){var a=new baidu.editor.dom.Range(t.document);t.setContent("hello");var d=t.body;setTimeout(function(){a.setStart(d.firstChild.firstChild,1).setEnd(d.firstChild.firstChild,3).select();var l=t.queryCommandValue("elementpath");ua.checkElementPath(l,["body","p"],"选中文本"),e.parentNode.removeChild(e),start()},20)})}),test("trace 3995表格和文本",function(){if(11!=ua.browser.ie){var e=document.body.appendChild(document.createElement("div")),t=new baidu.editor.Editor({initialContent:"<p>欢迎使用ueditor</p>",elementPathEnabled:!0,autoFloatEnabled:!1});t.render(e),stop(),t.ready(function(){var a=new baidu.editor.dom.Range(t.document),d=t.body;a.setStart(d.firstChild.firstChild,2).collapse(!0).select(),t.execCommand("inserttable"),setTimeout(function(){a.selectNode(d).select();var l=t.queryCommandValue("elementpath");t.execCommand("elementpath",1),ua.checkElementPath(l,["body","p"],"选中文本和表格"),a.selectNode(d.firstChild.nextSibling).select(),l=t.queryCommandValue("elementpath"),ua.checkElementPath(l,["body","table"],"选中表格"),t.execCommand("elementpath",4),l=t.queryCommandValue("elementpath"),ua.checkElementPath(l,["body","table","tbody","tr","td"],"选中表格"),e.parentNode.removeChild(e),start()},20)})}});