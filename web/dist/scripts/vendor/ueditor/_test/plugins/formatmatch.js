module("plugins.formatmatch"),test("为一行无格式的文字刷2种不同的格式",function(){var t=te.obj[0],e=te.obj[1];t.setContent("<p><strong>first</strong></p><p><em>second</em></p><p>third</p>"),setTimeout(function(){var o=t.body;e.setStart(o.firstChild.firstChild.firstChild,2).collapse(!0).select(),t.execCommand("formatmatch"),e.selectNode(o.lastChild.firstChild).select(),ua.mouseup(o),t.addListener("mouseup",function(){equal(t.queryCommandState("formatmatch"),0,"刷后状态为0"),equal(o.lastChild.innerHTML.toLowerCase(),"<em>third</em>"),start()}),e.setStart(o.lastChild.previousSibling.firstChild.firstChild,2).collapse(!0).select(),t.execCommand("formatmatch"),e.selectNode(o.lastChild.firstChild).select(),ua.mouseup(o)},50),stop()}),test("trace 971:有格式文字刷自己",function(){var t=te.obj[0],e=te.obj[1];t.setContent("<p><strong>欢迎光临</strong></p>"),setTimeout(function(){var o=t.body,s=o.firstChild.firstChild.firstChild;e.setStart(s,2).collapse(!0).select(),t.addListener("mouseup",function(){equal(t.getContent(),"<p><strong>欢</strong><strong>迎光临</strong></p>"),start()}),t.execCommand("formatmatch"),e.setStart(s,0).setEnd(s,1).select(),ua.mouseup(t.body)},50),stop()}),test("格式刷的状态反射：非闭合区间",function(){var t=te.obj[0],e=te.obj[1];t.setContent("hello"),setTimeout(function(){var o=t.body;e.setStart(o.firstChild.firstChild,2).collapse().select(),t.addListener("mouseup",function(){equal(t.queryCommandState("formatmatch"),0,"刷后状态为0"),start()}),t.execCommand("formatmatch"),equal(t.queryCommandState("formatmatch"),1,"刷前状态为1"),e.setStart(o.firstChild.firstChild,0).setEnd(o.firstChild.firstChild,2).select(),ua.mouseup(t.body)},50),stop()}),test("默认格式图片刷有格式的图片",function(){var t=te.obj[0],e=te.obj[1];t.setContent('hello<img width="200px" height="200px" style="float: left;background-color: red"/><img width="100px" height="200px"/>'),setTimeout(function(){var o=t.body.firstChild.lastChild,s=o.previousSibling;e.selectNode(o).select(),t.addListener("mouseup",function(){equal(t.queryCommandState("formatmatch"),0,"刷后状态为0"),ua.browser.opera||equal(s.style.cssFloat||s.style.styleFloat,"none","check style float","float"),equal(s.style.backgroundColor,"red","check background color"),start()}),t.execCommand("formatmatch"),e.selectNode(s).select(),ua.mouseup(t.body)},50),stop()}),test("有浮动方式图片刷默认的图片",function(){var t=te.obj[0],e=te.obj[1];t.setContent('hello<img width="200px" height="200px" style="float: left;background-color: red;width: 200px"/><img width="100px" height="200px"/>'),setTimeout(function(){var o=t.body.firstChild.lastChild.previousSibling,s=o.nextSibling;e.selectNode(o).select(),t.addListener("mouseup",function(){equal(t.queryCommandState("formatmatch"),0,"刷后状态为0"),ua.browser.opera||equal(s.style.cssFloat||s.style.styleFloat,"left","check style float"),equal(s.style.backgroundColor,"","check background color"),equal(s.style.width,"","check style width"),equal($(s).attr("width"),100,"check width"),start()}),t.execCommand("formatmatch"),e.selectNode(s).select(),ua.mouseup(t.body)},50),stop()}),test("独占一行图片刷默认的图片",function(){var t=te.obj[0],e=te.obj[1];t.setContent('hello<img width="200px" height="200px" style="background-color: red;width: 200px;display:block;"/><img width="100px" height="200px"/>'),setTimeout(function(){var o=t.body.firstChild.lastChild.previousSibling,s=o.nextSibling;e.selectNode(o).select(),t.addListener("mouseup",function(){equal(t.queryCommandState("formatmatch"),0,"刷后状态为0"),ua.browser.opera||equal(s.style.display,"block","check display block"),start()}),t.execCommand("formatmatch"),e.selectNode(s).select(),ua.mouseup(t.body)},50),stop()}),test("默认的图片图片刷独占一行图片",function(){var t=te.obj[0],e=te.obj[1];t.setContent('hello<img width="200px" height="200px" style="background-color: red;width: 200px;display:block;"/><img width="100px" height="200px"/>'),setTimeout(function(){var o=t.body.firstChild.lastChild,s=o.previousSibling;e.selectNode(o).select(),t.addListener("mouseup",function(){equal(t.queryCommandState("formatmatch"),0,"刷后状态为0"),ua.browser.opera||equal(s.style.display,"inline","check display block"),start()}),t.execCommand("formatmatch"),e.selectNode(s).select(),ua.mouseup(t.body)},50),stop()}),test("trace 939:字母列表刷表格内的字母列表",function(){var t=te.obj[0],e=te.obj[1];t.setContent('<ol style="list-style-type: lower-alpha;"><li>first</li><li>second</li></ol> <table><tbody><tr><td><ol style="list-style-type: lower-alpha;"><li>third</li><li>fourth</li></ol></td></tr></tbody></table>'),setTimeout(function(){e.selectNode(t.body.firstChild).select(),t.execCommand("formatmatch"),t.addListener("mouseup",function(){setTimeout(function(){equal(t.body.lastChild.getElementsByTagName("ol")[0].style.listStyleType,"lower-alpha","查看列表是否仍然是字母的"),start()},250)}),e.selectNode(t.body.lastChild).select(),ua.mouseup(t.body)},50),stop()}),test("用格式刷刷整个表格",function(){var t=te.obj[0],e=te.obj[1];t.setContent('<p><span style="background: yellow">hello</span></p><table><tbody><tr><td></td></tr></tbody></table>'),setTimeout(function(){e.selectNode(t.body.firstChild).select(),t.addListener("mouseup",function(){equal(t.body.innerHTML.indexOf("match"),-1,"没有插入match占位符"),start()}),t.execCommand("formatmatch"),e.selectNode(t.body.lastChild).select(),t.currentSelectedArr=[t.body.lastChild.getElementsByTagName("td")[0]],ua.mouseup(t.body)},50),stop()}),test("表格刷文本",function(){var t=te.obj[0],e=te.obj[1];t.setContent('<p><span style="background: yellow">hello</span></p><table><tbody><tr><td>hello2</td></tr></tbody></table>'),setTimeout(function(){e.selectNode(t.body.lastChild).select(),t.addListener("mouseup",function(){equal(t.body.firstChild.innerHTML,"hello"," 去掉hello的格式"),start()}),t.execCommand("formatmatch"),setTimeout(function(){e.selectNode(t.body.firstChild).select(),ua.mouseup(t.body)},50)},50),stop()}),test("trace 1096，1761:表格刷表格",function(){var t=te.obj[0],e=te.obj[1];t.setContent('<p><span style="background: yellow">hello</span></p><table><tbody><tr><td>hello2</td><td></td></tr><tr><td></td><td>hello3</td></tr></tbody></table>'),setTimeout(function(){var o=t.body.lastChild.getElementsByTagName("tr"),s=t.getUETable(t.body.lastChild),l=s.getCellsRange(o[0].cells[0],o[1].cells[0]);s.setSelected(l),e.setStart(o[0].cells[0],0).collapse(!0).select();var a=t.body.lastChild.getElementsByTagName("td");t.addListener("mouseup",function(){ok(ua.isEqualArray(s.selectedTds,[o[0].cells[0],o[1].cells[0]]),"比较选择的区域");for(var t=0;t<a.length;t++)equal(a[t].style.borderColor,a[0].style.borderColor,"表格边框颜色相同");start()}),t.execCommand("formatmatch"),e.setStart(a[1],0).setEnd(a[3],1).select(),ua.mouseup(t.body)},50),stop()}),test("文本刷a标签(闭合)",function(){var t=te.obj[0],e=te.obj[1];t.setContent('hello<a href="http://www.baidu.com/">baidu</a>'),setTimeout(function(){var o=t.body.firstChild;o.lastChild;e.selectNode(o.firstChild).select(),t.execCommand("forecolor","rgb(255,0,0)"),t.addListener("mouseup",function(){var e=o.lastChild;ua.clearWhiteNode(e),equal(e.childNodes.length,3,"3子节点"),ua.checkHTMLSameStyle('ba<span style="color: rgb(255,0,0)"></span>idu',t.document,e,"check style"),start()}),e.selectNode(o.firstChild).select(),t.execCommand("formatmatch"),e.setStart(o.lastChild.firstChild,2).collapse(!0).select(),ua.mouseup(t.body)},50),stop()}),test("点了格式刷后不刷文本再点一次格式刷",function(){var t=te.obj[0],e=te.obj[1];t.setContent("<p><strong>first</strong></p><p><em>second</em></p><p>third</p>"),setTimeout(function(){var o=t.body;e.setStart(o.firstChild.firstChild.firstChild,2).collapse(!0).select(),t.addListener("mouseup",function(){equal(t.__allListeners.mouseup.length,s-1,"mouseup的侦听器被删除"),equal(t.queryCommandState("formatmatch"),0,"刷后状态为0"),equal(o.lastChild.innerHTML.toLowerCase(),"third"),start()}),t.execCommand("formatmatch");var s=t.__allListeners.mouseup.length;t.execCommand("formatmatch"),equal(t.__allListeners.mouseup.length,s-1,"如果第一次格式刷没执行，下一次格式刷会先去掉上一个mouseup的侦听器然后直接退出"),ua.mouseup(o)},50),stop()}),test("a标签刷文本",function(){var t=te.obj[0],e=te.obj[1];setTimeout(function(){t.setContent('hello<a href="http://www.baidu.com/"><span style="color: red; ">baidu</span></a>'),setTimeout(function(){var o=t.body.firstChild,s=o.lastChild;e.setStart(s.firstChild.firstChild,1).collapse(!0).select(),t.addListener("mouseup",function(){equal(o.firstChild.innerHTML,"hello","span包含文本"),ok(o.firstChild.style.color,"red","查看文本是否添加了样式"),start()}),t.execCommand("formatmatch"),e.selectNode(o.firstChild).select(),ua.mouseup(t.body)},50)},50),stop()});