module("plugins.keystrokes"),test("trace 3714跨节点输入tab键",function(){var e=te.obj[0];e.setContent('<h1>hello<br></h1><p>he<img src="http://img.baidu.com/hi/jx2/j_0015.gif" />oll</p>');var t=te.obj[1];setTimeout(function(){t.setStart(e.body.lastChild.firstChild,0).setEnd(e.body.lastChild.firstChild.nextSibling,1).select(),ua.keydown(e.body,{keyCode:9}),ua.keyup(e.body,{keyCode:9}),setTimeout(function(){equal(te.obj[0].undoManger.list.length,1,"");var e="<h1>hello<br></h1><p>&nbsp;&nbsp;&nbsp;&nbsp;oll</p>";equal(ua.getChildHTML(te.obj[0].body),e,"跨节点输入tab键"),start()},20)},20),stop()}),test("删除块元素，块元素在后",function(){var e=te.obj[0];e.setContent('<h1>hello<br></h1><h2><img src="http://img.baidu.com/hi/jx2/j_0015.gif" /></h2>');var t=te.obj[1];setTimeout(function(){t.setStart(e.body.lastChild.lastChild,0).setEnd(e.body.lastChild.lastChild,1).select(),ua.keydown(e.body,{keyCode:8}),ua.keyup(e.body,{keyCode:8}),setTimeout(function(){equal(te.obj[0].undoManger.index,1,"");var e="<h1>hello<br></h1>";ua.browser.opera||equal(ua.getChildHTML(te.obj[0].body),e,"删除块元素"),start()},20)},20),stop()}),test("删除块元素，块元素在前",function(){var e=te.obj[0];e.setContent('<h2><img src="http://img.baidu.com/hi/jx2/j_0015.gif" /></h2><h1>hello<br></h1>');var t=te.obj[1];setTimeout(function(){t.setStart(e.body.firstChild,0).setEnd(e.body.firstChild,1).select(),ua.keydown(e.body,{keyCode:8}),ua.keyup(e.body,{keyCode:8}),setTimeout(function(){equal(te.obj[0].undoManger.index,1,"");var e="<h1>hello<br></h1>";equal(ua.getChildHTML(te.obj[0].body),e,"删除块元素"),start()},20)},20),stop()}),test("trace 2747 普通情况,选中一个节点，输入tab键",function(){var e=te.obj[0];e.setContent('<h1>hello<br></h1><p>he<img src="http://img.baidu.com/hi/jx2/j_0015.gif" />oll</p>');var t=te.obj[1];setTimeout(function(){t.setStart(e.body.lastChild,1).setEnd(e.body.lastChild,2).select(),ua.keydown(e.body,{keyCode:9}),ua.keyup(e.body,{keyCode:9}),setTimeout(function(){equal(te.obj[0].undoManger.list.length,1,"");var e="<h1>hello<br></h1><p>he&nbsp;&nbsp;&nbsp;&nbsp;oll</p>";equal(ua.getChildHTML(te.obj[0].body),e,"普通情况，选中一个节点，输入tab键"),start()},20)},20),stop()}),test("trace 2746 删除自闭合标签",function(){var e=te.obj[0];e.setContent('<h1>hello<br></h1><p>he<img src="http://img.baidu.com/hi/jx2/j_0015.gif" />oll</p>');var t=te.obj[1];setTimeout(function(){t.setStart(e.body.lastChild,1).setEnd(e.body.lastChild,2).select(),ua.keydown(e.body,{keyCode:8}),ua.keyup(e.body,{keyCode:8}),setTimeout(function(){equal(te.obj[0].undoManger.index,1,"");var e="<h1>hello<br></h1><p>heoll</p>";equal(ua.getChildHTML(te.obj[0].body),e,"删除自闭合标签"),start()},20)},20),stop()}),test("全选后，退格，剩下空p",function(){var e=te.obj[0];e.setContent("hello");var t=te.obj[1];t.selectNode(e.body.firstChild).select(),e.execCommand("bold"),e.execCommand("selectall"),ua.keydown(e.body,{keyCode:8}),ua.keyup(e.body,{keyCode:8}),stop(),setTimeout(function(){var e=ua.browser.ie?"":"<br>";equal(ua.getChildHTML(te.obj[0].body),"<p>"+e+"</p>","全选后，退格，剩下空p"),start()},20)}),test("在列表中，跨行选中第2，3行，输入tab键",function(){var e=te.obj[0];e.setContent('<ol style="list-style-type:decimal;"><li><p>欢迎使用</p></li><li><p>ueditor</p></li><li><p>ueditor</p></li></ol>');var t=te.obj[1];setTimeout(function(){t.setStart(e.body.childNodes[0].childNodes[1].firstChild.firstChild,1).setEnd(e.body.childNodes[0].childNodes[2].firstChild.firstChild,1).select(),ua.keydown(e.body,{keyCode:9}),ua.keyup(e.body,{keyCode:9}),setTimeout(function(){ua.manualDeleteFillData(te.obj[0].body),equal(te.obj[0].body.firstChild.tagName.toLowerCase(),"ol","原列表"),equal($(te.obj[0].body.firstChild).css("list-style-type"),"decimal","原列表类型"),equal(ua.getChildHTML(te.obj[0].body.firstChild.firstChild),"<p>欢迎使用</p>","第一行保持原来的列表样式"),equal(te.obj[0].body.firstChild.lastChild.tagName.toLowerCase(),"ol","后两行变成第二层列表"),equal($(te.obj[0].body.firstChild.lastChild).css("list-style-type"),"lower-alpha","第二层列表类型"),equal(ua.getChildHTML(te.obj[0].body.firstChild.lastChild),"<li><p>ueditor</p></li><li><p>ueditor</p></li>","检查内容"),start()},20)},50),stop()}),test("在h1内输入del",function(){var e=te.obj[0];e.setContent("<h1><br></h1><p>hello</p>");var t=te.obj[1];setTimeout(function(){t.setStart(e.body.childNodes[0],0).collapse(!0).select(!0),ua.keydown(te.obj[0].body,{keyCode:46}),ua.keyup(te.obj[0].body,{keyCode:46}),setTimeout(function(){equal(ua.getChildHTML(te.obj[0].body),"<h1><br></h1><p>hello</p>","在h1内输入del"),start()},20)},20),stop()}),test("在列表中，跨行选中，输入tab键",function(){var e=te.obj[0];e.setContent('<ol style="list-style-type:decimal;"><li><p>欢迎使用</p></li><li><p>ueditor</p></li><li><p>ueditor</p></li></ol>');var t=te.obj[1];setTimeout(function(){t.setStart(e.body.firstChild.firstChild.firstChild.firstChild,1).setEnd(e.body.firstChild.childNodes[1].firstChild.firstChild,1).select(),ua.keydown(e.body,{keyCode:9}),ua.keyup(e.body,{keyCode:9}),setTimeout(function(){equal(te.obj[0].undoManger.index,1,"undoManger.index"),ua.manualDeleteFillData(te.obj[0].body),equal(te.obj[0].body.firstChild.tagName.toLowerCase(),"ol","外面套了一层ol"),equal(te.obj[0].body.firstChild.childNodes.length,2,""),equal(te.obj[0].body.firstChild.firstChild.tagName.toLowerCase(),"ol","原列表"),equal($(te.obj[0].body.firstChild).css("list-style-type"),"decimal","原列表类型"),equal(ua.getChildHTML(te.obj[0].body.firstChild.firstChild),"<li><p>欢迎使用</p></li><li><p>ueditor</p></li>","检查内容"),start()},20)},50),stop()}),test(" 光标定位到列表前，输入tab键",function(){var e=te.obj[0];e.setContent('<ol style="list-style-type:decimal;"><li><p>欢迎使用</p></li><li><p>ueditor</p></li></ol>');var t=te.obj[1];setTimeout(function(){t.setStart(e.body.firstChild.firstChild.firstChild,0).collapse(!0).select(),ua.keydown(e.body,{keyCode:9}),ua.keyup(e.body,{keyCode:9}),setTimeout(function(){equal(te.obj[0].undoManger.list.length,1,"undoManger.index"),ua.manualDeleteFillData(te.obj[0].body),equal($(te.obj[0].body.firstChild).css("list-style-type"),"decimal","原列表类型"),equal(te.obj[0].body.firstChild.childNodes.length,2,"列表有两个子节点"),equal($(te.obj[0].body.firstChild.firstChild).css("list-style-type"),"lower-alpha","第一个节点是另一类型的列表"),equal(ua.getChildHTML(te.obj[0].body.firstChild.firstChild),"<li><p>欢迎使用</p></li>","检查内容"),equal(te.obj[0].body.firstChild.lastChild.tagName.toLowerCase(),"li","第一个节点是原列表的li"),equal(ua.getChildHTML(te.obj[0].body.firstChild.lastChild),"<p>ueditor</p>","检查内容"),start()},20)},50),stop()}),test("删除inline的标签",function(){var e=te.obj[0];e.setContent("<p><strong><em>hello world</em><span>wasai</span></strong></p>");var t=te.obj[1];setTimeout(function(){var o=e.body.firstChild.firstChild;t.selectNode(o).select(),ua.keydown(e.body,{keyCode:8}),ua.keyup(e.body,{keyCode:8}),setTimeout(function(){ua.manualDeleteFillData(e.body),equal(e.body.firstChild.tagName.toLowerCase(),"p","strong 以及子inline节点都被删除"),baidu.editor.browser.ie?equal(e.body.lastChild.innerHTML,"","内容被删除了"):equal(e.body.lastChild.innerHTML,"<br>","内容被删除了"),start()},20)},20),stop()}),test("跨行选择2个块元素",function(){var e=te.obj[0];e.setContent("<p><strong>hello world<span>wasai</span></strong></p><div><em><span>hello 2</span></em></div>");var t=te.obj[1];setTimeout(function(){var o=e.body;t.setStart(o.firstChild,0).setEnd(o.lastChild,1).select(),ua.keydown(e.body,{keyCode:8}),ua.keyup(e.body,{keyCode:8}),setTimeout(function(){ua.manualDeleteFillData(e.body),t=e.selection.getRange(),equal(o.childNodes.length,1,"div被删除，保留p");var l=baidu.editor.browser.ie?"":"<br>";equal(ua.getChildHTML(o),"<p>"+l+"</p>"),start()},20)},20),stop()});