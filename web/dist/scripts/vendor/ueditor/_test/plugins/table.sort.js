function getTable(t){var e=document.getElementById("testTable");return e||(e=document.createElement("div"),e.id="testTable",document.body.appendChild(e)),e.innerHTML="<table border='1'>"+t+"</table>",e.firstChild}module("plugins.table"),UT=UE.UETable,test(" trace 3715 sortTable",function(){var t=getTable("<tr><td>01</td><td>2</td><td>3</td><td>4</td><td>6</td><td>7</td></tr><tr><td>11</td><td>2</td><td>3</td><td>4</td><td>6</td><td>7</td></tr><tr><td>21</td><td>2</td><td>3</td><td>4</td><td>6</td><td>7</td></tr>"),e=new UT(t);e.sortTable(1,function(t,e){return 1});var d=t.rows[0].cells[0].innerHTML;equal(d,"21","单元格被逆序"),e.sortTable(0,function(t,e){var d=parseInt(t.innerHTML,10),a=parseInt(e.innerHTML,10);return a-d}),d=t.rows[0].cells[0].innerHTML,equal(d,"21","按数值从大到小排列"),e.sortTable(0,"reversebynum"),equal(t.getAttribute("data-sort-type"),"reversebynum","data-sort-type属性是否设置成功")}),test("active trace 3779 sorttable",function(){if(!(ua.browser.ie&&ua.browser.ie>8)){var t=te.obj[0],e=te.obj[1];t.setContent('<table width="1310"><tbody><tr><td width="634" valign="top">1</td><td width="634" valign="top"></td></tr><tr><td width="634" valign="top">2</td><td width="634" valign="top"></td></tr></tbody></table>'),setTimeout(function(){var d=t.body.getElementsByTagName("td");e.setStart(d[0],0).collapse(1).select(),t.execCommand("sorttable",1),ua.manualDeleteFillData(t.body),d=t.body.getElementsByTagName("td"),equal(d[0].innerHTML,2,""),equal(d[2].innerHTML,1,""),start()},50),stop()}}),test("sorttable,框选",function(){var t=te.obj[0],e=te.obj[1];t.setContent('<table width="1310"><tbody><tr><td width="634" valign="top">1</td><td width="634" valign="top"></td></tr><tr><td width="634" valign="top">2</td><td width="634" valign="top"></td></tr><tr><td valign="top" colspan="1" rowspan="1" style="word-break: break-all;">3</td><td valign="top" colspan="1" rowspan="1" style=""></td></tr></tbody></table>'),setTimeout(function(){var d=t.body.firstChild.getElementsByTagName("tr"),a=t.getUETable(t.body.firstChild),r=a.getCellsRange(d[0].cells[0],d[1].cells[0]);a.setSelected(r),e.setStart(d[0].cells[0],0).collapse(!0).select(),t.execCommand("sorttable",1),ua.manualDeleteFillData(t.body);var o=t.body.getElementsByTagName("td");equal(o[0].innerHTML,2,""),equal(o[2].innerHTML,1,""),equal(o[4].innerHTML,3,""),start()},50),stop()}),test("enablesort,disablesort",function(){var t=te.obj[0],e=te.obj[1];t.setContent('<table width="1310"><tbody><tr><td width="634" valign="top">1</td><td width="634" valign="top"></td></tr><tr><td width="634" valign="top">2</td><td width="634" valign="top"></td></tr></tbody></table>'),setTimeout(function(){var d=t.body.getElementsByTagName("td");e.setStart(d[0],0).collapse(1).select(),t.execCommand("enablesort"),setTimeout(function(){equal(t.body.firstChild.attributes["data-sort"].nodeValue,"sortEnabled","sortEnabled"),equal(domUtils.hasClass(t.body.firstChild,"sortEnabled"),!0,"sortEnabled"),t.execCommand("disablesort"),setTimeout(function(){equal(t.body.firstChild.attributes["data-sort"].nodeValue,"sortDisabled","sortDisabled"),equal(domUtils.hasClass(t.body.firstChild,"sortEnabled"),!1,"sortDisabled"),equal(domUtils.hasClass(t.body.firstChild.rows[0],"firstRow"),!0,"给第一行添加firstRow的类"),start()},20)},20)},50),stop()}),test("contextMenu 表格逆序当前",function(){var t=te.obj[0],e=te.obj[1];stop();var d=t.getLang("contextMenu");t.execCommand("cleardoc");var a="<table><tbody><tr><td>Michael</td><td>1</td><td>康熙</td></tr><tr><td>ackson</td><td>4</td><td>承祜</td></tr><tr><td>{}</td><td>2</td><td>胤礼</td></tr><tr><td>&amp;*</td><td>3</td><td>襄嫔</td></tr></tbody></table>";t.setContent(a),e.setStart(t.body.getElementsByTagName("td")[0],0).collapse(!0).select(),ua.contextmenu(t.body.firstChild);var r=document.getElementsByClassName("edui-menu-body")[2];setTimeout(function(){d=t.getLang("contextMenu"),equal(r.childNodes.length,7,"7个子项目"),browser.gecko?equal(r.textContent,d.enablesort+d.reversecurrent+d.orderbyasc+d.reversebyasc+d.orderbynum+d.reversebynum,"检查menu显示的字符"):equal(r.innerText.replace(/[\r\n\t\u200b\ufeff]/g,""),d.enablesort+d.reversecurrent+d.orderbyasc+d.reversebyasc+d.orderbynum+d.reversebynum,"检查menu显示的字符");var a=ua.getContextmenuIndexByName(r.childNodes,d.reversecurrent);ua.click(r.childNodes[a]),ua.manualDeleteFillData(t.body),ua.checkSameHtml(t.body.firstChild.firstChild.innerHTML,'<tr class="firstRow"><td>&amp;*</td><td>3</td><td>襄嫔</td></tr><tr><td>{}</td><td>2</td><td>胤礼</td></tr><tr><td>ackson</td><td>4</td><td>承祜</td></tr><tr><td>Michael</td><td>1</td><td>康熙</td></tr>',"表格内容逆序-选区闭合");var o=t.body.getElementsByTagName("td"),l=t.getUETable(t.body.firstChild),n=l.getCellsRange(o[0],o[6]);l.setSelected(n),e.setStart(o[0],0).collapse(!0).select(),ua.contextmenu(t.body.firstChild),r=document.getElementsByClassName("edui-menu-body")[2],setTimeout(function(){d=t.getLang("contextMenu"),ua.click(r.childNodes[a]),ua.manualDeleteFillData(t.body),ua.checkSameHtml(t.body.innerHTML,'<table><tbody><tr><td class="selectTdClass">ackson</td><td>4</td><td>承祜</td></tr><tr><td class="selectTdClass">{}</td><td>2</td><td>胤礼</td></tr><tr><td class="selectTdClass">&amp;*</td><td>3</td><td>襄嫔</td></tr><tr><td>Michael</td><td>1</td><td>康熙</td></tr></tbody></table>',"表格内容逆序-选区不闭合"),setTimeout(function(){document.getElementById("edui_fixedlayer").parentNode.removeChild(document.getElementById("edui_fixedlayer")),te.dom.push(t.container),start()},20)},20)},20)}),test("contextMenu 按ASCII字符排序",function(){if(!ua.browser.ie&&!ua.browser.gecko){var t=te.obj[0],e=te.obj[1];stop();var d=t.getLang("contextMenu");t.execCommand("cleardoc");var a="<table><tbody><tr><td>Michael</td><td>1</td><td>康熙</td></tr><tr><td>ackson</td><td>4</td><td>承祜</td></tr><tr><td>{}</td><td>2</td><td>胤礼</td></tr><tr><td>&amp;*</td><td>3</td><td>襄嫔</td></tr></tbody></table>";t.setContent(a),e.setStart(t.body.getElementsByTagName("td")[0],0).collapse(!0).select(),ua.contextmenu(t.body.firstChild);var r=document.getElementsByClassName("edui-menu-body")[2];setTimeout(function(){d=t.getLang("contextMenu");var a=ua.getContextmenuIndexByName(r.childNodes,d.orderbyasc);ua.click(r.childNodes[a]),ua.checkSameHtml(t.body.innerHTML,"<table><tbody><tr><td>{}</td><td>2</td><td>胤礼</td></tr><tr><td>&amp;*</td><td>3</td><td>襄嫔</td></tr><tr><td>ackson</td><td>4</td><td>承祜</td></tr><tr><td>Michael</td><td>1</td><td>康熙</td></tr></tbody></table>","选区闭合");var o=t.body.getElementsByTagName("td"),l=t.getUETable(t.body.firstChild),n=l.getCellsRange(o[0],o[6]);l.setSelected(n),e.setStart(o[0],0).collapse(!0).select(),ua.contextmenu(t.body.firstChild),r=document.getElementsByClassName("edui-menu-body")[2],forTable=document.getElementsByClassName("edui-for-table"),ua.browser.ie?ua.mouseenter(forTable[forTable.length-1]):ua.mouseover(forTable[forTable.length-1]),setTimeout(function(){d=t.getLang("contextMenu"),ua.click(r.childNodes[a+1]),ua.manualDeleteFillData(t.body),ua.checkSameHtml(t.body.innerHTML,'<table><tbody><tr><td class=" selecttdclass ">ackson</td><td>4</td><td>承祜</td></tr><tr><td class=" selecttdclass">&amp;*</td><td>3</td><td>襄嫔</td></tr><tr><td class=" selecttdclass">{}</td><td>2</td><td>胤礼</td></tr><tr><td>Michael</td><td>1</td><td>康熙</td></tr></tbody></table>',"表格内容逆序-选区不闭合"),setTimeout(function(){document.getElementById("edui_fixedlayer").parentNode.removeChild(document.getElementById("edui_fixedlayer")),te.dom.push(t.container),start()},200)},200)},200)}}),test("contextMenu 按数值大小排序",function(){var t=te.obj[0],e=te.obj[1];stop();var d=t.getLang("contextMenu");t.execCommand("cleardoc");var a="<table><tbody><tr><td>Michael</td><td>1</td><td>康熙</td></tr><tr><td>ackson</td><td>4</td><td>承祜</td></tr><tr><td>{}</td><td>2</td><td>胤礼</td></tr><tr><td>&amp;*</td><td>3</td><td>襄嫔</td></tr></tbody></table>";t.setContent(a),e.setStart(t.body.getElementsByTagName("td")[1],0).collapse(!0).select(),ua.contextmenu(t.body.firstChild);var r=document.getElementsByClassName("edui-menu-body")[2];setTimeout(function(){d=t.getLang("contextMenu");var e=ua.getContextmenuIndexByName(r.childNodes,d.orderbynum);ua.click(r.childNodes[e]),ua.manualDeleteFillData(t.body),ua.checkSameHtml(t.body.innerHTML,'<table data-sort-type="orderbynum"><tbody><tr class="firstRow"><td>Michael</td><td>1</td><td>康熙</td></tr><tr><td>{}</td><td>2</td><td>胤礼</td></tr><tr><td>&amp;*</td><td>3</td><td>襄嫔</td></tr><tr><td>ackson</td><td>4</td><td>承祜</td></tr></tbody></table>',"选区闭合"),setTimeout(function(){document.getElementById("edui_fixedlayer").parentNode.removeChild(document.getElementById("edui_fixedlayer")),te.dom.push(t.container),start()},200)},200)}),test("contextMenu trace 3384: 按数值大小排序",function(){var t=te.obj[0],e=te.obj[1];stop();var d=t.getLang("contextMenu");t.execCommand("cleardoc");var a="<table><tbody><tr><td>Michael</td><td>1</td><td>康熙</td></tr><tr><td>ackson</td><td>4</td><td>承祜</td></tr><tr><td>{}</td><td>2</td><td>胤礼</td></tr><tr><td>&amp;*</td><td>3</td><td>襄嫔</td></tr></tbody></table>";t.setContent(a),e.setStart(t.body.getElementsByTagName("td")[1],0).collapse(!0).select(),ua.contextmenu(t.body.firstChild);var r=document.getElementsByClassName("edui-menu-body")[2];setTimeout(function(){d=t.getLang("contextMenu");var a=ua.getContextmenuIndexByName(r.childNodes,d.orderbynum);ua.click(r.childNodes[a]),ua.checkSameHtml(t.body.innerHTML,"<table><tbody><tr><td>Michael</td><td>1</td><td>康熙</td></tr><tr><td>{}</td><td>2</td><td>胤礼</td></tr><tr><td>&amp;*</td><td>3</td><td>襄嫔</td></tr><tr><td>ackson</td><td>4</td><td>承祜</td></tr></tbody></table>","选区不闭合");var o=t.body.getElementsByTagName("td"),l=t.getUETable(t.body.firstChild),n=l.getCellsRange(o[1],o[7]);l.setSelected(n),e.setStart(o[1],0).collapse(!0).select(),ua.contextmenu(t.body.firstChild),r=document.getElementsByClassName("edui-menu-body")[2],forTable=document.getElementsByClassName("edui-for-table"),ua.browser.ie?ua.mouseenter(forTable[forTable.length-1]):ua.mouseover(forTable[forTable.length-1]),setTimeout(function(){d=t.getLang("contextMenu"),ua.click(r.childNodes[a+1]),ua.browser.gecko||ua.checkSameHtml(t.body.innerHTML,'<table><tbody><tr><td>&amp;*</td><td class=" selecttdclass">3</td><td>襄嫔</td></tr><tr><td>{}</td><td class=" selecttdclass">2</td><td>胤礼</td></tr><tr><td>Michael</td><td class=" selecttdclass">1</td><td>康熙</td></tr><tr><td>ackson</td><td>4</td><td>承祜</td></tr></tbody></table>',"选区不闭合"),setTimeout(function(){document.getElementById("edui_fixedlayer").parentNode.removeChild(document.getElementById("edui_fixedlayer")),te.dom.push(t.container),start()},200)},200)},200)});