module("plugins.defaultfilter"),test("对代码的行号不处理",function(){var t=te.obj[0];t.setContent('<td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td>');var e='<table><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td></tr></tbody></table>';ua.checkSameHtml(t.body.innerHTML,e,"table补全,对代码的行号不处理")}),test("空td,th,caption",function(){var t=te.obj[0];t.setContent("<table><caption></caption><tbody><tr><th></th><th></th></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table>");var e=ua.browser.ie&&ua.browser.ie<11?"":"<br>",a="<table><caption>"+e+"</caption><tbody><tr><th>"+e+"</th><th>"+e+"</th></tr><tr><td>"+e+"</td><td>"+e+"</td></tr><tr><td>"+e+"</td><td>"+e+"</td></tr></tbody></table>";ua.checkSameHtml(t.body.innerHTML,a,"空td,th,caption,添加text")}),test("转换a标签",function(){var t=te.obj[0];t.setContent('<a href="http://elearning.baidu.com/url/RepositoryEntry/68616197" target="_blank">');var e=(ua.browser.ie?"&nbsp;":"<br>",'<p><a href="http://elearning.baidu.com/url/RepositoryEntry/68616197" target="_blank" _href="http://elearning.baidu.com/url/RepositoryEntry/68616197"></a></p>');ua.checkSameHtml(e,t.body.innerHTML,"转换a标签")}),test("转换img标签",function(){var t=te.obj[0];t.setContent('<img src="http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif" width="270" height="129" style="border: 0px;" />'),equal(t.body.getElementsByTagName("img")[0].getAttribute("_src"),"http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif")}),test("删span中的white-space标签",function(){if(ua.browser.webkit){var t=te.obj[0];t.setContent('<span style=" display: block; white-space: nowrap " >sadfsadf</span>');var e='<p><span style=" display: block; ">sadfsadf</span></p>';ua.checkSameHtml(e,t.body.innerHTML,"删span中的white-space标签")}}),test("给空p加br&&转对齐样式",function(){var t=te.obj[0];t.setContent('<p align ="center" ></p>');var e=ua.browser.ie?"&nbsp;":"<br>",a='<p style="text-align:center;">'+e+"</p>";ua.checkSameHtml(t.body.innerHTML,a,"给空p加br&&转对齐样式")}),test("删div",function(){var t=te.obj[0];t.setContent('<div class="socore" ><div class="sooption" style="padding: 1px;" ><p>视频</p></div></div>');var e="<p>视频</p>";ua.checkSameHtml(e,t.body.innerHTML,"删div")}),test("allowDivTransToP--false 不转div",function(){var t=document.body.appendChild(document.createElement("div"));t.id="ue";var e=UE.getEditor("ue",{allowDivTransToP:!1});stop(),e.ready(function(){var t='<div class="socore" ><div class="sooption" style="padding: 1px;" >视频</div></div>';e.setContent(t);var a=ua.browser.ie&&ua.browser.ie<9?"PADDING-BOTTOM: 1px; PADDING-LEFT: 1px; PADDING-RIGHT: 1px; PADDING-TOP: 1px":"padding: 1px;",s='<div class="socore" ><div class="sooption" style="'+a+'" >视频</div></div>';ua.checkSameHtml(s,e.body.innerHTML,"不转div"),UE.delEditor("ue"),start()})}),test("li",function(){var t=te.obj[0];t.setContent('<li style="margin: 0px 0px 0px 6px;" ><a href="http://www.baidu.com/p/pistachio%E5%A4%A9?from=zhidao" class="user-name"  >天<i class="i-arrow-down"></i></a></li>');var e='<ul class=" list-paddingleft-2"><li><p><a href="http://www.baidu.com/p/pistachio%E5%A4%A9?from=zhidao" class="user-name" _href="http://www.baidu.com/p/pistachio%E5%A4%A9?from=zhidao">天<em class="i-arrow-down"></em></a></p></li></ul>';ua.checkSameHtml(e,t.body.innerHTML,"li")}),test("getContent--去除无用的空标签:autoClearEmptyNode==true",function(){var t=document.body.appendChild(document.createElement("div"));t.id="ue";var e=UE.getEditor("ue",{autoClearEmptyNode:!0,autoFloatEnabled:!1});stop(),e.ready(function(){te.dom.push(t),e.focus();var a="<span><span></span><strong>xx</strong><em>em</em><em></em></span><div>xxxx</div>";e.setContent(a),e.execCommand("source"),setTimeout(function(){e.execCommand("source"),setTimeout(function(){equal(e.getContent(),"<p><strong>xx</strong><em>em</em></p><p>xxxx</p>","span style空，套空的em和不空的em"),a='<span style="color:#c4bd97"><span></span><strong>xx</strong><em>em</em><em></em></span>',e.setContent(a),ua.browser.ie>8?ua.checkSameHtml(e.getContent().toLowerCase(),'<p><span style="color: rgb(196, 189, 151);" ><strong>xx</strong><em>em</em></span></p>',"span style不空，套空的em和不空的em"):ua.checkSameHtml(e.getContent().toLowerCase(),'<p><span style="color:#c4bd97" ><strong>xx</strong><em>em</em></span></p>',"span style不空，套空的em和不空的em"),a='<span style="color:#c4bd97"></span><strong>xx</strong><em>em</em><em></em>',e.setContent(a),ua.browser.ie>8?ua.checkSameHtml(e.getContent().toLowerCase(),'<p><span style="color: rgb(196, 189, 151);" ></span><strong>xx</strong><em>em</em></p>',"span 有style但内容为空"):ua.checkSameHtml(e.getContent().toLowerCase(),'<p><span style="color:#c4bd97" ></span><strong>xx</strong><em>em</em></p>',"span 有style但内容为空"),a='<span style="color:#c4bd97">asdf<strong>xx</strong><em>em</em><em></em></span>',e.setContent(a),ua.browser.ie>8?ua.checkSameHtml(e.getContent().toLowerCase(),'<p><span style="color: rgb(196, 189, 151);" >asdf<strong>xx</strong><em>em</em></span></p>',"span 有style内容不空"):ua.checkSameHtml(e.getContent().toLowerCase(),'<p><span style="color:#c4bd97" >asdf<strong>xx</strong><em>em</em></span></p>',"span 有style内容不空"),a='<a href="http://www.baidu.com"></a><a>a</a><strong>xx</strong><em>em</em><em></em>',e.setContent(a),ua.checkSameHtml(e.getContent(),'<p><a href="http://www.baidu.com" ></a><a>a</a><strong>xx</strong><em>em</em></p>',"a 有href但内容为空,不过滤a标签"),setTimeout(function(){UE.delEditor("ue"),start()},300)},50)},50)})}),test("getContent--不去除无用的空标签:autoClearEmptyNode==false",function(){var t=document.body.appendChild(document.createElement("div"));t.id="ue";var e=UE.getEditor("ue",{autoClearEmptyNode:!1,autoFloatEnabled:!1});stop(),e.ready(function(){te.dom.push(t),e.focus();var a="<span><span></span><strong>xx</strong><em>em</em><em></em><strong></strong></span>";e.setContent(a),equal(e.getContent().toLowerCase(),"<p><span><span></span><strong>xx</strong><em>em</em><em></em><strong></strong></span></p>","span style空，套空的em和不空的em"),a='<span style="color:#c4bd97"></span><strong>xx</strong><em>em</em><em></em><strong></strong>',e.setContent(a),ua.manualDeleteFillData(e.body),ua.browser.ie>8?ua.checkSameHtml(e.getContent().toLowerCase(),'<p><span style="color: rgb(196, 189, 151);" ></span><strong>xx</strong><em>em</em><em></em><strong></strong></p>',"span 有style但内容为空"):ua.checkSameHtml(e.getContent().toLowerCase(),'<p><span style="color:#c4bd97" ></span><strong>xx</strong><em>em</em><em></em><strong></strong></p>',"span 有style但内容为空"),setTimeout(function(){UE.delEditor("ue"),start()},500)})}),test("getContent--转换空格，nbsp与空格相间显示",function(){var t=te.obj[0];t.focus();var e="<div>x  x   x &nbsp;x&nbsp;&nbsp;  &nbsp;</div>";t.setContent(e),equal(t.getContent(),"<p>x &nbsp;x &nbsp; x &nbsp;x&nbsp;&nbsp; &nbsp;&nbsp;</p>","转换空格，nbsp与空格相间显示")}),test("转换script标签",function(){var t=te.obj[0],e=ua.browser.ie?"<p>&nbsp;</p>":"<p><br></p>";t.setContent('<script type="text/javascript">ueditor</script>');var a=e+'<div type="text/javascript" cdata_tag="script"  cdata_data="ueditor" _ue_custom_node_="true"></div>';ua.checkSameHtml(t.body.innerHTML,a,"转换script标签")}),test("trace 3698 1.3.0 版本修复: script(style)标签里面的内容不转码",function(){var t=te.obj[0];t.setContent('<script type="text/plain" id="myEditor" name="myEditor">var ue=UE.getEditor("editor");</script>'),equal(t.document.getElementById("myEditor").innerHTML,"","内容不保留"),t.setContent('<style type="text/css" id="myEditor">        .clear {            clear: both;        }     </style>');var e=ua.browser.ie?"<p>&nbsp;</p>":"<p><br></p>";ua.checkSameHtml(t.getContent(),e+'<style type="text/css" id="myEditor">.clear {            clear: both;        }</style>',"内容不转码")}),test("转换style标签:style data不为空",function(){var t=te.obj[0];t.setContent('<style type="text/css">sdf</style>');var e=ua.browser.ie?"<p>&nbsp;</p>":"<p><br></p>",a=e+'<div type="text/css" cdata_tag="style" cdata_data="sdf" _ue_custom_node_="true"></div>';ua.checkSameHtml(t.body.innerHTML,a,"转换script标签")}),test("转换style标签:style data不空",function(){var t=te.obj[0];t.setContent('<style type="text/css"></style>');var e=ua.browser.ie?"<p>&nbsp;</p>":"<p><br></p>",a=e+'<div type="text/css" cdata_tag="style" _ue_custom_node_="true"></div>';ua.checkSameHtml(t.body.innerHTML,a,"转换script标签")}),test("div出编辑器转换",function(){var t=te.obj[0],e='<script type="text/javascript">ueditor</script>',a='<div type="text/javascript" cdata_tag="script" >ueditor</div>';t.body.innerHTML=a,t.execCommand("source"),stop(),setTimeout(function(){equal(t.getContent(),e,"div出编辑器转换"),start()},20)}),test("img出编辑器转换",function(){var t=te.obj[0],e=ua.browser.ie?'<p><img src="http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif" width="270" height="129" style="border: 0px currentColor;"/></p>':'<p><img src="http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif" width="270" height="129" style="border: 0px"/></p>';8==ua.browser.ie&&(e='<p><img src="http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif" width="270" height="129" style="BORDER-BOTTOM: 0px; BORDER-LEFT: 0px; BORDER-TOP: 0px; BORDER-RIGHT: 0px"/></p>'),11==ua.browser.ie&&(e='<p><img src="http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif" width="270" height="129" style="border: 0px currentColor;border-image: none;"/></p>');var a='<p><img src="http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif" width="270" height="129" style="border: 0px;" _src="http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif" /></p>';t.body.innerHTML=a,t.execCommand("source"),stop(),setTimeout(function(){ua.checkSameHtml(t.getContent(),e,"img出编辑器转换"),start()},20)});