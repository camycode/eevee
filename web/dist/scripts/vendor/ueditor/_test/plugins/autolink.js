module("plugins.autolink"),test("输入超链接后回车",function(){if(!ua.browser.ie){var e=te.obj[0],t=te.obj[1],o=e.body;e.setContent("<p>http://www.baidu.com</p>"),stop(),setTimeout(function(){t.setStart(o.firstChild.firstChild,o.firstChild.firstChild.length).collapse(1).select(),setTimeout(function(){ua.keydown(e.body,{keyCode:13}),ua.keyup(e.body,{keyCode:13});var t=o.firstChild.getElementsByTagName("a")[0];if(t)equal(ua.getChildHTML(t),"http://www.baidu.com","检查a的内容"),ok(t&&-1!=$(t).attr("href").indexOf("http://www.baidu.com"),"检查a的href"),ok(t&&-1!=$(t).attr("_src").indexOf("http://www.baidu.com"),"检查a的_src");else{var i=e.getContent();equal(i,"<p>http://www.baidu.com</p>","检查p的内容")}start()},20)},20)}}),test("输入超链接后按空格",function(){if(!ua.browser.ie){var e=te.obj[0],t=te.obj[1],o=e.body;setTimeout(function(){e.setContent("<p>http://www.baidu.com</p>"),t.setStart(o.firstChild,1).collapse(1).select(),ua.keydown(e.body,{keyCode:32}),setTimeout(function(){var t=o.firstChild.getElementsByTagName("a")[0];if(t)equal(ua.getChildHTML(t),"http://www.baidu.com","检查a的内容"),ok(t&&-1!=$(t).attr("href").indexOf("http://www.baidu.com"),"检查a的href"),ok(t&&-1!=$(t).attr("_src").indexOf("http://www.baidu.com"),"检查a的_src");else{var i=e.getContent();equal(i,"<p>http://www.baidu.com</p>","检查p的内容")}start()},20)},20),stop()}}),test("字符前面有内容",function(){if(!ua.browser.ie){var e=te.obj[0],t=te.obj[1],o=e.body;e.setContent('<p><img src="" alt=""><span style="color: red">http://www.baidu.com</span></p>'),t.setStart(o.firstChild,2).collapse(1).select(),stop(),setTimeout(function(){ua.keydown(e.body,{keyCode:32}),setTimeout(function(){var e=o.firstChild.getElementsByTagName("a")[0];if(e){ok(e&&-1!=$(e).attr("href").indexOf("http://www.baidu.com"),"检查a的href");equal(ua.getChildHTML(e),"http://www.baidu.com","检查a的内容")}else{var t=o.firstChild.firstChild.nextSibling.innerHTML;equal(t,"http://www.baidu.com","检查a的内容")}start()},20)},20)}}),test("在p后面回车",function(){if(!UE.browser.ie){var e=te.obj[0],t=te.obj[1],o=e.body;e.setContent("<p>www.baidu.com</p>"),setTimeout(function(){t.setStart(o.firstChild,1).collapse(1).select(),ua.keydown(e.body,{keyCode:13}),setTimeout(function(){var e=o.firstChild.getElementsByTagName("a")[0];if(e)ok(e&&-1!=$(e).attr("href").indexOf("http://www.baidu.com"),"检查a的href"),equal(ua.getChildHTML(e),"www.baidu.com","检查a的内容");else{var t=o.firstChild.innerHTML;equal(t,"www.baidu.com","检查a的内容")}start()},20)},20),stop()}}),test("trace 1709 在与其他文本相连的链接后空格",function(){if(!UE.browser.ie){var e=te.obj[0],t=te.obj[1],o=e.body;e.setContent("<p>你好http://www.baidu.com</p>"),setTimeout(function(){t.setStart(o.firstChild,1).collapse(1).select(),ua.keydown(e.body,{keyCode:32}),setTimeout(function(){var e=o.firstChild.getElementsByTagName("a")[0];if(e)equal(ua.getChildHTML(e),"http://www.baidu.com","检查a的内容"),ok(e&&-1!=$(e).attr("href").indexOf("http://www.baidu.com"),"检查a的href");else{var t=o.firstChild.innerHTML;equal(t,"你好http://www.baidu.com","检查a的内容")}start()},20)},20),stop()}}),test("你好htp://ww.baidu.com  后面回车",function(){if(!UE.browser.ie){var e=te.obj[0],t=te.obj[1],o=e.body;e.setContent("<p>你好http://www.baidu.com</p>"),setTimeout(function(){t.setStart(o.firstChild,1).collapse(1).select(),ua.keydown(e.body,{keyCode:32}),setTimeout(function(){equal(o.firstChild.firstChild.nodeValue,"你好","你好http://www.baidu.com 转换成文字+超链接");var e=o.firstChild.getElementsByTagName("a")[0];if(e)equal(ua.getChildHTML(e),"http://www.baidu.com","检查a的内容"),ok(e&&-1!=$(e).attr("href").indexOf("http://www.baidu.com"),"检查a的href");else{var t=o.firstChild.innerHTML;equal(t,"你好http://www.baidu.com","检查a的内容")}start()},20)},20),stop()}}),test("trace 2121",function(){if(!UE.browser.ie){var e=te.obj[0],t=te.obj[1],o=e.body;e.setContent('<p><span style="color:#ff0000;">欢迎<strong>使用</strong></span>ueditor!www.baidu.com</p>'),stop(),setTimeout(function(){t.setStart(o.firstChild.lastChild,o.firstChild.lastChild.length).collapse(1).select(),setTimeout(function(){ua.keydown(e.body,{keyCode:13});var t=o.firstChild.getElementsByTagName("a")[0];if(t)equal(ua.getChildHTML(t),"www.baidu.com","检查a的内容"),ok(t&&-1!=$(t).attr("href").indexOf("http://www.baidu.com"),"检查a的href"),ok(t&&-1!=$(t).attr("_src").indexOf("http://www.baidu.com"),"检查a的_src");else{var i=o.firstChild.innerHTML;equal(i,'<span style="color:#ff0000;">欢迎<strong>使用</strong></span>ueditor!www.baidu.com',"内容未改变")}start()},20)},20)}}),test("autofloat:false 禁用IE中的自动加超链接功能",function(){if(8!=ua.browser.ie&&ua.browser.ie>8){var e=document.body.appendChild(document.createElement("div"));e.id="ue";var t=UE.getEditor("ue",{autolink:!1});t.ready(function(){var e=new baidu.editor.dom.Range(t.document),o=t.body;t.body.innerHTML='<p><a href="http://www.baidu.com">www.baidu.com</a></p><p>&nbsp;</p>',setTimeout(function(){e.selectNode(o.lastChild.firstChild).select(),setTimeout(function(){ua.keyup(t.body,{keyCode:13}),setTimeout(function(){equal(o.firstChild.getElementsByTagName("a").length,0,"a 标签被去掉了"),equal(o.childNodes.length,2,"结果正确"),equal(o.firstChild.tagName.toLowerCase(),"p","结果正确"),equal(o.firstChild.innerHTML,"www.baidu.com","结果正确"),UE.delEditor("ue"),te.dom.push(document.getElementById("ue")),start()},60)},20)},20)}),stop()}}),test("autofloat:false 禁用IE中的自动加超链接功能--回车",function(){if(8!=ua.browser.ie&&ua.browser.ie){var e=document.body.appendChild(document.createElement("div"));e.id="ue";var t=UE.getEditor("ue",{autolink:!1});t.ready(function(){var e=new baidu.editor.dom.Range(t.document),o=t.body;t.body.innerHTML='<p><a href="http://www.baidu.com">www.baidu.com</a></p><p><img></p>',setTimeout(function(){e.selectNode(o.lastChild.firstChild).select(),setTimeout(function(){ua.keyup(t.body,{keyCode:13}),setTimeout(function(){equal(o.firstChild.getElementsByTagName("a").length,0,"a 标签被去掉了"),equal(o.childNodes.length,2,"结果正确"),equal(o.firstChild.tagName.toLowerCase(),"p","结果正确"),equal(o.firstChild.innerHTML,"www.baidu.com","结果正确"),UE.delEditor("ue"),te.dom.push(document.getElementById("ue")),start()},60)},20)},20)}),stop()}}),test("autofloat:false 禁用IE中的自动加超链接功能--空格",function(){if(8!=ua.browser.ie&&ua.browser.ie){var e=document.body.appendChild(document.createElement("div"));e.id="ue";var t=UE.getEditor("ue",{autolink:!1});t.ready(function(){var e=new baidu.editor.dom.Range(t.document),o=t.body,i=ua.browser.ie>8?"&nbsp;":" ";t.body.innerHTML='<p><a href="http://www.baidu.com">www.baidu.com</a>'+i+"<img></p>",setTimeout(function(){e.selectNode(o.firstChild.childNodes[1]).select(),setTimeout(function(){ua.keyup(t.body,{keyCode:32}),equal(o.firstChild.getElementsByTagName("a").length,0,"a 标签被去掉了"),equal(o.childNodes.length,1,"结果正确"),equal(o.firstChild.tagName.toLowerCase(),"p","结果正确"),equal(o.firstChild.innerHTML.toLowerCase(),"www.baidu.com"+i+"<img>","结果正确"),setTimeout(function(){UE.delEditor("ue"),te.dom.push(document.getElementById("ue")),start()},100)},20)},20)}),stop()}}),test("autofloat:false 禁用IE中的自动加超链接功能--对于手动添加的,不会误删",function(){if(ua.browser.ie){var e=document.body.appendChild(document.createElement("div"));e.id="ue";var t=UE.getEditor("ue",{autolink:!1});t.ready(function(){var e=new baidu.editor.dom.Range(t.document),o=t.body,i=ua.browser.ie>8?"&nbsp;":" ";t.setContent('<p><a href="http://www.baidu.com">www.baidu.com</a>'+i+"<img></p>"),setTimeout(function(){ua.browser.ie>8?e.setStart(o.firstChild.childNodes[1],1).collapse(!0).select():e.selectNode(o.firstChild.childNodes[1]).select(),setTimeout(function(){ua.keyup(t.body,{keyCode:32});var i=o.firstChild.getElementsByTagName("a");ok(i&&1==i.length,"a 标签没去掉"),ok(i[0]&&-1!=$(i[0]).attr("href").indexOf("http://www.baidu.com"),"检查a的href"),setTimeout(function(){t.execCommand("cleardoc"),t.setContent('<p><a href="http://www.baidu.com">www.baidu.com</a></p><p><img></p>'),setTimeout(function(){e.selectNode(o.lastChild.firstChild).select(),setTimeout(function(){ua.keyup(t.body,{keyCode:13}),setTimeout(function(){i=o.firstChild.getElementsByTagName("a"),ok(i&&1==i.length,"a 标签没去掉"),ok(i[0]&&-1!=$(i[0]).attr("href").indexOf("http://www.baidu.com"),"检查a的href"),UE.delEditor("ue"),te.dom.push(document.getElementById("ue")),start()},500)},20)},20)},20)},20)},20)}),stop()}});