module("plugins.anchor"),test("插入锚点后切换源码",function(){var e=te.obj[0],t=te.obj[1],a=e.body;stop();var o=baidu.editor.browser.ie?"&nbsp;":"<br />";setTimeout(function(){e.setContent("<p>"+o+"</p>"),t.setStart(a.firstChild,0).collapse(1).select(),e.execCommand("anchor","hello"),ua.checkHTMLSameStyle('<img anchorname="hello" class="anchorclass">'+o,e.document,a.firstChild,"检查锚点html"),ok("hello"==a.getElementsByTagName("img")[0].attributes.anchorname.nodeValue&&"anchorclass"==a.getElementsByTagName("img")[0].attributes["class"].nodeValue,"检查锚点"),e.execCommand("source"),setTimeout(function(){var t=e.iframe.parentNode.getElementsByTagName("textarea");ua.browser.webkit?ok(-1!=e.iframe.nextSibling.textContent.indexOf('<a name="hello"'),"查看是否转换成功"):ok(-1!=t[0].value.indexOf('<a name="hello"')||-1!=t[0].value.indexOf('<a anchorname="1"'),"查看是否转换成功"),e.execCommand("source"),ua.checkHTMLSameStyle('<img anchorname="hello" class="anchorclass">'+o,e.document,a.firstChild,"检查锚点html"),setTimeout(function(){start()},500)},200)},20)}),test("在源码模式设置超链接的name属性，切换到编辑器模式检查超链接是否变为锚点",function(){var e=te.obj[0],t=e.body;stop(),setTimeout(function(){e.setContent(""),setTimeout(function(){e.execCommand("source"),setTimeout(function(){var a=e.iframe.parentNode.getElementsByTagName("textarea")[0];a.value='<p><a name="source" anchorname="1"></a></p>',setTimeout(function(){e.execCommand("source"),ua.checkHTMLSameStyle('<img anchorname="source" class="anchorclass">',e.document,t.firstChild,"检查锚点html"),start()},100)},100)},100)},100)}),test("在源码模式设置超链接没有name属性，切换到编辑器模式检查超链接不变为锚点",function(){var e=te.obj[0];e.setContent("");var t=e.body;stop(),setTimeout(function(){e.execCommand("source"),setTimeout(function(){var a=e.iframe.parentNode.getElementsByTagName("textarea")[0];a.value='<p><a name="source" href="www.baidu.com">你好</a></p>',setTimeout(function(){e.execCommand("source"),ua.manualDeleteFillData(e.body),equal(t.firstChild.lastChild.tagName.toLowerCase(),"a","a标签不会转化"),start()},50)},10)},20)}),test("已存在锚点",function(){var e=te.obj[0],t=te.obj[1],a=e.body;baidu.editor.browser.ie?"&nbsp;":"<br />";e.setContent('<p><img anchorname="1" class="anchorclass"/></p>'),t.selectNode(a.firstChild).select(),e.execCommand("anchor","hello");var o=a.firstChild.firstChild.getAttribute("anchorname");equal(o,"hello","更改name"),e.setContent('<p><img anchorname="1" class="anchorclass"/></p>'),t.selectNode(a.firstChild).select(),e.execCommand("anchor"),equal(ua.getChildHTML(e.body),"<p></p>","去掉锚点")});