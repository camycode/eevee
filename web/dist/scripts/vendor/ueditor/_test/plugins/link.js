module("plugins.link"),test("同时去多个超链接",function(){var e=te.obj[0],t=te.obj[1];e.setContent('<p><a href="http://www.baidu.com/">hello</a>first<a href="http://www.google.com/">second</a></p><p>third<a href="http://www.sina.com/">sina</a></p><table><tbody><tr><td><a href="http://www.baidu.com/">baidu</a></td></tr></tbody></table>'),stop(),setTimeout(function(){t.selectNode(e.body).select(),e.execCommand("unlink"),equal(e.body.firstChild.innerHTML,"hellofirstsecond","第一段去掉超链接"),equal(e.body.firstChild.nextSibling.innerHTML,"thirdsina","第二段去掉超链接"),equal(e.body.lastChild.getElementsByTagName("td")[0].innerHTML,"baidu","表格内的超链接被去掉"),start()},100)}),test("光标闭合且没有超链接",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p>hello</p>"),t.setStart(e.body.firstChild,0).collapse(1).select(),e.execCommand("unlink"),equal(ua.getChildHTML(e.body),"<p>hello</p>","没有超链接什么都不做")}),test("在超链接前加一个超链接",function(){var e=te.obj[0],t=te.obj[1];e.setContent('<p>hello<a href="http://www.baidu.com/">baidu</a></p>'),t.selectNode(e.body.firstChild.firstChild).select(),e.execCommand("link",{href:"http://www.google.com/"}),ua.manualDeleteFillData(e.body),ua.checkSameHtml(e.getContent(),'<p><a href="http://www.google.com/" >hello</a><a href="http://www.baidu.com/" >baidu</a></p>')}),test("给图片添加超链接",function(){var e=te.obj[0],t=te.obj[1];e.setContent('<p><img  style="width: 200px;height: 200px" src="http://ueditor.baidu.com/img/logo.png">hello</p>'),t.selectNode(e.body.firstChild.firstChild).select(),e.execCommand("link",{href:"http://www.baidu.com/"});var l='<a  href="http://www.baidu.com/" ><img  src="http://ueditor.baidu.com/img/logo.png" _src="http://ueditor.baidu.com/img/logo.png" style="width: 200px;height: 200px" ></a>hello';ua.checkHTMLSameStyle(l,e.document,e.body.firstChild,"给图片添加超链接")}),test("选中多个单元格插入超链接",function(){if(!(ua.browser.ie>8)){var e=te.obj[0],t=te.obj[1];e.setContent("<table><tbody><tr><td></td><td></td></tr><tr><td>hello</td></tr></tbody></table>"),setTimeout(function(){var l=e.body.firstChild.getElementsByTagName("tr"),a=e.getUETable(e.body.firstChild),o=a.getCellsRange(l[0].cells[0],l[1].cells[1]);a.setSelected(o),t.setStart(l[0].cells[0],0).collapse(!0).select(),e.execCommand("link",{href:"http://www.baidu.com/"});var i=ua.browser.ie?"":"<br>";equal(ua.getChildHTML(l[0].cells[0]),'<a href="http://www.baidu.com/">http://www.baidu.com/</a>'+(ua.browser.ie>8?" ":i),"第一个单元格中插入超链接"),equal(ua.getChildHTML(l[0].cells[1]),i,"第二个单元格中未插入超链接"),equal(ua.getChildHTML(l[1].cells[0]),'<a href="http://www.baidu.com/">hello</a>',"第三个单元格中插入超链接"),start()},50),stop()}}),test("去除表格中的链接",function(){if(!(ua.browser.ie>8)){var e=te.obj[0],t=te.obj[1];e.setContent('<table><tbody><tr><td></td><td></td></tr><tr><td colspan="2">hello</td></tr></tbody></table>'),setTimeout(function(){var l=e.body.firstChild.getElementsByTagName("tr"),a=e.getUETable(e.body.firstChild),o=a.getCellsRange(l[0].cells[0],l[1].cells[0]);a.setSelected(o),t.setStart(l[0].cells[0],0).collapse(!0).select(),e.execCommand("link",{href:"http://www.baidu.com/"});var i=ua.browser.ie?"":"<br>";equal(e.queryCommandValue("link"),l[0].cells[0].firstChild,"查询多个单元格的command value为a"),e.execCommand("unlink"),equal(ua.getChildHTML(l[0].cells[0]),"http://www.baidu.com/"+(ua.browser.ie>8?" ":i),"第一个单元格中插入超链接"),equal(ua.getChildHTML(l[0].cells[1]),i,"第二个单元格中未插入超链接"),equal(ua.getChildHTML(l[1].cells[0]),"hello","第三个单元格中插入超链接"),equal(e.queryCommandValue("link"),null,"查询多个单元格的command value为null"),start()},50),stop()}}),test("添加链接--表格第一个单元格没有超链接",function(){if(!ua.browser.ie){var e=te.obj[0],t=te.obj[1];e.setContent('<table><tbody><tr><td></td><td><a href="www.google.com">google</a></td></tbody></table>'),setTimeout(function(){var l=e.body.firstChild.getElementsByTagName("tr"),a=e.getUETable(e.body.firstChild),o=a.getCellsRange(l[0].cells[0],l[0].cells[1]);a.setSelected(o),e.execCommand("link",{href:"www.baidu.com"}),t=e.selection.getRange(),equal(ua.getChildHTML(l[0].cells[1]),'<a href="www.baidu.com">google</a>',"a标签的地址被修改了");var i=ua.browser.ie?"":"<br>";equal(ua.getChildHTML(l[0].cells[0]),'<a href="www.baidu.com">www.baidu.com</a>'+i,"td 1 被添加了超链接"),baidu.editor.browser.gecko||baidu.editor.browser.webkit?ua.checkResult(t,l[0].cells[0].firstChild,l[0].cells[0].firstChild,0,0,!0,"check link result"):ua.checkResult(t,l[0].cells[0].firstChild.firstChild,l[0].cells[0].firstChild.firstChild,0,0,!0,"check link result"),start()},50),stop()}}),test("光标在超链接中间去除超链接",function(){var e=te.obj[0],t=te.obj[1];e.setContent('<p><a href="www.google.com">hello</a></p>');var l=e.body.getElementsByTagName("a")[0].firstChild;t.setStart(l,2).collapse(1).select(),same(e.queryCommandValue("link"),e.body.firstChild.firstChild,"command value is a"),e.execCommand("unlink"),equal(ua.getChildHTML(e.body),"<p>hello</p>","去除超链接后"),equal(e.queryCommandState("unlink"),-1,"link state is -1")}),test("去除链接--选中区域包含超链接和非超链接",function(){var e=te.obj[0],t=te.obj[1];e.setContent('<p>hello</p><p>hello2<a href="www.fanfou.com">famfou</a>hello3</p>');var l=e.body;t.setStart(l.firstChild,0).setEnd(l.lastChild,3).select(),equal(e.queryCommandValue("link"),l.lastChild.firstChild.nextSibling,"queryCommandvalue")}),test("插入超链接",function(){var e=te.obj[0],t=te.obj[1];e.setContent("<p>hello</p>"),t.setStart(e.body.firstChild,1).collapse(1).select(),e.execCommand("link",{href:"www.baidu.com"});var l=e.body.getElementsByTagName("a")[0];t.selectNode(l).select(),t=e.selection.getRange(),same(e.queryCommandValue("link"),l,"link value is a"),equal(ua.getChildHTML(e.body),'<p>hello<a href="www.baidu.com">www.baidu.com</a></p>'),equal(e.queryCommandState("unlink"),0,"link state is 0")}),test("对现有的超链接修改超链接地址",function(){var e=te.obj[0],t=te.obj[1],l=e.body;e.setContent('<p><a href="http://www.baidu.com">http://www.baidu.com</a>hello<a href="www.google.com">google</a></p>');var a=l.firstChild.firstChild;t.selectNode(a).select(),e.execCommand("link",{href:"ueditor.baidu.com"}),a=l.firstChild.firstChild,equal(a.getAttribute("href"),"ueditor.baidu.com","check href"),equal(a.innerHTML,"ueditor.baidu.com","innerHTML也相应变化");var o=l.firstChild.getElementsByTagName("a")[1];t.selectNode(o).select(),e.execCommand("link",{href:"mp3.baidu.com"}),o=l.firstChild.getElementsByTagName("a")[1],equal(o.getAttribute("href"),"mp3.baidu.com","check href for second a link"),equal(o.innerHTML,"google","innerHTML不变")});