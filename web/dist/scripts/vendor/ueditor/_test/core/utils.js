module("core.utils"),test("cssRule",function(){var t=te.obj[0];t.cssRule("test1",".test{width:300px;}");var e=t.cssRule("test1");ok(/^\.test/.test(e)),t.cssRule("test1",""),e=t.cssRule("test1"),ok(!e);var a=te.dom[2];a.innerHTML='<span class="test">sdfsdf</span>',t.cssRule("style_test",".test{display:block}"),t.cssRule("style_test",".test{font-size:48px}");var s=UE.dom.domUtils.getComputedStyle(a.firstChild,"display");equals(s,"inline"),t.cssRule("style_test",""),equals(UE.dom.domUtils.getComputedStyle(a.firstChild,"font-size"),"16px")}),test("makeInstance",function(){var t=te.obj[0],e={s:1,str:"makeInstance"},a="makeInstance",s=t.makeInstance(e),o=t.makeInstance(a);equals(s.s,1,"ins.s"),equals(s.str,"makeInstance","ins.str"),same(o,{},"null"),same(t.makeInstance(null),{},"null")}),test("isArray--普通对象",function(){var t=te.obj[0],e=["1","2"],a={},s="array",o=function(){},n=te.dom[0];ok(t.isArray(e),"arr is a array"),ok(!t.isArray(a),"ob is not a array"),ok(!t.isArray(s),"str is not a array"),ok(!t.isArray(o),"fun is not a array"),ok(!t.isArray(null),"null is not a array"),ok(!t.isArray(n),"dom element is not a array")}),test("isArray--类数组对象",function(){var t=te.obj[0],e={0:"0",1:"1",2:"2",length:3},a=te.dom[0];a.innerHTML="<span><label></label></span>xxxxx<p></p>",ok(!t.isArray(e),"类数组对象不是数组"),ok(!t.isArray(a.childNodes),"nodeList 不是数组")}),test("inherits",function(){var t=te.obj[0],e=function(){},a=function(){};expect(4);e.prototype.name="superClass",e.prototype.methodSuper=function(){ok(!0,"method in superClass is called")},e.prototype.method=function(){ok(!1,"I am in superClass")},a.prototype.name="subClass",a.prototype.methodSub=function(){ok(!0,"method in subClass is called")},a.prototype.method=function(){ok(!0,"I am in subClass")},t.inherits(a,e);var s=new a;equal(s.name,"subClass","the name of subClass"),s.methodSuper(),s.methodSub(),s.method()}),test("bind",function(){function t(t){return this.num*t}var e=te.obj[0],a={num:4},s={num:2},o=e.bind(t,a);equal(o(5),20,"first_object");var n=e.bind(t,s);equal(n(5),10,"second_object")}),test("defer--一个defer",function(){var t=te.obj[0],e=100;expect(1),stop();+new Date;t.defer(function(){ok(1,"检查回调函数是否触发"),start()},e)()}),test("defer--多个defer",function(){var t=te.obj[0],e=40;stop(),expect(2),t.defer(function(){ok(!0,"第一个触发")},e)(),t.defer(function(){ok(!0,"第二个触发"),start()},e)()}),test("defer--考虑互斥",function(){var t=te.obj[0],e=20;stop(),expect(1);var a=t.defer(function(){ok(1,"检查回调函数是否在规定的时间内触发")},e,!0);a(),a(),setTimeout(function(){start()},100)}),test("extend--true",function(){var t=te.obj[0],e={a:3,b:"str",fun:function(){ok(!0,"fun")},n:null},a={a:2,c:1};t.extend(a,e,!0),equal(a.a,2,"obj2 a"),equal(a.b,"str","obj2 str"),equal(a.c,1,"obj2 c"),a.fun(),equal(a.n,null,"obj2 n null")}),test("extend--false",function(){var t=te.obj[0],e={a:3,b:"str",fun:function(){ok(!0,"fun")},n:null},a={a:2,c:1};t.extend(a,e,!1),equal(a.a,3,"obj2 a"),equal(a.b,"str","obj2 str"),equal(a.c,1,"obj2 c"),a.fun(),equal(a.n,null,"obj2 n null")}),test("indexOf",function(){var t=te.obj[0],e=[1,2,3,4,5];equals(t.indexOf(e,3),2),equals(t.indexOf(e,6),-1),equals(t.indexOf(e,5),4),equals(t.indexOf(e,3,3),-1),equals(t.indexOf(e,3,3),-1)}),test("removeItem&&itemexist",function(){var t=te.obj[0],e=[1,2,3,4,5,4,3];equal(e[5],4,"before remove 4"),t.removeItem(e,4),equal(e.length,5,"4 be removed"),equal(e[4],3,"4 be removed")}),test("removeItem&&itemnotexist",function(){var t=te.obj[0],e=[1,2,3,4,5,4];t.removeItem(e,6),equal(e.length,6,"itemnotexist")}),test("trim",function(){var t=te.obj[0],e=" sss ";equals(t.trim(e),"sss","两端有空格"),e="&nbsp;xxx ",equal(t.trim(e),"&nbsp;xxx","包含&nbsp;"),e="string",equal(t.trim(e),"string","没有&nbsp;和空格")}),test("listToMap",function(){var t=te.obj[0],e="listToMap",a=t.listToMap(e);equal(a.listToMap,1,"listToMap")}),test("list,To,Map",function(){var t=te.obj[0],e="list,To,Map",a=t.listToMap(e);equal(a.list,1,"list"),equal(a.To,1,"list"),equal(a.Map,1,"Map")}),test('listToMap ""',function(){var t=te.obj[0],e="",a=t.listToMap(e);equal(a.toString(),{},"{}")}),test("listToMap null",function(){var t=te.obj[0],e=null,a=t.listToMap(e);equal(a.toString(),{},"{}")}),test("listToMap numstring",function(){var t=te.obj[0],e="123333",a=t.listToMap(e);equal(a[123333],1,"num")}),test("unhtml 字符转义",function(){var t=te.obj[0],e='<p>"as&cd"</p>',a=t.unhtml(e);equal(a,"&lt;p&gt;&quot;as&amp;cd&quot;&lt;/p&gt;","转义字符成功"),e='border:&lt;script&gt;alert(&quot;&quot;)&lt;/script&gt;"',equal(t.unhtml(e),"border:&lt;script&gt;alert(&quot;&quot;)&lt;/script&gt;&quot;","转义字符成功"),e="'",equal(t.unhtml("比如&#23567;这个汉字的unicode编码"),"比如&#23567;这个汉字的unicode编码"),equal(t.unhtml("比如&#<23567;这个汉字的unicode编码<>"),"比如&amp;#&lt;23567;这个汉字的unicode编码&lt;&gt;")}),test("html 反转义",function(){var t=te.obj[0],e="&lt;p&gt;&quot;as&amp;cd&quot;&lt;/p&gt;",a=t.html(e);equal(a,'<p>"as&cd"</p>',"反转义成功")}),test('unhtml null ""',function(){var t=te.obj[0],e=null;equal(t.unhtml(e),"","unhtml null"),e="",equal(t.unhtml(e),"","unhtml null")}),test("cssStyleToDomStyle",function(){var t=te.obj[0];equal(t.cssStyleToDomStyle("cssFloat").toLowerCase(),"cssfloat","cssFloat"),ua.browser.ie&&ua.browser.ie<9?equal(t.cssStyleToDomStyle("float").toLowerCase(),"stylefloat","float"):equal(t.cssStyleToDomStyle("float").toLowerCase(),"cssfloat","float"),equal(t.cssStyleToDomStyle("styleFloat").toLowerCase(),"stylefloat","styleFloat")}),test("isEmptyObject",function(){var t=te.obj[0],e={n:1};equal(!1,t.isEmptyObject(e)),equal(!0,t.isEmptyObject([])),equal(!0,t.isEmptyObject(""))}),test("fixColor",function(){var t=te.obj[0];equal("#953734",t.fixColor("color","rgb(149, 55, 52)"),"fixColor")}),test("sort",function(){var t=te.obj[0];same(["a","df","sdf","asdf"],t.sort(["a","asdf","df","sdf"],function(t,e){return t.length>e.length?1:0}),"sort")}),test("domReady",function(){var t=te.obj[0];expect(1),t.domReady(function(){ok(1,"domReady")})}),test("4个padding属性",function(){var t="padding-bottom:3px;padding-left:2px;padding-right:2px;padding-top:3px",e=UE.utils.optCss(t);equal(e,"padding:3px 2px;","上下相同，左右相同"),t="padding-bottom:2px;padding-left:2px;padding-right:2px;padding-top:3px",e=UE.utils.optCss(t),equal(e,"padding:3px 2px 2px;","上下不同，左右相同"),t="padding-bottom:2px;padding-left:2px;",e=UE.utils.optCss(t),equal(e,"padding-bottom:2px;padding-left:2px;","2个属性就不合")}),test("4个margin属性",function(){var t="margin-bottom:3px;margin-left:2px;margin-right:2px;margin-top:3px",e=UE.utils.optCss(t);equal(e,"margin:3px 2px;","上下相同，左右相同"),t="margin-bottom:2px;margin-left:2px;margin-right:2px;margin-top:2px",e=UE.utils.optCss(t),equal(e,"margin:2px;","全相同"),t="margin-bottom:2px;margin-left:2px;margin-right:2px;margin-top:3px",e=UE.utils.optCss(t),equal(e,"margin:3px 2px 2px;","上下不同，左右相同"),t="margin-top:2px;",e=UE.utils.optCss(t),equal(e,"margin-top:2px;","1个属性就不合")}),test("合并;的问题",function(){equal(UE.utils.optCss("font-size:12px;&quot;;&lt;dssdfs&gt;;;"),"font-size:12px;&quot;;&lt;dssdfs&gt;;","")}),test("margin，border，padding属性混杂",function(){var t="margin-bottom:3px;margin-left:2px;margin-right:2px;margin-top:3px;padding:4px;border-image:initial;border-top-color:red;",e=UE.utils.optCss(t);equal(e,"padding:4px;border-top-color:red;margin:3px 2px;","margin，border，padding属性混同")}),test("each 遍历方法",function(){var t=te.dom[0];t.innerHTML='<span></span><span></span><span id="a"></span><span></span>',UE.utils.each(t.getElementsByTagName("span"),function(t,e){equal(t.tagName,"SPAN","遍历nodelist")});var e=0;UE.utils.each(t.getElementsByTagName("span"),function(t,a){return e++,"a"==t.id?!1:void 0}),equal(e,3),UE.utils.each(["a","b"],function(t,e){equal(t,["a","b"][e],"遍历数组")}),UE.utils.each({a:1,b:2},function(t,e){equal(t,{a:1,b:2}[e],"遍历对象")})}),test("clone 转换",function(){var t={a:1},e=UE.utils.clone({a:1});t.a=2,equal(e.a,1),t={a:{b:1},c:[1,2]},e=UE.utils.clone(t),t.a.b=2,equal(e.a.b,1),t.c[1]=3,equal(e.c[1],2)}),test("transUnitToPx 转换",function(){equal(UE.utils.transUnitToPx("20pt"),"27px"),equal(UE.utils.transUnitToPx("0pt"),"0")}),test("RegExp",function(){var t=new RegExp(".*");equal(ok(utils.isRegExp(t),"reg is a RegExp"))}),test("isDate",function(){var t=new Date;equal(ok(utils.isDate(t),"date is a Date"))}),test("isCrossDomainUrl",function(){var t=location;ok(!utils.isCrossDomainUrl(location.href),"location.href 不跨域"),""==t.port&&ok(!utils.isCrossDomainUrl(t.protocol+"//"+t.hostname+":80/ueditor/"),"本地没端口,80端口不跨域"),"80"==t.port&&ok(!utils.isCrossDomainUrl(t.protocol+"//"+t.hostname+"/ueditor/"),"本地没80端口,无端口不跨域"),"http:"==t.protocol?ok(utils.isCrossDomainUrl("https://"+t.host+"/ueditor/"),"本地http协议,https协议跨域"):ok(utils.isCrossDomainUrl("http://"+t.host+"/ueditor/"),"本地不是http协议,http协议跨域"),ok(utils.isCrossDomainUrl(t.protocol+"//www.baidu.com:"+t.port),"域名不一致跨域")}),test("formatUrl",function(){var t="http://localhost/a.html?&key1=value1&&key2=value2&&&&&&&&&key3=value3&#hash",e="http://localhost/a.html?&key1=value1&&key2=value2&&&&&&&&&key3=value3&";equal(utils.formatUrl(t),"http://localhost/a.html?key1=value1&key2=value2&key3=value3#hash","格式化url"),equal(utils.formatUrl(e),"http://localhost/a.html?key1=value1&key2=value2&key3=value3","格式化url")}),test("str2json",function(){same(utils.str2json('{"a":11,"b":"22","c":"cc","d":[1,"2","a",{"a":"aa"}],"e":{"k1":1,"k2":"2","k3":"a","k4":{"a":"aa"}}}'),{a:11,b:"22",c:"cc",d:[1,"2","a",{a:"aa"}],e:{k1:1,k2:"2",k3:"a",k4:{a:"aa"}}},"字符串转json对象")}),test("json2str",function(){equal(utils.json2str({a:11,b:"22",c:"cc",d:[1,"2","a",{a:"aa"}],e:{k1:1,k2:"2",k3:"a",k4:{a:"aa"}}}),'{"a":11,"b":"22","c":"cc","d":[1,"2","a",{"a":"aa"}],"e":{"k1":1,"k2":"2","k3":"a","k4":{"a":"aa"}}}',"json对象转字符串")}),test("json2str 不使用原生方法",function(){stop();var j=window.JSON,flag=0;ua.readFile("../../../_test/coverage/core/utils.js",function(s){null===s&&(flag=1),window.JSON=null,eval(s),equal(utils.json2str({a:11,b:"22",c:"cc",d:[1,"2","a",{a:"aa"}],e:{k1:1,k2:"2",k3:"a",k4:{a:"aa"}}}),'{"a":11,"b":"22","c":"cc","d":[1,"2","a",{"a":"aa"}],"e":{"k1":1,"k2":"2","k3":"a","k4":{"a":"aa"}}}',"json对象转字符串"),window.JSON=j}),flag&&ua.readFile("../../../_src/core/utils.js",function(s){window.JSON=null,eval(s),equal(utils.json2str({a:11,b:"22",c:"cc",d:[1,"2","a",{a:"aa"}],e:{k1:1,k2:"2",k3:"a",k4:{a:"aa"}}}),'{"a":11,"b":"22","c":"cc","d":[1,"2","a",{"a":"aa"}],"e":{"k1":1,"k2":"2","k3":"a","k4":{"a":"aa"}}}',"json对象转字符串"),window.JSON=j}),setTimeout(function(){start()},50)}),test("clearEmptyAttrs",function(){var t=te.obj[0],e=t.clearEmptyAttrs({a:1,b:""});ok(!e.hasOwnProperty("b"),"clearEmptyAttrs")}),test("serializeParam",function(){equal(utils.serializeParam({key1:"value1",key2:"value2",key3:33,key4:"44",key5:!0,key6:null,key7:void 0,key8:[11,22,"33","aa",!0,null]}),"key1=value1&key2=value2&key3=33&key4=44&key5=true&key7=undefined&key8[]=11&key8[]=22&key8[]=33&key8[]=aa&key8[]=true&key8[]=null","序列化obj对象为GET请求字符串")});