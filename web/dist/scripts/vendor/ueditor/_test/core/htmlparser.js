module("core.htmlparser"),test("普通标签处理",function(){var l=UE.htmlparser("<i>sdfsdfsdfsf</i>");equals(l.toHtml(),"<i>sdfsdfsdfsf</i>","单个普通标签"),l=UE.htmlparser("<i>sdf<b>sdfsdsd</b>fsdfsf</i>"),equals(l.toHtml(),"<i>sdf<b>sdfsdsd</b>fsdfsf</i>","多个普通标签"),l=UE.htmlparser('<i dsf="sdf" sdf="wewe" readonly >sdf</i>'),ua.checkSameHtml(l.toHtml(),'<i dsf="sdf" sdf="wewe" readonly="" >sdf</i>',"添加属性的标签"),l=UE.htmlparser('<img src="file:///C:/DOCUME~1/DONGYA~1/LOCALS~1/Temp/msohtmlclip1/01/clip_image002.jpg" width="553" height="275" />'),ua.checkSameHtml(l.toHtml(),'<img src="file:///C:/DOCUME~1/DONGYA~1/LOCALS~1/Temp/msohtmlclip1/01/clip_image002.jpg" width="553" height="275" />',"img标签")}),test("特殊标签处理",function(){var l=UE.htmlparser('<i dsf="sdf" sdf="wewe" readonly >sd<!--fasdf-->f</i>');ua.checkSameHtml(l.toHtml(),'<i dsf="sdf" sdf="wewe" readonly="" >sd<!--fasdf-->f</i>',"包含注释"),l=UE.htmlparser('<script type="text/javascript" charset="utf-8" src="editor_api.js"></script>'),equals(l.toHtml().replace(/[ ]+>/g,">"),'<script type="text/javascript" charset="utf-8" src="editor_api.js"></script>',"script标签"),l=UE.htmlparser('<table width="960"><tbody><tr><td width="939" valign="top"><br></td></tr></tbody></table><p><br></p>'),equals(l.toHtml().replace(/[ ]+>/g,">"),'<table width="960"><tbody><tr><td width="939" valign="top"><br/></td></tr></tbody></table><p><br/></p>',"br标签"),l=UE.htmlparser("<li>sdfsdfsdf<li>sdfsdfsdfsdf"),equals(l.toHtml(),"<ul><li>sdfsdfsdf</li><li>sdfsdfsdfsdf</li></ul>","以文本结束的html")}),test("补全不完整li",function(){var l=UE.htmlparser("<ol><li><em><u>sdf<li>sdfsdf</ol>");equals(l.toHtml().replace(/[ ]+>/g,">"),"<ol><li><em><u>sdf</u></em></li><li>sdfsdf</li></ol>","补全u，em"),l=UE.htmlparser("<ol><li><em>sdf</em></li><ul><li>a</li><li>b</li><li>c</ul><li>jkl</ol>"),equals(l.toHtml().replace(/[ ]+>/g,">"),"<ol><li><em>sdf</em></li><ul><li>a</li><li>b</li><li>c</li></ul><li>jkl</li></ol>","补全li"),l=UE.htmlparser("<li>123"),equals(l.toHtml().replace(/[ ]+>/g,">"),"<ul><li>123</li></ul>","<li>123--补全li的parent--ul，前面有文本"),l=UE.htmlparser("<ul>123"),equals(l.toHtml().replace(/[ ]+>/g,">"),"<ul><li>123</li></ul>","<ul>123--补全ul的child--li，前面有文本"),l=UE.htmlparser("</li>123"),equals(l.toHtml().replace(/[ ]+>/g,">"),"123","</li>123--删掉标签")}),test("属性引号问题",function(){var l=UE.htmlparser("<img width=200 height=200 />");equals(l.toHtml().replace(/[ ]+>/g,">"),'<img width="200" height="200"/>'),l=UE.htmlparser("<img width='200' height='200' />"),equals(l.toHtml().replace(/[ ]+>/g,">"),'<img width="200" height="200"/>'),l=UE.htmlparser('<img width="200" height="200" />'),equals(l.toHtml().replace(/[ ]+>/g,">"),'<img width="200" height="200"/>')}),test("大小写",function(){var l=UE.htmlparser("<p><TD></TD></p>");equals(l.toHtml().replace(/[ ]+>/g,">"),"<p><table><tbody><tr><td></td></tr></tbody></table></p>"),l=UE.htmlparser("<OL><LI><em><u>sdf<LI>sdfsdf</OL>"),equals(l.toHtml().replace(/[ ]+>/g,">"),"<ol><li><em><u>sdf</u></em></li><li>sdfsdf</li></ol>","补全u，em"),l=UE.htmlparser("<IMG width=200 height=200 />"),equals(l.toHtml().replace(/[ ]+>/g,">"),'<img width="200" height="200"/>')}),test("裸字",function(){var l=UE.htmlparser("sdfasdfasdf");equals(l.toHtml().replace(/[ ]+>/g,">"),"sdfasdfasdf")}),test("只有结束标签的情况",function(){var l=UE.htmlparser("<p>hello1</a></p><p>hello2</p>");equals(l.toHtml().replace(/[ ]+>/g,">"),"<p>hello1</p><p>hello2</p>")}),test("开始标签与后面文本的空格过滤，其他不过滤inline节点之间的空格，过滤block节点之间的空格",function(){var l=UE.htmlparser('<a href="www.baidu.com">baidu</a> <a> hello </a>');equals(l.toHtml().replace(/[ ]+>/g,">"),'<a href="www.baidu.com">baidu</a> <a> hello </a>'),l=UE.htmlparser("<span> <span> hello </span></span> <span> he llo2<span> hello </span> </span>"),equals(l.toHtml().replace(/[ ]+>/g,">"),"<span> <span> hello </span></span> <span> he llo2<span> hello </span> </span>")}),test("文本包含特殊字符，如尖括号",function(){var l=UE.htmlparser("<span><td  hello</span>");equals(l.toHtml().replace(/[ ]+>/g,">"),"<span>&lt;td &nbsp;hello</span>","字符转义")}),test("br",function(){var l=UE.htmlparser("<br />");equals(l.toHtml().replace(/[ ]+>/g,">"),"<br/>","对br不操作"),l=UE.htmlparser("<br>"),equals(l.toHtml().replace(/[ ]+>/g,">"),"<br/>","补充br后面的斜杠")}),test("复杂标签嵌套",function(){var l=UE.htmlparser("<span>hello1<p><img>hello2<div>hello3<p>hello4");equals(l.toHtml().replace(/[ ]+>/g,">"),"<span>hello1<p><img/>hello2<div>hello3<p>hello4</p></div></p></span>")}),test("trace 1727:过滤超链接后面的空格",function(){var l=UE.htmlparser('<a href="www.baidu.com">baidu</a>  ddd');equals(l.toHtml().replace(/[ ]+>/g,">"),'<a href="www.baidu.com">baidu</a> &nbsp;ddd',"过滤超链接后面的空格")});