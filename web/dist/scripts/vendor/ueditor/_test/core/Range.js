module("core.Range");var checkBookmark=function(t,e,n,d){same(t.start,e,"检查start返回值"),same(t.end,n,"检查end返回值"),equal(t.id,d,"检查id")};test("init",function(){expect(6);var t=(te.dom[2],new baidu.editor.dom.Range(document));ua.checkResult(t,null,null,null,null,!0,"for init range"),same(t.document,document,"check current document of range")}),test("setStart/startEnd 自闭合元素",function(){var t=new baidu.editor.dom.Range(document),e=te.dom[2],n=document.createElement("img");e.appendChild(n),t.setStart(n,0),ua.checkResult(t,e,e,0,0,!0,"endContainer is null"),t.setEnd(n,0),ua.checkResult(t,e,e,0,1,!1,"startContainer is not null"),t.startContainer=null,t.setEnd(n,0),ua.checkResult(t,e,e,1,1,!0,"startContainer is null"),t.setStart(n,0),ua.checkResult(t,e,e,0,1,!1,"endContainer is not null")}),test("setStart/startEnd--nodeType不为1",function(){var t=new baidu.editor.dom.Range(document),e=te.dom[2],n=document.createTextNode("text");e.appendChild(n),t.setStart(n,0),ua.checkResult(t,n,n,0,0,!0,"endContainer is null"),t.setEnd(n,1),ua.checkResult(t,n,n,0,1,!1,"startContainer is not null")}),test("setStart/setEnd--nodeType为1",function(){var t=new baidu.editor.dom.Range(document),e=te.dom[2];t.setStart(e,0),ua.checkResult(t,e,e,0,0,!0,"endContainer is null"),t.setEnd(e,1),ua.checkResult(t,e,e,0,1,!1,"startContainer is not null")}),test("setStartAfter,setStartBefore",function(){var t=te.dom[2];t.innerHTML="<span></span><a></a>";var e=t.firstChild,n=t.lastChild,d=new baidu.editor.dom.Range(document);d.setStartAfter(n),equal(d.startOffset,2,"check startOffset for setStartAfter--boundary testing"),d.setStartAfter(e),equal(d.startOffset,1,"check startOffset for setStartAfter"),d.setStartBefore(e),equal(d.startOffset,0,"check startOffset for setStartBefore--boundary testing"),d.setStartBefore(n),equal(d.startOffset,1,"check startOffset for setStartBefore");var s=document.createTextNode("text");t.innerHTML="",t.appendChild(s),d.setStartBefore(s),equal(d.startOffset,0,"check startOffset in text node")}),test("setEndAfter,setEndBefore",function(){var t=te.dom[2];t.innerHTML="<span></span><a></a>";var e=t.firstChild,n=t.lastChild,d=new baidu.editor.dom.Range(document);d.setEndAfter(n),equal(d.endOffset,2,"check startOffset for setEndAfter--boundary testing"),d.setEndAfter(e),equal(d.endOffset,1,"check startOffset for setEndAfter"),d.setEndBefore(e),equal(d.endOffset,0,"check startOffset for setEndBefore--boundary testing"),d.setEndBefore(n),equal(d.endOffset,1,"check startOffset for setEndBefore")}),test("collapse",function(){var t=document.createTextNode("TextNode");te.dom[2].appendChild(t);var e=new baidu.editor.dom.Range(document);e.setStart(t,1),ok(e.collapsed,"check collapse method true--setStart"),equal(e.startContainer,e.endContainer,"compare startContainer and endContainer--setStart"),e.startContainer=null,e.setEnd(t,0),equal(e.startContainer,e.endContainer,"compare startContainer and endContainer--setEnd"),equal(e.startOffset,e.endOffset,"compare startOffset and endOffset--setEnd"),ok(e.collapsed,"check collapsed is true--setEnd");var n=document.createElement("img");e.insertNode(n).selectNode(n),equal(e.startContainer,e.endContainer,"img startContainer and endContainer is same，but startOffset and endOffset is not same")}),test("selectNode",function(){var t=te.dom[2];t.innerHTML="text!",t.id="div_id";var e=new baidu.editor.dom.Range(document);e.selectNode(t);var n=ua.getIndex(t);ua.checkResult(e,document.body,document.body,n,n+1,!1,"check selectNode")}),test("selectNode--空节点",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);e.selectNode(t);var n=ua.getIndex(t);ua.checkResult(e,document.body,document.body,n,n+1,!1,"check selectNode")}),test("selectNode--空文本节点",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document),n=document.createTextNode("");t.appendChild(n),e.selectNode(t);var d=ua.getIndex(t);ua.checkResult(e,document.body,document.body,d,d+1,!1,"check selectNode")}),test("selectNodeContents",function(){expect(15);var t=te.dom[2];t.innerHTML="<div>text</div><a>";var e=t.firstChild.firstChild,n=new baidu.editor.dom.Range(document);n=n.selectNodeContents(t),ua.checkResult(n,t,t,0,2,!1,"selectNodeContents"),n=n.selectNodeContents(e),ua.checkResult(n,e,e,0,4,!1,"selectNodeContents for textNode"),t.innerHTML="<b>xxx<i>xxx</i>xxx</b>",n=new baidu.editor.dom.Range(document),n=n.selectNodeContents(t.firstChild),ua.checkResult(n,t.firstChild,t.firstChild,0,3,!1,"selectNodeContents")}),test("cloneRange",function(){expect(5);var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<div>cloneRange</div>",e.setStart(t,0),e.setEnd(t,1);var n=e.cloneRange(e);ua.checkResult(e,n.startContainer,n.endContainer,n.startOffset,n.endOffset,!1,"cloneRange")}),test("shrinkBoundary--not ignore end",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<div>div1_text</div><a>a_text</a><div><span>span_text</span>div3_text</div>";var n=t.firstChild.nextSibling,d=t.lastChild;e.setStart(t,1).setEnd(t,3),e.shrinkBoundary(),ua.checkResult(e,n,d,0,2,!1,"shrinkBoundary--not ignore end")}),test("shrinkBoundary--ignoreEnd",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<div><p>p_text</p></div>";var n=t.firstChild,d=n.firstChild;e.setStart(n,0).setEnd(n,0),e.shrinkBoundary(!0),ua.checkResult(e,d,d,0,0,!0,"检查前后闭合是否一致")}),test("shrinkBonudaryl",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<b><i>xxxx</i>xxxxxxx</b>",e.selectNodeContents(t).shrinkBoundary(!0);var n=t.firstChild.firstChild;ua.checkResult(e,n,t,0,1,!1,"shrinkBoundary--ignoreEnd");var d=t.firstChild;e.selectNodeContents(t).shrinkBoundary(),ua.checkResult(e,n,d,0,d.childNodes.length,!1,"shrinkBoundary--not ignoreEnd"),t.innerHTML="xxxx<b><i><u></u></i></b>ssss";var s=t.getElementsByTagName("u")[0];e.selectNode(t.getElementsByTagName("b")[0]).shrinkBoundary(),ua.checkResult(e,s,s,0,0,!0,"初始startContainer和endContainer相同"),t.innerHTML="<table><tr><td>sssss</td></tr></table>";var a=t.getElementsByTagName("td")[0],i=t.firstChild;e.setStart(i,0).setEnd(i.getElementsByTagName("tr")[0],1).shrinkBoundary(),ua.checkResult(e,a,a,0,1,!1,"初始startContainer和endContainer不同"),t.innerHTML="<img/>",e.setStart(t,0).setEnd(t,1).shrinkBoundary(),ua.checkResult(e,t,t,0,1,!1,"子节点为自闭合元素，未能进入函数内部的逻辑"),t.innerHTML="text";var r=t.firstChild;e.setStart(r,1).setEnd(r,4).shrinkBoundary(),ua.checkResult(e,r,r,1,4,!1,"节点为文本节点，未能进入函数内部的逻辑"),e.setStart(t,0).setEnd(t,1).shrinkBoundary(),ua.checkResult(e,t,t,0,1,!1,"子节点为文本节点，未能进入函数内部的逻辑"),e.setStart(t,0).setEnd(t,0).shrinkBoundary(),ua.checkResult(e,t,t,0,0,!0,"元素collapsed"),e.setStart(t,0).setEnd(r,4).shrinkBoundary(),ua.checkResult(e,t,r,0,4,!1,"endContainer为文本节点")}),test("txtToElmBoundary",function(){var t=te.dom[2];t.innerHTML="text_node";var e=new baidu.editor.dom.Range(document),n=t.firstChild;e.setStart(n,0).setEnd(n,10),e.txtToElmBoundary(),ua.checkResult(e,t,t,0,1,!1,"endOffset大于text的长度"),e.setStart(n,1).setEnd(n,4).txtToElmBoundary(),ua.checkResult(e,n,n,1,4,!1,"endOffset小于text长度"),e.setStart(n,1).setEnd(n,10).txtToElmBoundary(),ua.checkResult(e,n,t,1,1,!1,"startOffset不为0，endOffset大于text长度"),e.setStart(n,10).setEnd(n,11).txtToElmBoundary(),ua.checkResult(e,t,t,1,1,!0,"endOffset和startOffset大于text长度"),e.setStart(n,0).setEnd(n,0).txtToElmBoundary(),ua.checkResult(e,n,n,0,0,!0,"startOffset和endOffset为0")}),test("trimBonudary",function(){var t=te.dom[2];t.innerHTML='<table border="1"><tr><td>td_xxxx<b><i><u>u_text</u></i></b></td></tr></table>';var e=new baidu.editor.dom.Range(document),n=t.getElementsByTagName("td")[0],d=n.firstChild;e.setStart(d,0).setEnd(d,5),e.trimBoundary(),ua.checkResult(e,n,n,0,1,!1,"切分文本节点"),equal(d.data,"td_xx","check text of tr");var s=t.getElementsByTagName("u")[0],a=s.firstChild;e.setStart(a,0).setEnd(a,0),e.trimBoundary(),ua.checkResult(e,s,s,0,0,!0,"startOffset=endOffset=0"),e.setStart(a,3).setEnd(a,10),e.trimBoundary().select(),ua.checkResult(e,s,s,1,2,!1,"endOffset大于text的长度"),equal(a.data,"u_t","从左边切分textNode"),e.setStart(a,1).setEnd(a,2),e.trimBoundary(),ua.checkResult(e,s,s,1,2,!1,"endOffset小于text的长度"),equal(a.data,"u","从中间切分textNode"),t.innerHTML="123456",e.setStart(t.firstChild,2).setEnd(t.firstChild,4).trimBoundary(!0),ua.checkResult(e,t,t.lastChild,1,2,!1,"ignoreEnd")}),test("adjustmentBoundary--startContainer为文本节点",function(){var t=new baidu.editor.dom.Range(document),e=te.dom[2];e.innerHTML='div_text<p><span id="span">span_text</span></p>div_text2<p id="p">p_text<em>em_text</em></p>';var n=document.getElementById("span").firstChild,d=document.getElementById("p");t.setStart(n,9).setEnd(d,0),t.adjustmentBoundary(),ua.checkResult(t,e,e,2,3,!1,"startContainer为文本节点")}),test("adjustmentBoundary--非文本节点",function(){var t=new baidu.editor.dom.Range(document),e=te.dom[2];e.innerHTML='div_text<p><span id="span">span_text</span></p>div_text2<p id="p">p_text<em>em_text</em></p>';var n=document.getElementById("span"),d=document.getElementById("p");t.setStart(n,1).setEnd(d,0),t.adjustmentBoundary(),ua.checkResult(t,e,e,2,3,!1,"startContainer为非文本节点")}),test("getCommonAncestor--初始startContainer和endContainer相同",function(){var t=new baidu.editor.dom.Range(document),e=te.dom[2];e.innerHTML="div_text<p><span>span_text</span></p>div_text2",t.setStart(e,0).setEnd(e,1);var n=t.getCommonAncestor();same(n,e,"祖先节点为startContainer");var d=e.getElementsByTagName("span")[0];t.setStart(d.firstChild,0).setEnd(d.firstChild,4),n=t.getCommonAncestor(),same(n,d.firstChild,"文本节点的祖先节点"),n=t.getCommonAncestor(!0,!0),same(n,d,"文本节点的祖先节点--忽略文本节点"),t.setStart(e,1).setEnd(e,2),n=t.getCommonAncestor(!0,!0),same(n,d.parentNode,"文本节点的祖先节点--includeSelf=true"),t.setStart(e,1).setEnd(e,2),n=t.getCommonAncestor(!1,!0),same(n,e,"文本节点的祖先节点--includeSelf=false")}),test("getCommonAncestor--初始startContainer和endContainer不同",function(){var t=new baidu.editor.dom.Range(document),e=te.dom[2];e.innerHTML="div_text<p><span>span_text</span></p>div_text2";var n=e.getElementsByTagName("span")[0];t.setStart(e,0).setEnd(n,1);var d=t.getCommonAncestor();same(d,e,"startContainer是endContainer的祖先"),t.setStart(e.firstChild,0).setEnd(n,1),d=t.getCommonAncestor(),same(d,e,"startContainer和endContainer是兄弟")}),test("selectNodeContents",function(){var t=te.dom[2];t.innerHTML="<b>xxxx</b>div_text";var e=new baidu.editor.dom.Range(document);e.selectNodeContents(t),ua.checkResult(e,t,t,0,2,!1,"selectNodeContents"),e.selectNodeContents(t.lastChild),ua.checkResult(e,t.lastChild,t.lastChild,0,8,!1,"selectNodeContents--")}),test("cloneContents",function(){var t=te.dom[2];t.innerHTML="<b>b_text</b>div_text";var e=new baidu.editor.dom.Range(document),n=t.firstChild;e.setStart(n,1).setEnd(t,1);var d=e.cloneContents();equal(ua.getHTML(d),"<b></b>"," 只选中一个b标签，插入空文本节点"),e.setStart(n.firstChild,1).setEnd(n.nextSibling,3),d=e.cloneContents(),equal(ua.getHTML(d),"<b>_text</b>div","从文本节点中间切"),e.setStart(t,0).setEnd(n.firstChild,3),d=e.cloneContents(),equal(ua.getHTML(d),"<b>b_t</b>","选中文本的前半部分"),e.setStart(n.firstChild,1).setEnd(t,2),d=e.cloneContents(),equal(ua.getHTML(d),"<b>_text</b>div_text","选中文本的前半部分"),t.innerHTML="<b>xxxx</b>xxxx<b>c22c</b>",e.setStart(t.firstChild,1).setEnd(t.lastChild,1),equals(ua.getHTML(e.cloneContents()),"<b></b>xxxx<b>c22c</b>")}),test("cloneContents--补全后面的标签",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("first").firstChild,d=document.getElementById("two").firstChild;e.setStart(n,1).setEnd(d,2),ua.checkSameHtml(ua.getHTML(e.cloneContents()),'<p id="first">irst<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">ab</td></tr></tbody></table>'),ua.checkResult(e,n,d,1,2,!1,"cloneContents--补全后面的标签")}),test("cloneContents--补全前面的标签",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("last").firstChild,d=document.getElementById("two").firstChild;e.setStart(d,1),e.setEnd(n,2),ua.checkSameHtml(ua.getHTML(e.cloneContents()),'<table id="table" width="300"><tbody><tr><td id="two">bc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">te</p>'),ua.checkResult(e,d,n,1,2,!1,"cloneContents--补全前面的标签")}),test("cloneContents--切的部分为兄弟节点",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("first");e.setStart(n.firstChild,1).setEnd(n.lastChild,4),ua.checkSameHtml(ua.getHTML(e.cloneContents()),'irst<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> str'),ua.checkResult(e,n.firstChild,n.lastChild,1,4,!1,"cloneContents--startContainer和endContainer为兄弟节点")}),test("cloneContents--切同一个文本节点",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("first").firstChild;e.setStart(n,1).setEnd(n,4),equals(ua.getHTML(e.cloneContents()),"irs"),ua.checkResult(e,n,n,1,4,!1,"cloneContents--切同一个文本节点")}),test("cloneContents--startContainer和endContainer为非文本节点",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("first"),d=document.getElementById("last");e.setStart(n,0).setEnd(d,0),ua.checkSameHtml(ua.getHTML(e.cloneContents()),'<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last"></p>'),ua.checkResult(e,n,d,0,0,!1,"cloneContents--开始和结束位置都是文本"),e.setStart(n,1).setEnd(d,1),ua.checkSameHtml(ua.getHTML(e.cloneContents()),'<p id="first"><!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc</p>'),ua.checkResult(e,n,d,1,1,!1,"cloneContents--开始位置有注释")}),test("cloneContents--完整切掉一个节点",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';document.getElementById("first");e.setStart(t,0).setEnd(t,t.childNodes.length-1),ua.checkSameHtml(ua.getHTML(e.cloneContents()),'<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table>'),ua.checkResult(e,t,t,0,t.childNodes.length-1,!1,"cloneContents--完整切掉一个节点")}),test("cloneContents--startContainer和endContainer节点类型不同",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("first"),d=document.getElementById("last");e.setStart(n,0).setEnd(d.firstChild,1),ua.checkSameHtml(ua.getHTML(e.cloneContents()),'<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">t</p>'),ua.checkResult(e,n,d.firstChild,0,1,!1,"cloneContents--startContainer的nodeType=1，endContainer为文本节点"),e.setStart(n.firstChild,1).setEnd(d,0),ua.checkSameHtml(ua.getHTML(e.cloneContents()),'<p id="first">irst<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last"></p>'),ua.checkResult(e,n.firstChild,d,1,0,!1,"cloneContents--endContainer为文本节点，startContainer的nodeType=1")}),test("cloneContents--endContainer为em",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("traverse");e.setStart(t,0).setEnd(n,1),equals(ua.getHTML(e.cloneContents()),'<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b></p>'),ua.checkResult(e,t,n,0,1,!1,"cloneContents--startContainer的nodeType=1，endContainer为b"),e.setStart(t,0).setEnd(n,2),equals(ua.getHTML(e.cloneContents()),'<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em></p>'),ua.checkResult(e,t,n,0,2,!1,"cloneContents--startContainer的nodeType=1，endContainer为em")}),test("cloneContents--元素闭合",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<p>p_text</p>";var n=t.firstChild.firstChild;e.setStart(n,1).setEnd(n,1),equals(ua.getHTML(e.cloneContents()),"null","元素闭合直接返回null"),ua.checkResult(e,n,n,1,1,!0,"cloneContents--startContainer的nodeType=1，endContainer为em");var d=t.firstChild;e.setStart(d,1).setEnd(d,1),equals(ua.getHTML(e.cloneContents()),"null","元素闭合直接返回null"),ua.checkResult(e,d,d,1,1,!0,"cloneContents--startContainer的nodeType=1，endContainer为em")}),test("cloneContents--自闭合元素",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<b>b_text<i id="ii">i_text</i><img /></b>xxx';var n=t.firstChild;e.setStart(n.firstChild,2).setEnd(n,n.childNodes.length),equal(ua.getHTML(e.cloneContents()),'text<i id="ii">i_text</i><img>'),ua.checkResult(e,n.firstChild,n,2,n.childNodes.length,!1,"选中结束位置为自闭合元素-1");var d=n.firstChild.nextSibling;e.setStart(d,1).setEnd(n,n.childNodes.length),equal(ua.getHTML(e.cloneContents()),'<i id="ii"></i><img>'),ua.checkResult(e,d,n,1,n.childNodes.length,!1,"选中结束位置为自闭合元素-2"),e.setStart(d.firstChild,2).setEnd(t,2),equal(ua.getHTML(e.cloneContents()),'<b><i id="ii">text</i><img></b>xxx'),ua.checkResult(e,d.firstChild,t,2,2,!1,"选中结束位置为自闭合元素-3"),t.innerHTML='xxx<b>xxxx<i id="ii">i_Text</i><img/></b>xxx';var s=document.getElementById("ii").firstChild;e.setStart(t,0).setEnd(s,2),equals(ua.getHTML(e.cloneContents()),'xxx<b>xxxx<i id="ii">i_</i></b>'),ua.checkResult(e,t,s,0,2,!1,"选中结束位置为自闭合元素-4")}),test("deleteContents--删除空",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<p>p_text</p>";var n=t.firstChild.firstChild;e.setStart(n,2).setEnd(n,2),e.deleteContents(),ua.checkResult(e,n,n,2,2,!0,"删除空"),equal(ua.getHTML(t),'<div id="test"><p>p_text</p></div>',"div的innerHTML没有改变 ")}),test("deleteContents--删除相邻节点之间的内容",function(){var t=te.dom[2],e='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';t.innerHTML=e;var n=new baidu.editor.dom.Range(document),d=document.getElementById("two"),s=document.getElementById("last");n.setStart(d,1).setEnd(s,2),n.deleteContents(),ua.checkSameHtml(ua.getHTML(t),'<div id="test"><p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr></tbody></table><p id="last"></p></div>'),ua.checkResult(n,t,t,4,4,!0,"删除相邻节点的内容")}),test("deleteContents--删除子节点",function(){var t=te.dom[2],e='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';t.innerHTML=e;var n=new baidu.editor.dom.Range(document);n.setStart(t,0).setEnd(t,2),n.deleteContents(),ua.checkSameHtml(ua.getHTML(n.startContainer),'<div id="test"><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p></div>'),ua.checkResult(n,t,t,0,0,!0,"删除子节点的内容")}),test("deleteContents--删除同一文本节点内容",function(){var t=te.dom[2],e='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';t.innerHTML=e;var n=new baidu.editor.dom.Range(document),d=(t.firstChild,document.getElementById("strong").firstChild);n.setStart(d,0).setEnd(d,2),n.deleteContents(),equals(ua.getHTML(n.startContainer),"rong"),ua.checkSameHtml(ua.getHTML(t),'<div id="test"><p id="first">first<!--not--> strong <!-- --><strong id="strong">rong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p></div>'),ua.checkResult(n,d,d,0,0,!0,"删除子节点的内容")}),test("deleteContents--startContainer是endContainer父亲",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>',e.setStart(t,0),e.setEnd(document.getElementById("traverse"),2),e.deleteContents(),ua.checkSameHtml(ua.getHTML(t),'<div id="test"><p id="traverse">more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p></div>'),ua.checkResult(e,t,t,0,0,!0,"startContainer是endContainer父亲")}),test("deleteContents--startContainer和endContainer为不同文本节点",function(){var t=te.dom[2],e='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';t.innerHTML=e;var n=new baidu.editor.dom.Range(document),d=document.getElementById("first");n.setStart(d.firstChild,1).setEnd(d.lastChild,4);var s=t.firstChild;n.deleteContents(),equals(ua.getHTML(n.startContainer),'<p id="first">fong.</p>'),ua.checkResult(n,s,s,1,1,!0,"startContainer和endContainer为文本节点内容"),ua.checkSameHtml(ua.getHTML(t),'<div id="test"><p id="first">fong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p></div>'),equals(ua.getHTML(n.endContainer),'<p id="first">fong.</p>')}),test("deleteContents--startContainer是endContainer后代",function(){var t=te.dom[2],e='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';t.innerHTML=e;var n=new baidu.editor.dom.Range(document),d=document.getElementById("em");n.setStart(d,1).setEnd(t,3),n.deleteContents(),ua.checkSameHtml(ua.getHTML(n.startContainer),'<div id="test"><p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em></p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p></div>'),ua.checkResult(n,t,t,1,1,!0,"startContainer是endContainer后代")}),test("deleteContents--startContainer是文本，endContainer的nodeType=1",function(){var t=te.dom[2],e='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';t.innerHTML=e;var n=new baidu.editor.dom.Range(document),d=document.getElementById("em").firstChild,s=document.getElementById("two");n.setStart(d,1).setEnd(s,0),n.deleteContents(),ua.checkSameHtml(ua.getHTML(n.startContainer),'<div id="test"><p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">e</em></p><table id="table" width="300"><tbody><tr><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p></div>'),ua.checkResult(n,t,t,1,1,!0,"startContainer是文本，endContainer的nodeType=1")}),test("extractContents--补全后面的标签",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("first").firstChild,d=document.getElementById("two").firstChild;e.setStart(n,1).setEnd(d,2),ua.checkSameHtml(ua.getHTML(e.extractContents()),'<p id="first">irst<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">ab</td></tr></tbody></table>'),ua.checkSameHtml(ua.getHTML(e.startContainer),'<div id="test"><p id="first">f</p><table id="table" width="300"><tbody><tr><td id="two">c</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p></div>'),ua.checkResult(e,t,t,1,1,!0,"startContainer--补全后面的标签")}),test("extractContents--补全前面的标签",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("last").firstChild,d=document.getElementById("two").firstChild;e.setStart(d,1).setEnd(n,2),ua.checkSameHtml(ua.getHTML(e.extractContents()),'<table id="table" width="300"><tbody><tr><td id="two">bc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">te</p>'),ua.checkSameHtml(ua.getHTML(e.startContainer),'<div id="test"><p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">a</td></tr></tbody></table><p id="last">xtabc<span>span</span></p></div>'),ua.checkResult(e,t,t,4,4,!0,"startContainer--补全前面的标签")}),test("extractContents--切的部分为兄弟节点",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);
t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("first");e.setStart(n.firstChild,1).setEnd(n.lastChild,4),ua.checkSameHtml(ua.getHTML(e.extractContents()),'irst<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> str'),ua.checkSameHtml(ua.getHTML(e.startContainer),'<p id="first">fong.</p>',"check startContainer html"),ua.checkResult(e,n,n,1,1,!0,"startContainer--startContainer和endContainer为兄弟节点")}),test("extractContents--切同一个文本节点",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("first").firstChild;e.setStart(n,1).setEnd(n,4),equals(ua.getHTML(e.extractContents()),"irs"),equal(ua.getHTML(e.startContainer),"ft"),ua.checkResult(e,n,n,1,1,!0,"startContainer--切同一个文本节点")}),test("extractContents--startContainer和endContainer为非文本节点",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("first"),d=document.getElementById("last");e.setStart(n,0).setEnd(d,0),ua.checkSameHtml(ua.getHTML(e.extractContents()),'<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last"></p>'),ua.checkSameHtml(ua.getHTML(e.startContainer),'<div id="test"><p id="first"></p><p id="last">textabc<span>span</span></p></div>'),ua.checkResult(e,t,t,1,1,!0,"cloneContents--开始和结束位置都是文本"),t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>',n=document.getElementById("first"),d=document.getElementById("last"),e.setStart(n,2).setEnd(d,1),ua.checkSameHtml(ua.getHTML(e.extractContents()),'<p id="first"> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc</p>',"检查得到的contents"),ua.checkSameHtml(ua.getHTML(e.startContainer),'<div id="test"><p id="first">first<!--not--></p><p id="last"><span>span</span></p></div>',"检查切除后"),ua.checkResult(e,t,t,1,1,!0,"extractContents--开始位置有注释")}),test("extractContents--完整切掉一个节点",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';document.getElementById("first");e.setStart(t,0).setEnd(t,t.childNodes.length-1),ua.checkSameHtml(ua.getHTML(e.extractContents()),'<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table>'),ua.checkSameHtml(ua.getHTML(e.startContainer),'<div id="test"><p id="last">textabc<span>span</span></p></div>'),ua.checkResult(e,t,t,0,0,!0,"extractContents--完整切掉一个节点")}),test("extractContents--元素闭合",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<p>p_text</p>";var n=t.firstChild.firstChild;e.setStart(n,1).setEnd(n,1),equals(ua.getHTML(e.extractContents()),"null","元素闭合直接返回null"),equal(ua.getHTML(e.startContainer),"p_text"),ua.checkResult(e,n,n,1,1,!0,"extractContents--startContainer的nodeType=1，endContainer为em");var d=t.firstChild;e.setStart(d,1).setEnd(d,1),equals(ua.getHTML(e.extractContents()),"null","元素闭合直接返回null"),equal(ua.getHTML(e.startContainer),"<p>p_text</p>"),ua.checkResult(e,d,d,1,1,!0,"extractContents--startContainer的nodeType=1，endContainer为em")}),test("extractContents--自闭合元素",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document),n='<b>b_text<i id="ii">i_text</i><img /></b>xxx';t.innerHTML=n;var d=t.firstChild;t.innerHTML=n,d=t.firstChild,e.setStart(d.firstChild,2).setEnd(d,d.childNodes.length),equal(ua.getHTML(e.extractContents()),'text<i id="ii">i_text</i><img>',"获取带有<img>的内容"),equal(ua.getHTML(e.startContainer),"<b>b_</b>","检查切除元素后"),ua.checkResult(e,d,d,1,1,!0,"选中结束位置为自闭合元素")}),test("extractContents",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=e;t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>',n.setStart(document.getElementById("test"),0),n.setEnd(document.getElementById("traverse"),2),ua.checkSameHtml(ua.getHTML(n.extractContents()),'<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em></p>'),ua.checkSameHtml(ua.getHTML(n.startContainer),'<div id="test"><p id="traverse">more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p></div>'),equals(n.startOffset,0),equals(n.endContainer.nodeType,1),equals(n.endOffset,0),ua.checkSameHtml(ua.getHTML(n.endContainer),'<div id="test"><p id="traverse">more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p></div>'),ua.checkSameHtml(ua.getHTML(document.getElementById("test")),'<div id="test"><p id="traverse">more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p></div>'),equals(n.collapsed,!0)}),test("enlarge--文本节点左边扩到body",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<div>div_text</div></p>';var n=document.getElementById("first").firstChild,d=document.getElementById("last").firstChild;e.setStart(n,1).setEnd(d,2),e.enlarge(!0),ua.checkResult(e,document.body,t,ua.getIndex(t),5,!1,"左边扩到body")}),test("enlarge--文本节点右边扩到body",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<div id="first"><p>xxx</p>first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</div><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("strong").firstChild,d=document.getElementById("last").lastChild.firstChild;e.setStart(n,1).setEnd(d,2),e.enlarge(!0),ua.checkResult(e,t.firstChild,document.body,1,ua.getIndex(t)+1,!1,"右边扩到body")}),test("enlarge--文本节点左右边扩到body",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("first").firstChild,d=document.getElementById("last").lastChild.firstChild;e.setStart(n,1).setEnd(d,2),e.enlarge(!0),ua.checkResult(e,document.body,document.body,ua.getIndex(t),ua.getIndex(t)+1,!1,"左右边扩到body")}),test("enlarge--startContainer和endContainer的nodeType为1",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong<strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>',e.setStart(t,0).setEnd(t,2),e.enlarge(!0),ua.checkResult(e,document.body,t,ua.getIndex(t),2,!1,"左边扩到块元素父节点，右边扩到body")}),test("enlarge--左边非块元素节点",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("strong"),d=t.getElementsByTagName("table")[0];e.setStart(n,0).setEnd(d,1),e.enlarge(!0),ua.checkResult(e,document.body,t,ua.getIndex(t),4,!1,"左边扩到块元素父节点，右边扩到父节点")}),test("enlarge--左右属于同一非块元素节点",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var n=document.getElementById("strong");e.setStart(n,0).setEnd(n,1),e.enlarge(!0),ua.checkResult(e,document.body,t,ua.getIndex(t),1,!1,"左边扩到body");var d=n.firstChild;e.setStart(d,2).setEnd(d,3),e.enlarge(!0),ua.checkResult(e,document.body,t,ua.getIndex(t),1,!1,"左右均扩到第一个块元素祖先节点")}),test("enlarge--isBlock为null",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="xx<b><i>xxxx</i>xxxxxxx</b>",e.selectNodeContents(t.getElementsByTagName("i")[0]),e.enlarge(),ua.checkResult(e,t,t.lastChild,1,1,!1,"isBlock为null")}),test("enlarge--stopFn",function(){var t=te.dom[2],e=function(t){return"table"==t.tagName.toLowerCase()?!0:!1},n=new baidu.editor.dom.Range(document);t.innerHTML='<p id="first">first<!--not--> strong <!-- --><strong id="strong">strong</strong> second <em id="em">em</em> strong.</p><p id="second">bar</p><p id="traverse"><b><em id="em">some text</em></b><em>em text</em>more text</p><table id="table" width="300"><tbody><tr><td>1</td><td id="two">abc</td></tr><tr><td>3</td><td>4</td></tr></tbody></table><p id="last">textabc<span>span</span></p>';var d=document.getElementById("strong"),s=t.getElementsByTagName("table")[0];n.setStart(d,0).setEnd(s,1),n.enlarge(!0,e),ua.checkResult(n,document.body,s,ua.getIndex(t),1,!1,"左边扩到块元素父节点，右边不扩（stopFn为false）")}),test("enlarge--闭合",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="xxx<p>xxxxx</p>xxx<em>xxx</em>xxxxxxx<b>xxxx|xxx</b><p>bbbbb</p>xx",e.setStart(t.getElementsByTagName("b")[0],2).collapse(!0),e.enlarge(!0),ua.checkResult(e,t,t,2,6,!1,"初始为闭合，文本父节点为非块元素"),t.innerHTML="<div></div>xxxx<div></div>",e.setStart(t.firstChild.nextSibling,2).collapse(!0),e.enlarge(!0),ua.checkResult(e,t,t,1,2,!1,"初始为闭合,文本父节点为块元素")}),test("insertNode--文本中插入",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="div_text1<p>p_text</p>xxx<em>em_text</em>xxxxxxx<b>xxxx|xxx</b><p>bbbbb</p>text2_div";var n=t.firstChild.nextSibling.firstChild;e.setStart(n,1).setEnd(n,2);var d=document.createElement("div");e.insertNode(d),ua.checkResult(e,n.parentNode,d.nextSibling,1,1,!1,"插入div");var s=t.getElementsByTagName("em")[0].firstChild;e.setStart(s,0).setEnd(s,0),e.insertNode(document.createTextNode("new_text")),ua.checkResult(e,s.parentNode,s.parentNode,0,1,!1,"闭合情况下插入文本"),e.setStart(t.firstChild,1).setEnd(t.lastChild,1),e.insertNode(document.createElement("i")),ua.checkResult(e,t,t.lastChild,1,1,!1,"插入inline元素")}),test("inserNode--块元素中插入",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="div_text1<p>p_text</p>xxx<em>em_text</em>xxxxxxx<b>xxxx|xxx</b><p>bbbbb</p>text2_div",e.setStart(t,1).setEnd(t.lastChild,2);var n=document.createElement("div");e.insertNode(n),ua.checkResult(e,t,t.lastChild,1,2,!1,"插入div")}),test("insertNode--插入的节点为endContainer孩子",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="xxx<p>xxxxx</p>xxx<em>xxx</em>xxxxxxx<b>xxxx|xxx</b><p>bbbbb</p>xx";var n=t.childNodes.length;e.setStart(t,1).setEnd(t,n);var d=document.createElement("div");d.innerHTML="xxxx<div>div_text<span></span></div><i>i_text</i><img /><em>em_text</em>xxxx",e.insertNode(d),ua.checkResult(e,t,t,1,n+1,!1,"插入节点为endContainer的孩子"),equal(ua.getHTML(t),'<div id="test">xxx<div>xxxx<div>div_text<span></span></div><i>i_text</i><img><em>em_text</em>xxxx</div><p>xxxxx</p>xxx<em>xxx</em>xxxxxxx<b>xxxx|xxx</b><p>bbbbb</p>xx</div>')}),test("insertNode--插入的fragment为endContainer孩子",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document),n=document.createDocumentFragment();t.innerHTML="xxx<p>xxxxx</p>xxx<em>xxx</em>xxxxxxx<b>xxxx|xxx</b><p>bbbbb</p>xx";var d=t.childNodes.length;e.setStart(t,1).setEnd(t,t.childNodes.length);var s=document.createElement("div");n.appendChild(s),n.appendChild(document.createTextNode("text")),n.appendChild(document.createElement("span")),e.insertNode(n),ua.checkResult(e,t,t,1,d+3,!1,"插入fragment为endContainer的孩子"),equal(ua.getHTML(t),'<div id="test">xxx<div></div>text<span></span><p>xxxxx</p>xxx<em>xxx</em>xxxxxxx<b>xxxx|xxx</b><p>bbbbb</p>xx</div>',"比较innerHTML")}),test("createBookmark/moveToBookmark--元素不闭合",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='first_text<b><i>i_text</i>xxxxxxx</b><span id="span">span_text</span><p id="second"><em>em_text</em>p_text</p>';var n=e.selectNode(t).createBookmark();ua.checkResult(e,document.body,document.body,ua.getIndex(t),ua.getIndex(t)+1,!1,"元素不闭合,创建书签"),ok(/_baidu_bookmark_start_/.test(t.previousSibling.id),"检查div的前一个兄弟"),ok(/_baidu_bookmark_end_/.test(t.nextSibling.id),"检查div的后一个兄弟"),e.moveToBookmark(n),ua.checkResult(e,document.body,document.body,ua.getIndex(t),ua.getIndex(t)+1,!1,"元素不闭合，删除书签"),ok(!/_baidu_bookmark_start_/.test(t.previousSibling.id),"检查div的前面书签是否被删除"),e.setStart(t,2).setEnd(t,3);var n=e.createBookmark(!0);ua.checkResult(e,t,t,3,4,!1,"元素不闭合，插入span");var d=document.getElementById("span").previousSibling.id,s=document.getElementById("span").nextSibling.id;ok(/_baidu_bookmark_start_/.test(d),"检查前面span的id"),ok(/_baidu_bookmark_end_/.test(s),"检查后面span的id"),checkBookmark(n,d,s,!0),e.moveToBookmark(n),ua.checkResult(e,t,t,2,3,!1,"moveToBookmark"),equal(ua.getHTML(t),'<div id="test">first_text<b><i>i_text</i>xxxxxxx</b><span id="span">span_text</span><p id="second"><em>em_text</em>p_text</p></div>')}),test("createBookmark/moveToBookmark--span嵌套",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='first_text<b><i>i_text</i>xxxxxxx</b><span id="span">span_text</span><p id="second"><em>em_text</em>p_text</p>';var n=document.getElementById("span");e.setStart(n,0).setEnd(n,1);var d=e.createBookmark(),s=n.firstChild,a=n.lastChild;ua.checkResult(e,n,n,1,2,!1,"span嵌套"),ok(/_baidu_bookmark_start_/.test(s.id),"检查前面span的id"),ok(/_baidu_bookmark_end_/.test(a.id),"检查后面span的id"),checkBookmark(d,s,a,void 0)}),test("createBookmark/moveToBookmark--元素闭合",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='first_text<b><i>i_text</i>xxxxxxx</b><span id="span">span_text</span><p id="second"><em id="em">em_text</em>p_text</p>';var n=document.getElementById("em").firstChild,d=n.parentNode;e.setStart(n,1).setEnd(n,1);var s=e.createBookmark(!0,!0);ua.checkResult(e,d,d,2,2,!0,"元素闭合");var a=d.firstChild.nextSibling;checkBookmark(s,a.id,null,!0),equal("_baidu_bookmark_start_",a.id,"检查前面span的id")}),test("getClosedNode",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="xxx<span>xxx</span><img />xxxx",e.setStart(t,2).setEnd(t,3),same(e.getClosedNode(),t.lastChild.previousSibling,"check result is img"),e.setStart(t,2).collapse(!0),equal(e.getClosedNode(),null,"check null return result"),e.setStart(t,0).setEnd(t,1),equal(e.getClosedNode(),null,"get null result")}),test("applyInlineStyle--strong",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="div_text",e.setStart(t,0).setEnd(t,1),e.applyInlineStyle("strong"),equals(ua.getHTML(t),'<div id="test"><strong>div_text</strong></div>')}),test("applyInlineStyle--双重strong",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="div_text",t.innerHTML="div_text<strong>strong_text</strong>",e.setStart(t.firstChild,3),e.setEnd(t.firstChild.nextSibling.firstChild,3),e.applyInlineStyle("strong"),equals(ua.getHTML(t),'<div id="test">div<strong>_textstrong_text</strong></div>',"同一个块元素父标签双重加粗"),t.innerHTML="xx<p>xx<strong>bbbb</strong>xxx</p>xx<p><strong>aaaaaaa</strong></p>",e.setStartBefore(t.firstChild.nextSibling.firstChild),e.setEndAfter(t.lastChild.firstChild.firstChild),e.applyInlineStyle("strong"),equals(ua.getHTML(t),'<div id="test">xx<p><strong>xxbbbbxxx</strong></p><strong>xx</strong><p><strong>aaaaaaa</strong></p></div>',"跨块元素的加粗")}),test("applyInlineStyle--span放在em外面",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<div><em>div_text</em></div>",e.setStart(t,0).setEnd(t,1),e.applyInlineStyle("span",{style:"font-size:12px"});var n=t.firstChild.firstChild;equal($(n.firstChild).css("font-size"),"12px","check style")}),test("applyInlineStyle--span",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="div_text",e.setStart(t,0).setEnd(t,1),e.applyInlineStyle("span",{style:"font-size:12px"});var n=t.firstChild;equal($(n).css("font-size"),"12px","check style"),equal(n.firstChild.data,"div_text","check innerHTML")}),test("applyInlineStyle--span元素闭合",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="div_text",e.setStart(t,0).setEnd(t,0),e.applyInlineStyle("span",{style:"font-size:12px"}),equal(ua.getHTML(t),'<div id="test">div_text</div>')}),test("applyInlineStyle-双重span",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<span style="font-size:12px">div_text</span>';var n=t.firstChild;e.setStart(n.firstChild,0).setEnd(n.firstChild,4),e.applyInlineStyle("span",{style:"color:red"});var d=document.createElement("div");d.id="test",d.innerHTML='<span style="font-size: 12px; color: red;">div_</span><span style="font-size:12px">text</span>',ok(ua.haveSameAllChildAttribs(t,d),"check style")}),test("applyInlineStyle--b",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<ul><li>li_text</li><li>bbbb</li></ul>";var n=t.firstChild.firstChild;e.setStart(n,0).setEnd(t,1),e.applyInlineStyle("b"),equals(ua.getHTML(t),'<div id="test"><ul><li><b>li_text</b></li><li><b>bbbb</b></li></ul></div>'),t.innerHTML="<ul><li>li_text</li><li>bbbb</li></ul>",n=t.firstChild.firstChild.firstChild,e.setStart(n,1).setEnd(n,3),e.applyInlineStyle("b"),equal(ua.getHTML(t),'<div id="test"><ul><li>l<b>i_</b>text</li><li>bbbb</li></ul></div>')}),test("applyInlineStyle-b元素闭合",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<ul><li>li_text</li><li>bbbb</li></ul>";var n=t.firstChild.firstChild;e.setStart(n,1).setEnd(n,1),e.applyInlineStyle("b"),equals(ua.getHTML(t),'<div id="test"><ul><li>li_text</li><li>bbbb</li></ul></div>')}),test("applyInlineStyle-b有属性",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<p>1234</p>",e.setStart(t,0).setEnd(t.firstChild,4),e.applyInlineStyle("b",{title:"b_title",id:"b_id"});var n=t.firstChild.firstChild;same(n,document.getElementById("b_id"),"插入带有属性的b"),equal($(n).attr("title"),"b_title","check title"),equal(n.innerHTML,"1234","check innerHTML"),equal(t.childNodes.length,1,"check child count")}),test("applyInlineStyle--b放在Inline元素外面",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<p><em>1234</em>5678<span>9</span></p><p><em>1234</em>5678<span>9</span></p>",e.setStart(t,0).setEnd(t,2),e.applyInlineStyle("b"),equals(ua.getHTML(t),'<div id="test"><p><b><em>1234</em>5678<span>9</span></b></p><p><b><em>1234</em>5678<span>9</span></b></p></div>',"Inline element on multiple selected elements with various childnodes"),t.innerHTML='<p>x<em><span id="span">1234</span></em>y</p>';var n=document.getElementById("span");e.setStart(n.firstChild,0).setEnd(n.firstChild,4),e.applyInlineStyle("b"),equals(ua.getHTML(t),'<div id="test"><p>x<b><em><span id="span">1234</span></em></b>y</p></div>',"多个嵌套Inline element")}),test("applyInlinestyle--b没有文字",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<table><tr><td><br/></td></tr><tr><td><br/></td></tr><tr><td><br/></td></tr></table>",e.setStart(t,0).setEnd(t,1),e.applyInlineStyle("b"),equals(ua.getHTML(t),'<div id="test"><table><tbody><tr><td><br></td></tr><tr><td><br></td></tr><tr><td><br></td></tr></tbody></table></div>',"空表格"),ua.checkResult(e,t,t,0,1,!1,"对空表格进行b")}),test("applyInlineStyle-双重b",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<p><b>b_text</b></p>";var n=t.firstChild.firstChild.firstChild;e.setStart(n,1).setEnd(n,2),e.applyInlineStyle("b"),equals(t.innerHTML.toLowerCase(),"<p><b>b_text</b></p>","文本双重b"),t.innerHTML="<p><b>a<em>1234</em>b</b></p>",e.setStart(t.getElementsByTagName("em")[0].firstChild,0),e.setEnd(t.getElementsByTagName("em")[0].firstChild,4),e.applyInlineStyle("b"),equals(t.innerHTML.toLowerCase(),"<p><b>a<em>1234</em>b</b></p>","双重b+多个inline元素"),t.innerHTML="<p>a<b>12<b>34</b>56</b>b</p>",e.setStart(t.getElementsByTagName("b")[0].firstChild,1),e.setEnd(t.getElementsByTagName("b")[0].lastChild,1),e.applyInlineStyle("b"),equals(t.innerHTML.toLowerCase(),"<p>a<b>123456</b>b</p>","去掉嵌套的b")}),test("applyInlineStyle--多个style",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="xxxx",e.setStart(t,0).setEnd(t,1),e.applyInlineStyle("i").applyInlineStyle("span",{style:"color:red"}).applyInlineStyle("span",{style:"font-size:12px"});var n=t.firstChild;equal(n.style.color,"red","check color"),equal($(n).css("font-size"),"12px","check font size"),equal(n.innerHTML.toLowerCase(),"<i>xxxx</i>","check innerHTML including u")}),test("applyInlineStyle--MergeToParent",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='1<strong style="font-size: 24px; ">23456</strong>8910',e.setStart(t.firstChild,0).setEnd(t.childNodes[1],1).select(),e.applyInlineStyle("strong",{style:"font-size:24px"});var n='<strong style="font-size: 24px;">123456</strong>8910';ua.checkSameHtml(t.innerHTML,n)}),test("trace1583:applyInlineStyle--MergeToChild",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='<span style="font-size: 24px; ">​123<span style="font-size: 16px; ">45678</span>9</span>';var n=t.getElementsByTagName("span")[1];e.setStart(n.firstChild,2).setEnd(n.firstChild,4).select(),e.applyInlineStyle("span",{style:"font-size:24px"});var d='<span style="font-size:24px">123<span style="font-size:16px">45<span style="font-size: 24px; ">67</span>8</span>9</span>';ua.checkHTMLSameStyle(d,document,t,"MergeToChild")}),test("applyInlineStyle--选区包含部分兄弟",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="xxxx<span>span_text</span>",e.setStart(t,0).setEnd(t.firstChild.nextSibling,0),e.applyInlineStyle("u"),equal(t.innerHTML.toLowerCase(),"<u>xxxx</u><span>span_text</span>","check innerHTML including u")}),test("removeInlineStyle--删除父节点b",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<b>xxxx</b>",e.setStart(t,0).setEnd(t,1),e.removeInlineStyle("b"),equals(t.innerHTML,"xxxx","删除b")}),test("removeInlineStyle--删除祖先b",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<b><i>xxxx</i></b>";var n=t.firstChild.firstChild;e.setStart(n,0).setEnd(n,1),e.removeInlineStyle("b"),equals(t.innerHTML.toLowerCase(),"<i>xxxx</i>"),ua.checkResult(e,t,t,0,1,!1,"删除祖先b")}),test("removeInlineStyle--删除部分b",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<b><i>i_text</i></b><span>span_text</span>";var n=t.firstChild;e.setStart(n,0).setEnd(n.firstChild.firstChild,3),e.removeInlineStyle("b"),equals(t.innerHTML.toLowerCase(),"<i>i_t</i><b><i>ext</i></b><span>span_text</span>","检查html"),ua.checkResult(e,t,t,0,1,!1,"删除部分b")}),test("removeInlineStyle--删除多个b",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<table><tr><td>&nbsp;</td><td><table><tr><td><b>xxxxxx</b></td></tr></table></td><td><b>xxxxxx</b></td></tr></table>",e.setStart(t,0).setEnd(t,1),e.removeInlineStyle("b"),equals(ua.getHTML(t),'<div id="test"><table><tbody><tr><td>&nbsp;</td><td><table><tbody><tr><td>xxxxxx</td></tr></tbody></table></td><td>xxxxxx</td></tr></tbody></table></div>'),t.innerHTML="<b><i>xxxxx</i></b><i>bb</i><b>bbb</b>b<b><i>ccccc</i></b>",e.setStart(t.getElementsByTagName("b")[0],0),e.setEndAfter(t.getElementsByTagName("b")[2].firstChild),e.removeInlineStyle("b"),equals(t.innerHTML.toLowerCase(),"<i>xxxxx</i><i>bb</i>bbbb<i>ccccc</i>")}),test("removeInlineStyle--删除不同层文本的样式",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="xxx<b>b_text</b><span><b>b2_text</b></span>",e.setStart(t,0).setEnd(t,1);var n=t.firstChild.nextSibling,d=n.nextSibling.firstChild;e.setStart(n.firstChild,2).setEnd(d.firstChild,2),e.removeInlineStyle("b"),equals(t.innerHTML.toLowerCase(),"xxx<b>b_</b>text<span>b2<b>_text</b></span>"),ua.checkResult(e,t,t.lastChild,2,1,!1,"check startContainer等")}),test("removeInlineStyle--删除部分文本样式，需要切分文本节点",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML='xxx<b><i id="i"><u>u_text</u></i></b>',e.setStart(t.firstChild,2).setEnd(t.getElementsByTagName("u")[0].firstChild,2),e.removeInlineStyle("u"),equals(ua.getHTML(t),'<div id="test">xxx<b><i id="i">u_<u>text</u></i></b></div>',"u为父亲节点"),ua.checkResult(e,t,document.getElementById("i"),1,1,!1,"检查startOffset等"),t.innerHTML='xxx<b><i><u id="u">u_text</u></i></b>',e.setStart(t.firstChild,2).setEnd(t.getElementsByTagName("u")[0].firstChild,2),e.removeInlineStyle("i"),equals(ua.getHTML(t),'<div id="test">xxx<b><u id="u">u_</u><i><u id="u">text</u></i></b></div>',"i为祖先节点"),ua.checkResult(e,t,t.getElementsByTagName("b")[0],1,1,!1,""),t.innerHTML="<b><i><u>xxxx</u></i></b>bbbbb<b><i><u>xxxx</u></i></b>",e.setStart(t.getElementsByTagName("u")[0].firstChild,2).setEnd(t.getElementsByTagName("u")[1].firstChild,2),e.removeInlineStyle("u"),equals(t.innerHTML.toLowerCase(),"<b><i><u>xx</u>xx</i></b>bbbbb<b><i>xx<u>xx</u></i></b>","开始和结束位置都有u"),t.innerHTML="<b><i><u>xxxx</u></i></b>bbbbb<b><i><u>xxxx</u></i></b>",e.setStart(t.getElementsByTagName("u")[0].firstChild,2).setEnd(t.getElementsByTagName("u")[1].firstChild,2),e.removeInlineStyle("b"),equals(t.innerHTML.toLowerCase(),"<b><i><u>xx</u></i></b><i><u>xx</u></i>bbbbb<i><u>xx</u></i><b><i><u>xx</u></i></b>","删除部分文本节点的祖先节点的样式"),ua.checkResult(e,t,t,1,4,!1,"删除部分节点的祖先样式后")}),test("removeInlineStyle--删除闭合元素的样式",function(){var t=te.dom[2],e=new baidu.editor.dom.Range(document);t.innerHTML="<b><i>b_text</i></b>",e.setStart(t.firstChild.firstChild.firstChild,2).collapse(!0),e.removeInlineStyle("b"),equals(t.innerHTML.toLowerCase(),"<b><i>b_text</i></b>")}),test("b节点取range",function(){var t=te.dom[2],e=new baidu.editor.Editor({autoFloatEnabled:!1});stop(),e.render(t),e.ready(function(){var t=new baidu.editor.dom.Range(e.document);e.setContent("<p>hello<strong>hello1</strong>hello2</p>"),t.setStart(e.body.firstChild.lastChild,0).collapse(1).select(),t=e.selection.getRange(),ua.browser.ie&&ua.browser.ie<9||ua.browser.webkit?ua.checkResult(t,e.body.firstChild.lastChild.previousSibling,e.body.firstChild.lastChild.previousSibling,1,1,!0,"节点后--check range"):ua.browser.ie&&ua.browser.ie>8?ua.checkResult(t,e.body.firstChild,e.body.firstChild,3,3,!0,"节点后--check range"):ua.checkResult(t,e.body.firstChild.lastChild.previousSibling,e.body.firstChild.lastChild.previousSibling,0,0,!0,"节点后--check range"),t.setStart(e.body.firstChild.firstChild.nextSibling,0).collapse(1),t.select(),t=e.selection.getRange(),ua.browser.webkit?ua.checkResult(t,e.body.firstChild.firstChild.nextSibling.firstChild,e.body.firstChild.firstChild.nextSibling.firstChild,1,1,!0,"节点内文本节点前--check range"):ua.browser.ie&&ua.browser.ie<9?ua.checkResult(t,e.body.firstChild.childNodes[1].childNodes[1],e.body.firstChild.childNodes[1].childNodes[1],0,0,!0,"节点内文本节点前--check range"):ua.browser.ie&&ua.browser.ie>8?ua.checkResult(t,e.body.firstChild.childNodes[1],e.body.firstChild.childNodes[1],1,1,!0,"节点后--check range"):ua.checkResult(t,e.body.firstChild.firstChild.nextSibling.firstChild,e.body.firstChild.firstChild.nextSibling.firstChild,0,0,!0,"节点内文本节点前--check range"),t.setStart(e.body.firstChild.childNodes[1],0).collapse(1).select(),t=e.selection.getRange(),ua.browser.webkit?ua.checkResult(t,e.body.firstChild.childNodes[1].firstChild,e.body.firstChild.childNodes[1].firstChild,1,1,!0,"b节点--check range"):ua.browser.ie&&ua.browser.ie<9?ua.checkResult(t,e.body.firstChild.childNodes[1].childNodes[1],e.body.firstChild.childNodes[1].childNodes[1],0,0,!0,"节点内文本节点前--check range"):ua.browser.ie&&ua.browser.ie>8?ua.checkResult(t,e.body.firstChild.childNodes[1],e.body.firstChild.childNodes[1],1,1,!0,"节点后--check range"):ua.checkResult(t,e.body.firstChild.childNodes[1].firstChild,e.body.firstChild.childNodes[1].firstChild,0,0,!0,"b节点--check range"),
start()})}),test("文本节点中间取range",function(){var t=te.dom[2],e=new baidu.editor.Editor({autoFloatEnabled:!1});stop(),e.render(t),e.ready(function(){var t=new baidu.editor.dom.Range(e.document);e.setContent("<p>hello2</p>"),t.setStart(e.body.firstChild.firstChild,2).collapse(1).select(),t=e.selection.getRange(),ua.browser.ie&&ua.browser.ie<9?ua.checkResult(t,e.body.firstChild.lastChild,e.body.firstChild.lastChild,0,0,!0,"check range"):ua.browser.ie&&ua.browser.ie>8?ua.checkResult(t,e.body.firstChild,e.body.firstChild,2,2,!0,"check range"):ua.checkResult(t,e.body.firstChild.lastChild,e.body.firstChild.lastChild,2,2,!0,"check range"),start()})}),test("range.createAddress,range.moveAddress",function(){function t(t,e){return t.startContainer===e.startContainer&&t.startOffset===e.startOffset&&t.endContainer===e.endContainer&&t.endOffset===e.endOffset}var e=te.dom[0],n=new UE.dom.Range(document);e.innerHTML="<b>xxxx</b>";var d=n.setStart(e.firstChild,0).collapse(!0).createAddress(!0),s=new UE.dom.Range(document);s.moveToAddress(d),ok(t(n,s)),e.innerHTML="aaa",e.appendChild(document.createTextNode("aaa")),e.appendChild(document.createTextNode("aaa")),d=n.setStart(e.lastChild,0).setEnd(e.lastChild,e.lastChild.nodeValue.length).createAddress(),s.moveToAddress(d),ok(t(n,s)),d=n.setStart(e.lastChild,0).setEnd(e.lastChild,e.lastChild.nodeValue.length).createAddress(!1,!0),e.innerHTML="aaaaaabbb",s.moveToAddress(d),equal(s.cloneContents().firstChild.nodeValue,"bbb"),e.innerHTML="aaaaaabbb<b>sss</b>",d=n.setStartAfter(e.firstChild.nextSibling.firstChild).collapse(!0).createAddress(!1),s.moveToAddress(d),ok(t(n,s)),e.innerHTML="",e.appendChild(document.createTextNode(domUtils.fillChar)),e.appendChild(document.createTextNode("aaa")),d=n.setStartAtLast(e).collapse(!0).createAddress(!1,!0),e.innerHTML="aaa",s.moveToAddress(d),n.setStartAtLast(e).collapse(!0),ok(t(n,s)),e.innerHTML="aaa<b>sss</b>",e.appendChild(document.createTextNode(domUtils.fillChar)),d=n.setStartAtLast(e).collapse(!0).createAddress(!1,!0),e.innerHTML="aaa<b>sss</b>",s.moveToAddress(d),n.setStartAtLast(e).collapse(!0),ok(t(n,s)),e.innerHTML="aaa",e.appendChild(document.createTextNode(domUtils.fillChar)),e.appendChild(document.createTextNode("aaa")),d=n.setStart(e.firstChild.nextSibling,0).collapse(!0).createAddress(!1,!0),e.innerHTML="aaaaaa",s.moveToAddress(d),n.setStart(e.firstChild,3).collapse(!0),ok(t(n,s))}),test("equals",function(){var t=te.dom[2],e=new UE.dom.Range(document);t.innerHTML="<b>xxxx</b>",e.setStart(t.firstChild,0).collapse(!0);var n=e.cloneRange();ok(e.equals(n))});