module("ui.menu"),test("menu,submenu的显示",function(){function e(e,t,u){var m="*"==t&&e.all?e.all:e.getElementsByTagName(t),n=new Array;u=u.replace(/\-/g,"\\-");for(var d,l=new RegExp("(^|\\s)"+u+"(\\s|$)"),i=0;i<m.length;i++)d=m[i],l.test(d.className)&&n.push(d);return n}var t=new te.obj[0].Editor,u=[{label:"删除",cmdName:"delete"},{label:"全选",cmdName:"selectall"},{label:"删除代码",cmdName:"highlightcode",icon:"deletehighlightcode"},{label:"清空文档",cmdName:"cleardoc",exec:function(){confirm("确定清空文档吗？")&&this.execCommand("cleardoc")}},"-",{label:"取消链接",cmdName:"unlink"},"-",{label:"段落格式",icon:"justifyjustify",subMenu:{items:[{label:"居左对齐",cmdName:"justify",value:"left",editor:t},{label:"居右对齐",cmdName:"justify",value:"right",editor:t},{label:"居中对齐",cmdName:"justify",value:"center",editor:t},{label:"两端对齐",cmdName:"justify",value:"justify",editor:t}],editor:t}}],m=new te.obj[0].Menu({className:"edui-for-lineheight",items:u,editor:te.obj[0].Editor()});m.render(te.dom[0]),m.postRender(),m.show();var n=document.getElementsByClassName("edui-menu-body")[0];equal(n.childNodes[0].className,"edui-menuitem  edui-"+t.options.theme,"menu窗口显示"),equal(n.childNodes[0].firstChild.lastChild.innerHTML,"删除","menu窗口显示"),equal(n.childNodes[4].className,"edui-menuitem edui-menuseparator edui-"+t.options.theme,"menu窗口显示"),equal(n.childNodes[4].firstChild.className,"edui-menuseparator-inner edui-"+t.options.theme,"menu窗口显示"),equal(n.childNodes[7].className,"edui-menuitem  edui-"+t.options.theme+" edui-hassubmenu edui-hassubmenu","第7个menu有子menu");var d=m.items[7].id,l=m.items[7].subMenu.id;equal(document.getElementById(l).style.display,"none",'submenu初始的display值："none"'),ua.browser.ie?ua.mouseenter(n.childNodes[7]):ua.mouseover(n.childNodes[7]),setTimeout(function(){equal(document.getElementById(l).style.display,"",'显示submenu,检查submenu的display值:""'),equal(e(document.getElementById(l),"div","edui-menu-body")[0].childNodes.length,4,"检查submenu的menuitems数量"),equal(e(document.getElementById(l),"div","edui-menu-body")[0].firstChild.className,"edui-menuitem  edui-"+t.options.theme,"检查submenu的内容"),equal(e(document.getElementById(l),"div","edui-menuitem")[0].firstChild.lastChild.innerHTML,"居左对齐","检查menuitem的内容");var u=document.getElementById(d).className;equal(u,"edui-menuitem  edui-"+t.options.theme+" edui-hassubmenu edui-hassubmenu edui-state-hover edui-state-opened",""),ua.browser.ie?ua.mouseleave(document.getElementById(d)):ua.mouseout(document.getElementById(d)),setTimeout(function(){equal(document.getElementById(l).style.display,"none",'显示submenu,检查submenu的display值:""'),u=document.getElementById(d).className,ok(-1==u.indexOf("edui-state-hover")&&-1==u.indexOf("edui-state-opened"),""),document.getElementById(l).parentNode.removeChild(document.getElementById(l)),start()},450)},300),stop()}),test("先打开一个submenu，再打开另一个submenu",function(){var e=new te.obj[0].Editor,t=[{label:"删除",cmdName:"delete"},{label:"段落格式",icon:"justifyjustify",subMenu:{items:[{label:"居左对齐",cmdName:"justify",value:"left"},{label:"居右对齐",cmdName:"justify",value:"right"},{label:"居中对齐",cmdName:"justify",value:"center"},{label:"两端对齐",cmdName:"justify",value:"justify"}],editor:e}},{label:"表格",subMenu:{items:[{label:"居左对齐",cmdName:"justify",value:"left"},{label:"居右对齐",cmdName:"justify",value:"right"}],editor:e}}],u=new te.obj[0].Menu({className:"edui-for-lineheight",items:t,editor:e});u.render(te.dom[0]),u.postRender(),u.show();var m=(document.getElementsByClassName("edui-menu-body")[0],u.items[1].id),n=u.items[2].id,d=u.items[1].subMenu.id,l=u.items[2].subMenu.id;equal(document.getElementById(d).style.display,"none",'submenu初始的display值："none"'),ua.browser.ie?ua.mouseenter(document.getElementById(m)):ua.mouseover(document.getElementById(m)),setTimeout(function(){equal(document.getElementById(d).style.display,"",'显示第一个submenu,检查submenu的display值:""');var t=document.getElementById(m).className;equal(t,"edui-menuitem  edui-"+e.options.theme+" edui-hassubmenu edui-hassubmenu edui-state-hover edui-state-opened","检查第一个submenu的打开状态"),ua.browser.ie?ua.mouseenter(document.getElementById(n)):ua.mouseover(document.getElementById(n)),setTimeout(function(){equal(document.getElementById(d).style.display,"none",'第一个submenu关闭,display值:"none"'),t=document.getElementById(m).className,ok(-1==t.indexOf("edui-state-opened"),"检查第一个submenu的关闭状态"),equal(document.getElementById(l).style.display,"",'第二个submenu显示,检查submenu的display值:""');var t=document.getElementById(n).className;equal(t,"edui-menuitem  edui-"+e.options.theme+" edui-hassubmenu edui-hassubmenu edui-state-hover edui-state-opened","检查第二个submenu的打开状态"),document.getElementById(d).parentNode.removeChild(document.getElementById(l)),start()},450)},300),stop()}),test("dispose",function(){var e=new te.obj[0].Editor,t=[{label:"删除",cmdName:"delete"},{label:"全选",cmdName:"selectall"},{label:"删除代码",cmdName:"highlightcode",icon:"deletehighlightcode"},{label:"清空文档",cmdName:"cleardoc",exec:function(){confirm("确定清空文档吗？")&&this.execCommand("cleardoc")}},"-",{label:"取消链接",cmdName:"unlink"},{label:"表格",subMenu:{items:[{label:"居左对齐",cmdName:"justify",value:"left"},{label:"居右对齐",cmdName:"justify",value:"right"}],editor:e}}],u=new te.obj[0].Menu({className:"edui-for-lineheight",items:t,editor:e});te.dom[0].innerHTML=u.renderHtml(),u.postRender(),u.show(),equal(u.items.length,7,"检查menu里的items"),equal(document.getElementById(u.id).style.display,"",'显示menu,检查menu的display值:""'),u.dispose(),equal(u.items.length,0,"dispose后，检查menu里的items"),equal(document.getElementById(u.id),null,"menu不在页面中")}),test("_onClick",function(){var e=new te.obj[0].Editor,t=[{label:"取消链接",cmdName:"unlink"},{label:"表格",subMenu:{items:[{label:"居左对齐",cmdName:"justify",value:"left"},{label:"居右对齐",cmdName:"justify",value:"right"}],editor:e}}],u=new te.obj[0].Menu({className:"edui-for-lineheight",items:t,editor:e});u.render(te.dom[0]),u.postRender(),u.show();var m=u.items[1].id,n=u.items[1].subMenu.id;equal(document.getElementById(n).style.display,"none",'submenu初始的display值："none"'),ua.click(document.getElementById(m)),setTimeout(function(){equal(document.getElementById(n).style.display,"",'显示submenu,检查submenu的display值:""'),document.getElementById(n).parentNode.removeChild(document.getElementById(n)),start()},300),stop()});