UE.plugins.keystrokes=function(){var e=this,t=!0;e.addListener("keydown",function(r,o){var i=o.keyCode||o.which,n=e.selection.getRange();if(!n.collapsed&&!(o.ctrlKey||o.shiftKey||o.altKey||o.metaKey)&&(i>=65&&90>=i||i>=48&&57>=i||i>=96&&111>=i||{13:1,8:1,46:1}[i])){var s=n.startContainer;if(domUtils.isFillChar(s)&&n.setStartBefore(s),s=n.endContainer,domUtils.isFillChar(s)&&n.setEndAfter(s),n.txtToElmBoundary(),n.endContainer&&1==n.endContainer.nodeType&&(s=n.endContainer.childNodes[n.endOffset],s&&domUtils.isBr(s)&&n.setEndAfter(s)),0==n.startOffset&&(s=n.startContainer,domUtils.isBoundaryNode(s,"firstChild")&&(s=n.endContainer,n.endOffset==(3==s.nodeType?s.nodeValue.length:s.childNodes.length)&&domUtils.isBoundaryNode(s,"lastChild"))))return e.fireEvent("saveScene"),e.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",n.setStart(e.body.firstChild,0).setCursor(!1,!0),void e._selectionChange()}if(i==keymap.Backspace){if(n=e.selection.getRange(),t=n.collapsed,e.fireEvent("delkeydown",o))return;var a,l;if(n.collapsed&&n.inFillChar()&&(a=n.startContainer,domUtils.isFillChar(a)?(n.setStartBefore(a).shrinkBoundary(!0).collapse(!0),domUtils.remove(a)):(a.nodeValue=a.nodeValue.replace(new RegExp("^"+domUtils.fillChar),""),n.startOffset--,n.collapse(!0).select(!0))),a=n.getClosedNode())return e.fireEvent("saveScene"),n.setStartBefore(a),domUtils.remove(a),n.setCursor(),e.fireEvent("saveScene"),void domUtils.preventDefault(o);if(!browser.ie&&(a=domUtils.findParentByTagName(n.startContainer,"table",!0),l=domUtils.findParentByTagName(n.endContainer,"table",!0),a&&!l||!a&&l||a!==l))return void o.preventDefault()}if(i==keymap.Tab){var d={ol:1,ul:1,table:1};if(e.fireEvent("tabkeydown",o))return void domUtils.preventDefault(o);var f=e.selection.getRange();e.fireEvent("saveScene");for(var m=0,c="",v=e.options.tabSize||4,C=e.options.tabNode||"&nbsp;";v>m;m++)c+=C;var p=e.document.createElement("span");if(p.innerHTML=c+domUtils.fillChar,f.collapsed)f.insertNode(p.cloneNode(!0).firstChild).setCursor(!0);else{var u=function(e){return domUtils.isBlockElm(e)&&!d[e.tagName.toLowerCase()]};if(a=domUtils.findParent(f.startContainer,u,!0),l=domUtils.findParent(f.endContainer,u,!0),a&&l&&a===l)f.deleteContents(),f.insertNode(p.cloneNode(!0).firstChild).setCursor(!0);else{var h=f.createBookmark();f.enlarge(!0);for(var U=f.createBookmark(),y=domUtils.getNextDomNode(U.start,!1,u);y&&!(domUtils.getPosition(y,U.end)&domUtils.POSITION_FOLLOWING);)y.insertBefore(p.cloneNode(!0).firstChild,y.firstChild),y=domUtils.getNextDomNode(y,!1,u);f.moveToBookmark(U).moveToBookmark(h).select()}}domUtils.preventDefault(o)}if(browser.gecko&&46==i&&(f=e.selection.getRange(),f.collapsed&&(a=f.startContainer,domUtils.isEmptyBlock(a)))){for(var g=a.parentNode;1==domUtils.getChildCount(g)&&!domUtils.isBody(g);)a=g,g=g.parentNode;return void(a===g.lastChild&&o.preventDefault())}}),e.addListener("keyup",function(e,r){var o,i=r.keyCode||r.which,n=this;if(i==keymap.Backspace){if(n.fireEvent("delkeyup"))return;if(o=n.selection.getRange(),o.collapsed){var s,a=["h1","h2","h3","h4","h5","h6"];if((s=domUtils.findParentByTagName(o.startContainer,a,!0))&&domUtils.isEmptyBlock(s)){var l=s.previousSibling;if(l&&"TABLE"!=l.nodeName)return domUtils.remove(s),void o.setStartAtLast(l).setCursor(!1,!0);var d=s.nextSibling;if(d&&"TABLE"!=d.nodeName)return domUtils.remove(s),void o.setStartAtFirst(d).setCursor(!1,!0)}if(domUtils.isBody(o.startContainer)){var s=domUtils.createElement(n.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});o.insertNode(s).setStart(s,0).setCursor(!1,!0)}}if(!t&&(3==o.startContainer.nodeType||1==o.startContainer.nodeType&&domUtils.isEmptyBlock(o.startContainer)))if(browser.ie){var f=o.document.createElement("span");o.insertNode(f).setStartBefore(f).collapse(!0),o.select(),domUtils.remove(f)}else o.select()}})};