UE.plugins.list=function(){function e(e){var t=[];for(var i in e)t.push(i);return t}function t(e){var t=e.className;return domUtils.hasClass(e,/custom_/)?t.match(/custom_(\w+)/)[1]:domUtils.getStyle(e,"list-style-type")}function i(e,i){utils.each(domUtils.getElementsByTagName(e,"ol ul"),function(n){if(domUtils.inDoc(n,e)){var s=n.parentNode;if(s.tagName==n.tagName){var a=t(n)||("OL"==n.tagName?"decimal":"disc"),d=t(s)||("OL"==s.tagName?"decimal":"disc");if(a==d){var p=utils.indexOf(m[n.tagName],a);p=p+1==m[n.tagName].length?0:p+1,o(n,m[n.tagName][p])}}var c=0,f=2;domUtils.hasClass(n,/custom_/)?/[ou]l/i.test(s.tagName)&&domUtils.hasClass(s,/custom_/)||(f=1):/[ou]l/i.test(s.tagName)&&domUtils.hasClass(s,/custom_/)&&(f=3);var u=domUtils.getStyle(n,"list-style-type");u&&(n.style.cssText="list-style-type:"+u),n.className=utils.trim(n.className.replace(/list-paddingleft-\w+/,""))+" list-paddingleft-"+f,utils.each(domUtils.getElementsByTagName(n,"li"),function(e){if(e.style.cssText&&(e.style.cssText=""),!e.firstChild)return void domUtils.remove(e);if(e.parentNode===n){if(c++,domUtils.hasClass(n,/custom_/)){var i=1,l=t(n);if("OL"==n.tagName){if(l)switch(l){case"cn":case"cn1":case"cn2":c>10&&(c%10==0||c>10&&20>c)?i=2:c>20&&(i=3);break;case"num2":c>9&&(i=2)}e.className="list-"+r[l]+c+" list-"+l+"-paddingleft-"+i}else e.className="list-"+r[l]+" list-"+l+"-paddingleft"}else e.className=e.className.replace(/list-[\w\-]+/gi,"");var o=e.getAttribute("class");null===o||o.replace(/\s/g,"")||domUtils.removeAttributes(e,"class")}}),!i&&l(n,n.tagName.toLowerCase(),t(n)||domUtils.getStyle(n,"list-style-type"),!0)}})}function l(e,l,o,n){var s=e.nextSibling;s&&1==s.nodeType&&s.tagName.toLowerCase()==l&&(t(s)||domUtils.getStyle(s,"list-style-type")||("ol"==l?"decimal":"disc"))==o&&(domUtils.moveChild(s,e),0==s.childNodes.length&&domUtils.remove(s)),s&&domUtils.isFillChar(s)&&domUtils.remove(s);var a=e.previousSibling;a&&1==a.nodeType&&a.tagName.toLowerCase()==l&&(t(a)||domUtils.getStyle(a,"list-style-type")||("ol"==l?"decimal":"disc"))==o&&domUtils.moveChild(e,a),a&&domUtils.isFillChar(a)&&domUtils.remove(a),!n&&domUtils.isEmptyBlock(e)&&domUtils.remove(e),t(e)&&i(e.ownerDocument,!0)}function o(e,t){r[t]&&(e.className="custom_"+t);try{domUtils.setStyle(e,"list-style-type",t)}catch(i){}}function n(e){var t=e.previousSibling;t&&domUtils.isEmptyBlock(t)&&domUtils.remove(t),t=e.nextSibling,t&&domUtils.isEmptyBlock(t)&&domUtils.remove(t)}function s(e){for(;e&&!domUtils.isBody(e);){if("TABLE"==e.nodeName)return null;if("LI"==e.nodeName)return e;e=e.parentNode}}var a=this,d={TD:1,PRE:1,BLOCKQUOTE:1},r={cn:"cn-1-",cn1:"cn-2-",cn2:"cn-3-",num:"num-1-",num1:"num-2-",num2:"num-3-",dash:"dash",dot:"dot"};a.setOpt({autoTransWordToList:!1,insertorderedlist:{num:"",num1:"",num2:"",cn:"",cn1:"",cn2:"",decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:"",dash:"",dot:""},listDefaultPaddingLeft:"30",listiconpath:"http://bs.baidu.com/listicon/",maxListLevel:-1,disablePInList:!1});var m={OL:e(a.options.insertorderedlist),UL:e(a.options.insertunorderedlist)},p=a.options.listiconpath;for(var c in r)a.options.insertorderedlist.hasOwnProperty(c)||a.options.insertunorderedlist.hasOwnProperty(c)||delete r[c];a.ready(function(){var e=[];for(var t in r){if("dash"==t||"dot"==t)e.push("li.list-"+r[t]+"{background-image:url("+p+r[t]+".gif)}"),e.push("ul.custom_"+t+"{list-style:none;}ul.custom_"+t+" li{background-position:0 3px;background-repeat:no-repeat}");else{for(var i=0;99>i;i++)e.push("li.list-"+r[t]+i+"{background-image:url("+p+"list-"+r[t]+i+".gif)}");e.push("ol.custom_"+t+"{list-style:none;}ol.custom_"+t+" li{background-position:0 3px;background-repeat:no-repeat}")}switch(t){case"cn":e.push("li.list-"+t+"-paddingleft-1{padding-left:25px}"),e.push("li.list-"+t+"-paddingleft-2{padding-left:40px}"),e.push("li.list-"+t+"-paddingleft-3{padding-left:55px}");break;case"cn1":e.push("li.list-"+t+"-paddingleft-1{padding-left:30px}"),e.push("li.list-"+t+"-paddingleft-2{padding-left:40px}"),e.push("li.list-"+t+"-paddingleft-3{padding-left:55px}");break;case"cn2":e.push("li.list-"+t+"-paddingleft-1{padding-left:40px}"),e.push("li.list-"+t+"-paddingleft-2{padding-left:55px}"),e.push("li.list-"+t+"-paddingleft-3{padding-left:68px}");break;case"num":case"num1":e.push("li.list-"+t+"-paddingleft-1{padding-left:25px}");break;case"num2":e.push("li.list-"+t+"-paddingleft-1{padding-left:35px}"),e.push("li.list-"+t+"-paddingleft-2{padding-left:40px}");break;case"dash":e.push("li.list-"+t+"-paddingleft{padding-left:35px}");break;case"dot":e.push("li.list-"+t+"-paddingleft{padding-left:20px}")}}e.push(".list-paddingleft-1{padding-left:0}"),e.push(".list-paddingleft-2{padding-left:"+a.options.listDefaultPaddingLeft+"px}"),e.push(".list-paddingleft-3{padding-left:"+2*a.options.listDefaultPaddingLeft+"px}"),utils.cssRule("list","ol,ul{margin:0;pading:0;"+(browser.ie?"":"width:95%")+"}li{clear:both;}"+e.join("\n"),a.document)}),a.ready(function(){domUtils.on(a.body,"cut",function(){setTimeout(function(){var e,t=a.selection.getRange();if(!t.collapsed&&(e=domUtils.findParentByTagName(t.startContainer,"li",!0))&&!e.nextSibling&&domUtils.isEmptyBlock(e)){var i,l=e.parentNode;if(i=l.previousSibling)domUtils.remove(l),t.setStartAtLast(i).collapse(!0),t.select(!0);else if(i=l.nextSibling)domUtils.remove(l),t.setStartAtFirst(i).collapse(!0),t.select(!0);else{var o=a.document.createElement("p");domUtils.fillNode(a.document,o),l.parentNode.insertBefore(o,l),domUtils.remove(l),t.setStart(o,0).collapse(!0),t.select(!0)}}})})}),a.addListener("beforepaste",function(e,i){var l,o=this,n=o.selection.getRange(),s=UE.htmlparser(i.html,!0);if(l=domUtils.findParentByTagName(n.startContainer,"li",!0)){var a=l.parentNode,d="OL"==a.tagName?"ul":"ol";utils.each(s.getNodesByTagName(d),function(i){if(i.tagName=a.tagName,i.setAttr(),i.parentNode===s)e=t(a)||("OL"==a.tagName?"decimal":"disc");else{var l=i.parentNode.getAttr("class");e=l&&/custom_/.test(l)?l.match(/custom_(\w+)/)[1]:i.parentNode.getStyle("list-style-type"),e||(e="OL"==a.tagName?"decimal":"disc")}var o=utils.indexOf(m[a.tagName],e);i.parentNode!==s&&(o=o+1==m[a.tagName].length?0:o+1);var n=m[a.tagName][o];r[n]?i.setAttr("class","custom_"+n):i.setStyle("list-style-type",n)})}i.html=s.toHtml()}),a.getOpt("disablePInList")===!0&&a.addOutputRule(function(e){utils.each(e.getNodesByTagName("li"),function(e){var t=[],i=0;utils.each(e.children,function(l){if("p"==l.tagName){for(var o;o=l.children.pop();)t.splice(i,0,o),o.parentNode=e,lastNode=o;if(o=t[t.length-1],!o||"element"!=o.type||"br"!=o.tagName){var n=UE.uNode.createElement("br");n.parentNode=e,t.push(n)}i=t.length}}),t.length&&(e.children=t)})}),a.addInputRule(function(e){function t(e,t){var o=t.firstChild();if(o&&"element"==o.type&&"span"==o.tagName&&/Wingdings|Symbol/.test(o.getStyle("font-family"))){for(var n in l)if(l[n]==o.data)return n;return"disc"}for(var n in i)if(i[n].test(e))return n}if(utils.each(e.getNodesByTagName("li"),function(e){for(var t,i=UE.uNode.createElement("p"),l=0;t=e.children[l];)"text"==t.type||dtd.p[t.tagName]?i.appendChild(t):i.firstChild()?(e.insertBefore(i,t),i=UE.uNode.createElement("p"),l+=2):l++;(i.firstChild()&&!i.parentNode||!e.firstChild())&&e.appendChild(i),i.firstChild()||i.innerHTML(browser.ie?"&nbsp;":"<br/>");var o=e.firstChild(),n=o.lastChild();n&&"text"==n.type&&/^\s*$/.test(n.data)&&o.removeChild(n)}),a.options.autoTransWordToList){var i={num1:/^\d+\)/,decimal:/^\d+\./,"lower-alpha":/^[a-z]+\)/,"upper-alpha":/^[A-Z]+\./,cn:/^[\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+[\u3001]/,cn2:/^\([\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+\)/},l={square:"n"};utils.each(e.getNodesByTagName("p"),function(e){function l(e,t,l){if("ol"==e.tagName)if(browser.ie){var o=t.firstChild();"element"==o.type&&"span"==o.tagName&&i[l].test(o.innerText())&&t.removeChild(o)}else t.innerHTML(t.innerHTML().replace(i[l],""));else t.removeChild(t.firstChild());var n=UE.uNode.createElement("li");n.appendChild(t),e.appendChild(n)}if("MsoListParagraph"==e.getAttr("class")){e.setStyle("margin",""),e.setStyle("margin-left",""),e.setAttr("class","");var o,n=e,s=e;if("li"!=e.parentNode.tagName&&(o=t(e.innerText(),e))){var d=UE.uNode.createElement(a.options.insertorderedlist.hasOwnProperty(o)?"ol":"ul");for(r[o]?d.setAttr("class","custom_"+o):d.setStyle("list-style-type",o);e&&"li"!=e.parentNode.tagName&&t(e.innerText(),e);)n=e.nextSibling(),n||e.parentNode.insertBefore(d,e),l(d,e,o),e=n;!d.parentNode&&e&&e.parentNode&&e.parentNode.insertBefore(d,e)}var m=s.firstChild();m&&"element"==m.type&&"span"==m.tagName&&/^\s*(&nbsp;)+\s*$/.test(m.innerText())&&m.parentNode.removeChild(m)}})}}),a.addListener("contentchange",function(){i(a.document)}),a.addListener("keydown",function(e,t){function i(){t.preventDefault?t.preventDefault():t.returnValue=!1,a.fireEvent("contentchange"),a.undoManger&&a.undoManger.save()}function l(e,t){for(;e&&!domUtils.isBody(e);){if(t(e))return null;if(1==e.nodeType&&/[ou]l/i.test(e.tagName))return e;e=e.parentNode}return null}var o=t.keyCode||t.which;if(13==o&&!t.shiftKey){var s=a.selection.getRange(),d=domUtils.findParent(s.startContainer,function(e){return domUtils.isBlockElm(e)},!0),r=domUtils.findParentByTagName(s.startContainer,"li",!0);if(d&&"PRE"!=d.tagName&&!r){var m=d.innerHTML.replace(new RegExp(domUtils.fillChar,"g"),"");/^\s*1\s*\.[^\d]/.test(m)&&(d.innerHTML=m.replace(/^\s*1\s*\./,""),s.setStartAtLast(d).collapse(!0).select(),a.__hasEnterExecCommand=!0,a.execCommand("insertorderedlist"),a.__hasEnterExecCommand=!1)}var p=a.selection.getRange(),c=l(p.startContainer,function(e){return"TABLE"==e.tagName}),f=p.collapsed?c:l(p.endContainer,function(e){return"TABLE"==e.tagName});if(c&&f&&c===f){if(!p.collapsed){if(c=domUtils.findParentByTagName(p.startContainer,"li",!0),f=domUtils.findParentByTagName(p.endContainer,"li",!0),!c||!f||c!==f){var u=p.cloneRange(),g=u.collapse(!1).createBookmark();p.deleteContents(),u.moveToBookmark(g);var r=domUtils.findParentByTagName(u.startContainer,"li",!0);return n(r),u.select(),void i()}if(p.deleteContents(),r=domUtils.findParentByTagName(p.startContainer,"li",!0),r&&domUtils.isEmptyBlock(r))return y=r.previousSibling,next=r.nextSibling,v=a.document.createElement("p"),domUtils.fillNode(a.document,v),h=r.parentNode,y&&next?(p.setStart(next,0).collapse(!0).select(!0),domUtils.remove(r)):((y||next)&&y?r.parentNode.parentNode.insertBefore(v,h.nextSibling):h.parentNode.insertBefore(v,h),domUtils.remove(r),h.firstChild||domUtils.remove(h),p.setStart(v,0).setCursor()),void i()}if(r=domUtils.findParentByTagName(p.startContainer,"li",!0)){if(domUtils.isEmptyBlock(r)){g=p.createBookmark();var h=r.parentNode;if(r!==h.lastChild?(domUtils.breakParent(r,h),n(r)):(h.parentNode.insertBefore(r,h.nextSibling),domUtils.isEmptyNode(h)&&domUtils.remove(h)),!dtd.$list[r.parentNode.tagName])if(domUtils.isBlockElm(r.firstChild))domUtils.remove(r,!0);else{for(v=a.document.createElement("p"),r.parentNode.insertBefore(v,r);r.firstChild;)v.appendChild(r.firstChild);domUtils.remove(r)}p.moveToBookmark(g).select()}else{var N=r.firstChild;if(!N||!domUtils.isBlockElm(N)){var v=a.document.createElement("p");for(!r.firstChild&&domUtils.fillNode(a.document,v);r.firstChild;)v.appendChild(r.firstChild);r.appendChild(v),N=v}var C=a.document.createElement("span");p.insertNode(C),domUtils.breakParent(C,r);var U=C.nextSibling;N=U.firstChild,N||(v=a.document.createElement("p"),domUtils.fillNode(a.document,v),U.appendChild(v),N=v),domUtils.isEmptyNode(N)&&(N.innerHTML="",domUtils.fillNode(a.document,N)),p.setStart(N,0).collapse(!0).shrinkBoundary().select(),domUtils.remove(C);var y=U.previousSibling;y&&domUtils.isEmptyBlock(y)&&(y.innerHTML="<p></p>",domUtils.fillNode(a.document,y.firstChild))}i()}}}if(8==o&&(p=a.selection.getRange(),p.collapsed&&domUtils.isStartInblock(p)&&(u=p.cloneRange().trimBoundary(),r=domUtils.findParentByTagName(p.startContainer,"li",!0),r&&domUtils.isStartInblock(u)))){if(c=domUtils.findParentByTagName(p.startContainer,"p",!0),c&&c!==r.firstChild){var h=domUtils.findParentByTagName(c,["ol","ul"]);return domUtils.breakParent(c,h),n(c),a.fireEvent("contentchange"),p.setStart(c,0).setCursor(!1,!0),a.fireEvent("saveScene"),void domUtils.preventDefault(t)}if(r&&(y=r.previousSibling)){if(46==o&&r.childNodes.length)return;if(dtd.$list[y.tagName]&&(y=y.lastChild),a.undoManger&&a.undoManger.save(),N=r.firstChild,domUtils.isBlockElm(N))if(domUtils.isEmptyNode(N))for(y.appendChild(N),p.setStart(N,0).setCursor(!1,!0);r.firstChild;)y.appendChild(r.firstChild);else C=a.document.createElement("span"),p.insertNode(C),domUtils.isEmptyBlock(y)&&(y.innerHTML=""),domUtils.moveChild(r,y),p.setStartBefore(C).collapse(!0).select(!0),domUtils.remove(C);else if(domUtils.isEmptyNode(r)){var v=a.document.createElement("p");y.appendChild(v),p.setStart(v,0).setCursor()}else for(p.setEnd(y,y.childNodes.length).collapse().select(!0);r.firstChild;)y.appendChild(r.firstChild);return domUtils.remove(r),a.fireEvent("contentchange"),a.fireEvent("saveScene"),void domUtils.preventDefault(t)}if(r&&!r.previousSibling){var h=r.parentNode,g=p.createBookmark();if(domUtils.isTagNode(h.parentNode,"ol ul"))h.parentNode.insertBefore(r,h),domUtils.isEmptyNode(h)&&domUtils.remove(h);else{for(;r.firstChild;)h.parentNode.insertBefore(r.firstChild,h);domUtils.remove(r),domUtils.isEmptyNode(h)&&domUtils.remove(h)}return p.moveToBookmark(g).setCursor(!1,!0),a.fireEvent("contentchange"),a.fireEvent("saveScene"),void domUtils.preventDefault(t)}}}),a.addListener("keyup",function(e,i){var o=i.keyCode||i.which;if(8==o){var n,s=a.selection.getRange();(n=domUtils.findParentByTagName(s.startContainer,["ol","ul"],!0))&&l(n,n.tagName.toLowerCase(),t(n)||domUtils.getComputedStyle(n,"list-style-type"),!0)}}),a.addListener("tabkeydown",function(){function e(e){if(-1!=a.options.maxListLevel){for(var t=e.parentNode,i=0;/[ou]l/i.test(t.tagName);)i++,t=t.parentNode;if(i>=a.options.maxListLevel)return!0}}var i=a.selection.getRange(),n=domUtils.findParentByTagName(i.startContainer,"li",!0);if(n){var s;if(!i.collapsed){a.fireEvent("saveScene"),s=i.createBookmark();for(var d,r,p=0,c=domUtils.findParents(n);r=c[p++];)if(domUtils.isTagNode(r,"ol ul")){d=r;break}var f=n;if(s.end)for(;f&&!(domUtils.getPosition(f,s.end)&domUtils.POSITION_FOLLOWING);)if(e(f))f=domUtils.getNextDomNode(f,!1,null,function(e){return e!==d});else{var u=f.parentNode,g=a.document.createElement(u.tagName),h=utils.indexOf(m[g.tagName],t(u)||domUtils.getComputedStyle(u,"list-style-type")),N=h+1==m[g.tagName].length?0:h+1,v=m[g.tagName][N];for(o(g,v),u.insertBefore(g,f);f&&!(domUtils.getPosition(f,s.end)&domUtils.POSITION_FOLLOWING);){if(n=f.nextSibling,g.appendChild(f),!n||domUtils.isTagNode(n,"ol ul")){if(n)for(;(n=n.firstChild)&&"LI"!=n.tagName;);else n=domUtils.getNextDomNode(f,!1,null,function(e){return e!==d});break}f=n}l(g,g.tagName.toLowerCase(),v),f=n}return a.fireEvent("contentchange"),i.moveToBookmark(s).select(),!0}if(e(n))return!0;var u=n.parentNode,g=a.document.createElement(u.tagName),h=utils.indexOf(m[g.tagName],t(u)||domUtils.getComputedStyle(u,"list-style-type"));h=h+1==m[g.tagName].length?0:h+1;var v=m[g.tagName][h];if(o(g,v),domUtils.isStartInblock(i))return a.fireEvent("saveScene"),s=i.createBookmark(),u.insertBefore(g,n),g.appendChild(n),l(g,g.tagName.toLowerCase(),v),a.fireEvent("contentchange"),i.moveToBookmark(s).select(!0),!0}}),a.commands.insertorderedlist=a.commands.insertunorderedlist={execCommand:function(e,i){i||(i="insertorderedlist"==e.toLowerCase()?"decimal":"disc");var n=this,a=this.selection.getRange(),r=function(e){return 1==e.nodeType?"br"!=e.tagName.toLowerCase():!domUtils.isWhitespace(e)},m="insertorderedlist"==e.toLowerCase()?"ol":"ul",p=n.document.createDocumentFragment();a.adjustmentBoundary().shrinkBoundary();var c,f,u,g,h=a.createBookmark(!0),N=s(n.document.getElementById(h.start)),v=0,C=s(n.document.getElementById(h.end)),U=0;if(N||C){if(N&&(c=N.parentNode),h.end||(C=N),C&&(f=C.parentNode),c===f){for(;N!==C;){if(g=N,N=N.nextSibling,!domUtils.isBlockElm(g.firstChild)){for(var y=n.document.createElement("p");g.firstChild;)y.appendChild(g.firstChild);g.appendChild(y)}p.appendChild(g)}if(g=n.document.createElement("span"),c.insertBefore(g,C),!domUtils.isBlockElm(C.firstChild)){for(y=n.document.createElement("p");C.firstChild;)y.appendChild(C.firstChild);C.appendChild(y)}p.appendChild(C),domUtils.breakParent(g,c),domUtils.isEmptyNode(g.previousSibling)&&domUtils.remove(g.previousSibling),domUtils.isEmptyNode(g.nextSibling)&&domUtils.remove(g.nextSibling);var E=t(c)||domUtils.getComputedStyle(c,"list-style-type")||("insertorderedlist"==e.toLowerCase()?"decimal":"disc");if(c.tagName.toLowerCase()==m&&E==i){for(var B,k=0,b=n.document.createDocumentFragment();B=p.firstChild;)if(domUtils.isTagNode(B,"ol ul"))b.appendChild(B);else for(;B.firstChild;)b.appendChild(B.firstChild),domUtils.remove(B);g.parentNode.insertBefore(b,g)}else u=n.document.createElement(m),o(u,i),u.appendChild(p),g.parentNode.insertBefore(u,g);return domUtils.remove(g),u&&l(u,m,i),void a.moveToBookmark(h).select()}if(N){for(;N;){if(g=N.nextSibling,domUtils.isTagNode(N,"ol ul"))p.appendChild(N);else{for(var S=n.document.createDocumentFragment(),T=0;N.firstChild;)domUtils.isBlockElm(N.firstChild)&&(T=1),S.appendChild(N.firstChild);if(T)p.appendChild(S);else{var x=n.document.createElement("p");x.appendChild(S),p.appendChild(x)}domUtils.remove(N)}N=g}c.parentNode.insertBefore(p,c.nextSibling),domUtils.isEmptyNode(c)?(a.setStartBefore(c),domUtils.remove(c)):a.setStartAfter(c),v=1}if(C&&domUtils.inDoc(f,n.document)){for(N=f.firstChild;N&&N!==C;){if(g=N.nextSibling,domUtils.isTagNode(N,"ol ul"))p.appendChild(N);else{for(S=n.document.createDocumentFragment(),T=0;N.firstChild;)domUtils.isBlockElm(N.firstChild)&&(T=1),S.appendChild(N.firstChild);T?p.appendChild(S):(x=n.document.createElement("p"),x.appendChild(S),p.appendChild(x)),domUtils.remove(N)}N=g}var L=domUtils.createElement(n.document,"div",{tmpDiv:1});domUtils.moveChild(C,L),p.appendChild(L),domUtils.remove(C),f.parentNode.insertBefore(p,f),a.setEndBefore(f),domUtils.isEmptyNode(f)&&domUtils.remove(f),U=1}}v||a.setStartBefore(n.document.getElementById(h.start)),h.end&&!U&&a.setEndAfter(n.document.getElementById(h.end)),a.enlarge(!0,function(e){return d[e.tagName]}),p=n.document.createDocumentFragment();for(var P,w=a.createBookmark(),D=domUtils.getNextDomNode(w.start,!1,r),O=a.cloneRange(),_=domUtils.isBlockElm;D&&D!==w.end&&domUtils.getPosition(D,w.end)&domUtils.POSITION_PRECEDING;)if(3==D.nodeType||dtd.li[D.tagName]){if(1==D.nodeType&&dtd.$list[D.tagName]){for(;D.firstChild;)p.appendChild(D.firstChild);P=domUtils.getNextDomNode(D,!1,r),domUtils.remove(D),D=P;continue}for(P=D,O.setStartBefore(D);D&&D!==w.end&&(!_(D)||domUtils.isBookmarkNode(D));)P=D,D=domUtils.getNextDomNode(D,!1,null,function(e){return!d[e.tagName]});D&&_(D)&&(g=domUtils.getNextDomNode(P,!1,r),g&&domUtils.isBookmarkNode(g)&&(D=domUtils.getNextDomNode(g,!1,r),P=g)),O.setEndAfter(P),D=domUtils.getNextDomNode(P,!1,r);var A=a.document.createElement("li");if(A.appendChild(O.extractContents()),domUtils.isEmptyNode(A)){for(var P=a.document.createElement("p");A.firstChild;)P.appendChild(A.firstChild);A.appendChild(P)}p.appendChild(A)}else D=domUtils.getNextDomNode(D,!0,r);a.moveToBookmark(w).collapse(!0),u=n.document.createElement(m),o(u,i),u.appendChild(p),a.insertNode(u),l(u,m,i);for(var B,k=0,I=domUtils.getElementsByTagName(u,"div");B=I[k++];)B.getAttribute("tmpDiv")&&domUtils.remove(B,!0);a.moveToBookmark(h).select()},queryCommandState:function(e){for(var t,i="insertorderedlist"==e.toLowerCase()?"ol":"ul",l=this.selection.getStartElementPath(),o=0;t=l[o++];){if("TABLE"==t.nodeName)return 0;if(i==t.nodeName.toLowerCase())return 1}return 0},queryCommandValue:function(e){for(var i,l,o="insertorderedlist"==e.toLowerCase()?"ol":"ul",n=this.selection.getStartElementPath(),s=0;l=n[s++];){if("TABLE"==l.nodeName){i=null;break}if(o==l.nodeName.toLowerCase()){i=l;break}}return i?t(i)||domUtils.getComputedStyle(i,"list-style-type"):null}}};