UE.commands.imagefloat={execCommand:function(e,t){var i=this,l=i.selection.getRange();if(!l.collapsed){var a=l.getClosedNode();if(a&&"IMG"==a.tagName)switch(t){case"left":case"right":case"none":for(var o,s,n,r=a.parentNode;dtd.$inline[r.tagName]||"A"==r.tagName;)r=r.parentNode;if(o=r,"P"==o.tagName&&"center"==domUtils.getStyle(o,"text-align")){if(!domUtils.isBody(o)&&1==domUtils.getChildCount(o,function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)}))if(s=o.previousSibling,n=o.nextSibling,s&&n&&1==s.nodeType&&1==n.nodeType&&s.tagName==n.tagName&&domUtils.isBlockElm(s)){for(s.appendChild(o.firstChild);n.firstChild;)s.appendChild(n.firstChild);domUtils.remove(o),domUtils.remove(n)}else domUtils.setStyle(o,"text-align","");l.selectNode(a).select()}domUtils.setStyle(a,"float","none"==t?"":t),"none"==t&&domUtils.removeAttributes(a,"align");break;case"center":if("center"!=i.queryCommandValue("imagefloat")){for(r=a.parentNode,domUtils.setStyle(a,"float",""),domUtils.removeAttributes(a,"align"),o=a;r&&1==domUtils.getChildCount(r,function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)})&&(dtd.$inline[r.tagName]||"A"==r.tagName);)o=r,r=r.parentNode;l.setStartBefore(o).setCursor(!1),r=i.document.createElement("div"),r.appendChild(o),domUtils.setStyle(o,"float",""),i.execCommand("insertHtml",'<p id="_img_parent_tmp" style="text-align:center">'+r.innerHTML+"</p>"),o=i.document.getElementById("_img_parent_tmp"),o.removeAttribute("id"),o=o.firstChild,l.selectNode(o).select(),n=o.parentNode.nextSibling,n&&domUtils.isEmptyNode(n)&&domUtils.remove(n)}}}},queryCommandValue:function(){var e,t,i=this.selection.getRange();return i.collapsed?"none":(e=i.getClosedNode(),e&&1==e.nodeType&&"IMG"==e.tagName?(t=domUtils.getComputedStyle(e,"float")||e.getAttribute("align"),"none"==t&&(t="center"==domUtils.getComputedStyle(e.parentNode,"text-align")?"center":t),{left:1,right:1,center:1}[t]?t:"none"):"none")},queryCommandState:function(){var e,t=this.selection.getRange();return t.collapsed?-1:(e=t.getClosedNode(),e&&1==e.nodeType&&"IMG"==e.tagName?0:-1)}},UE.commands.insertimage={execCommand:function(e,t){if(t=utils.isArray(t)?t:[t],t.length){var i=this,l=i.selection.getRange(),a=l.getClosedNode();if(i.fireEvent("beforeinsertimage",t)!==!0){if(!a||!/img/i.test(a.tagName)||"edui-faked-video"==a.className&&-1==a.className.indexOf("edui-upload-video")||a.getAttribute("word_img")){var o,s=[],n="";if(o=t[0],1==t.length)n='<img src="'+o.src+'" '+(o._src?' _src="'+o._src+'" ':"")+(o.width?'width="'+o.width+'" ':"")+(o.height?' height="'+o.height+'" ':"")+("left"==o.floatStyle||"right"==o.floatStyle?' style="float:'+o.floatStyle+';"':"")+(o.title&&""!=o.title?' title="'+o.title+'"':"")+(o.border&&"0"!=o.border?' border="'+o.border+'"':"")+(o.alt&&""!=o.alt?' alt="'+o.alt+'"':"")+(o.hspace&&"0"!=o.hspace?' hspace = "'+o.hspace+'"':"")+(o.vspace&&"0"!=o.vspace?' vspace = "'+o.vspace+'"':"")+"/>","center"==o.floatStyle&&(n='<p style="text-align: center">'+n+"</p>"),s.push(n);else for(var r=0;o=t[r++];)n="<p "+("center"==o.floatStyle?'style="text-align: center" ':"")+'><img src="'+o.src+'" '+(o.width?'width="'+o.width+'" ':"")+(o._src?' _src="'+o._src+'" ':"")+(o.height?' height="'+o.height+'" ':"")+' style="'+(o.floatStyle&&"center"!=o.floatStyle?"float:"+o.floatStyle+";":"")+(o.border||"")+'" '+(o.title?' title="'+o.title+'"':"")+" /></p>",s.push(n);i.execCommand("insertHtml",s.join(""))}else{var d=t.shift(),m=d.floatStyle;delete d.floatStyle,domUtils.setAttributes(a,d),i.execCommand("imagefloat",m),t.length>0&&(l.setStartAfter(a).setCursor(!1,!0),i.execCommand("insertimage",t))}i.fireEvent("afterinsertimage",t)}}}};