UE.plugins.paragraph=function(){var t=this,e=domUtils.isBlockElm,s=["TD","LI","PRE"],o=function(t,o,i,l){var r,d=t.createBookmark(),a=function(t){return 1==t.nodeType?"br"!=t.tagName.toLowerCase()&&!domUtils.isBookmarkNode(t):!domUtils.isWhitespace(t)};t.enlarge(!0);for(var n,m=t.createBookmark(),c=domUtils.getNextDomNode(m.start,!1,a),p=t.cloneRange();c&&!(domUtils.getPosition(c,m.end)&domUtils.POSITION_FOLLOWING);)if(3!=c.nodeType&&e(c))c=domUtils.getNextDomNode(c,!0,a);else{for(p.setStartBefore(c);c&&c!==m.end&&!e(c);)n=c,c=domUtils.getNextDomNode(c,!1,null,function(t){return!e(t)});p.setEndAfter(n),r=t.document.createElement(o),i&&(domUtils.setAttributes(r,i),l&&"customstyle"==l&&i.style&&(r.style.cssText=i.style)),r.appendChild(p.extractContents()),domUtils.isEmptyNode(r)&&domUtils.fillChar(t.document,r),p.insertNode(r);var g=r.parentNode;e(g)&&!domUtils.isBody(r.parentNode)&&-1==utils.indexOf(s,g.tagName)&&(l&&"customstyle"==l||(g.getAttribute("dir")&&r.setAttribute("dir",g.getAttribute("dir")),g.style.cssText&&(r.style.cssText=g.style.cssText+";"+r.style.cssText),g.style.textAlign&&!r.style.textAlign&&(r.style.textAlign=g.style.textAlign),g.style.textIndent&&!r.style.textIndent&&(r.style.textIndent=g.style.textIndent),g.style.padding&&!r.style.padding&&(r.style.padding=g.style.padding)),i&&/h\d/i.test(g.tagName)&&!/h\d/i.test(r.tagName)?(domUtils.setAttributes(g,i),l&&"customstyle"==l&&i.style&&(g.style.cssText=i.style),domUtils.remove(r,!0),r=g):domUtils.remove(r.parentNode,!0)),c=-1!=utils.indexOf(s,g.tagName)?g:r,c=domUtils.getNextDomNode(c,!1,a)}return t.moveToBookmark(m).moveToBookmark(d)};t.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""}),t.commands.paragraph={execCommand:function(t,e,s,i){var l=this.selection.getRange();if(l.collapsed){var r=this.document.createTextNode("p");if(l.insertNode(r),browser.ie){var d=r.previousSibling;d&&domUtils.isWhitespace(d)&&domUtils.remove(d),d=r.nextSibling,d&&domUtils.isWhitespace(d)&&domUtils.remove(d)}}if(l=o(l,e,s,i),r&&(l.setStartBefore(r).collapse(!0),pN=r.parentNode,domUtils.remove(r),domUtils.isBlockElm(pN)&&domUtils.isEmptyNode(pN)&&domUtils.fillNode(this.document,pN)),browser.gecko&&l.collapsed&&1==l.startContainer.nodeType){var a=l.startContainer.childNodes[l.startOffset];a&&1==a.nodeType&&a.tagName.toLowerCase()==e&&l.setStart(a,0).collapse(!0)}return l.select(),!0},queryCommandValue:function(){var t=domUtils.filterNodeList(this.selection.getStartElementPath(),"p h1 h2 h3 h4 h5 h6");return t?t.tagName.toLowerCase():""}}};