UE.plugins.paste=function(){function e(e){var t=this.document;if(!t.getElementById("baidu_pastebin")){var r=this.selection.getRange(),o=r.createBookmark(),n=t.createElement("div");n.id="baidu_pastebin",browser.webkit&&n.appendChild(t.createTextNode(domUtils.fillChar+domUtils.fillChar)),t.body.appendChild(n),o.start.style.display="",n.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+domUtils.getXY(o.start).y+"px",r.selectNodeContents(n).select(!0),setTimeout(function(){if(browser.webkit)for(var i,a=0,s=t.querySelectorAll("#baidu_pastebin");i=s[a++];){if(!domUtils.isEmptyNode(i)){n=i;break}domUtils.remove(i)}try{n.parentNode.removeChild(n)}catch(l){}r.moveToBookmark(o).select(!0),e(n)},0)}}function t(e){return e.replace(/<(\/?)([\w\-]+)([^>]*)>/gi,function(e,t,r,o){return r=r.toLowerCase(),{img:1}[r]?e:(o=o.replace(/([\w\-]*?)\s*=\s*(("([^"]*)")|('([^']*)')|([^\s>]+))/gi,function(e,t,r){return{src:1,href:1,name:1}[t.toLowerCase()]?t+"="+r+" ":""}),{span:1,div:1}[r]?"":"<"+t+r+" "+utils.trim(o)+">")})}function r(e){var r;if(e.firstChild){for(var s,l=domUtils.getElementsByTagName(e,"span"),d=0;s=l[d++];)("_baidu_cut_start"==s.id||"_baidu_cut_end"==s.id)&&domUtils.remove(s);if(browser.webkit){for(var m,f=e.querySelectorAll("div br"),d=0;m=f[d++];){var c=m.parentNode;"DIV"==c.tagName&&1==c.childNodes.length&&(c.innerHTML="<p><br/></p>",domUtils.remove(c))}for(var p,u=e.querySelectorAll("#baidu_pastebin"),d=0;p=u[d++];){var v=o.document.createElement("p");for(p.parentNode.insertBefore(v,p);p.firstChild;)v.appendChild(p.firstChild);domUtils.remove(p)}for(var b,y=e.querySelectorAll("meta"),d=0;b=y[d++];)domUtils.remove(b);var f=e.querySelectorAll("br");for(d=0;b=f[d++];)/^apple-/i.test(b.className)&&domUtils.remove(b)}if(browser.gecko){var h=e.querySelectorAll("[_moz_dirty]");for(d=0;b=h[d++];)b.removeAttribute("_moz_dirty")}if(!browser.ie)for(var b,C=e.querySelectorAll("span.Apple-style-span"),d=0;b=C[d++];)domUtils.remove(b,!0);r=e.innerHTML,r=UE.filterWord(r);var g=UE.htmlparser(r);if(o.options.filterRules&&UE.filterNode(g,o.options.filterRules),o.filterInputRule(g),browser.webkit){var U=g.lastChild();U&&"element"==U.type&&"br"==U.tagName&&g.removeChild(U),utils.each(o.body.querySelectorAll("div"),function(e){domUtils.isEmptyBlock(e)&&domUtils.remove(e,!0)})}if(r={html:g.toHtml()},o.fireEvent("beforepaste",r,g),!r.html)return;g=UE.htmlparser(r.html,!0),1===o.queryCommandState("pasteplain")?o.execCommand("insertHtml",UE.filterNode(g,o.options.filterTxtRules).toHtml(),!0):(UE.filterNode(g,o.options.filterTxtRules),n=g.toHtml(),i=r.html,a=o.selection.getRange().createAddress(!0),o.execCommand("insertHtml",o.getOpt("retainOnlyLabelPasted")===!0?t(i):i,!0)),o.fireEvent("afterpaste",r)}}var o=this;o.setOpt({retainOnlyLabelPasted:!1});var n,i,a;o.addListener("pasteTransfer",function(e,r){if(a&&n&&i&&n!=i){var s=o.selection.getRange();if(s.moveToAddress(a,!0),!s.collapsed){for(;!domUtils.isBody(s.startContainer);){var l=s.startContainer;if(1==l.nodeType){if(l=l.childNodes[s.startOffset],!l){s.setStartBefore(s.startContainer);continue}var d=l.previousSibling;d&&3==d.nodeType&&new RegExp("^[\n\r	 "+domUtils.fillChar+"]*$").test(d.nodeValue)&&s.setStartBefore(d)}if(0!=s.startOffset)break;s.setStartBefore(s.startContainer)}for(;!domUtils.isBody(s.endContainer);){var m=s.endContainer;if(1==m.nodeType){if(m=m.childNodes[s.endOffset],!m){s.setEndAfter(s.endContainer);continue}var f=m.nextSibling;f&&3==f.nodeType&&new RegExp("^[\n\r	"+domUtils.fillChar+"]*$").test(f.nodeValue)&&s.setEndAfter(f)}if(s.endOffset!=s.endContainer[3==s.endContainer.nodeType?"nodeValue":"childNodes"].length)break;s.setEndAfter(s.endContainer)}}s.deleteContents(),s.select(!0),o.__hasEnterExecCommand=!0;var c=i;2===r?c=t(c):r&&(c=n),o.execCommand("inserthtml",c,!0),o.__hasEnterExecCommand=!1;for(var p=o.selection.getRange();!domUtils.isBody(p.startContainer)&&!p.startOffset&&p.startContainer[3==p.startContainer.nodeType?"nodeValue":"childNodes"].length;)p.setStartBefore(p.startContainer);var u=p.createAddress(!0);a.endAddress=u.startAddress}}),o.addListener("ready",function(){domUtils.on(o.body,"cut",function(){var e=o.selection.getRange();!e.collapsed&&o.undoManger&&o.undoManger.save()}),domUtils.on(o.body,browser.ie||browser.opera?"keydown":"paste",function(t){(!browser.ie&&!browser.opera||(t.ctrlKey||t.metaKey)&&"86"==t.keyCode)&&e.call(o,function(e){r(e)})})}),o.commands.paste={execCommand:function(t){browser.ie?(e.call(o,function(e){r(e)}),o.document.execCommand("paste")):alert(o.getLang("pastemsg"))}}};