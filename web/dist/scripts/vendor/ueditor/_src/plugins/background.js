UE.plugin.register("background",function(){function t(t){var e={},n=t.split(";");return utils.each(n,function(t){var n=t.indexOf(":"),o=utils.trim(t.substr(0,n)).toLowerCase();o&&(e[o]=utils.trim(t.substr(n+1)||""))}),e}function e(t){if(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n+":"+t[n]+"; ");utils.cssRule(r,e.length?"body{"+e.join("")+"}":"",o.document)}else utils.cssRule(r,"",o.document)}var n,o=this,r="editor_background",u=new RegExp("body[\\s]*\\{(.+)\\}","i"),i=o.hasContents;return o.hasContents=function(){return o.queryCommandValue("background")?!0:i.apply(o,arguments)},{bindEvents:{getAllHtml:function(t,e){var n=this.body,r=domUtils.getComputedStyle(n,"background-image"),u="";u=r.indexOf(o.options.imagePath)>0?r.substring(r.indexOf(o.options.imagePath),r.length-1).replace(/"|\(|\)/gi,""):"none"!=r?r.replace(/url\("?|"?\)/gi,""):"";var i='<style type="text/css">body{',a={"background-color":domUtils.getComputedStyle(n,"background-color")||"#ffffff","background-image":u?"url("+u+")":"","background-repeat":domUtils.getComputedStyle(n,"background-repeat")||"","background-position":browser.ie?domUtils.getComputedStyle(n,"background-position-x")+" "+domUtils.getComputedStyle(n,"background-position-y"):domUtils.getComputedStyle(n,"background-position"),height:domUtils.getComputedStyle(n,"height")};for(var s in a)a.hasOwnProperty(s)&&(i+=s+":"+a[s]+"; ");i+="}</style> ",e.push(i)},aftersetcontent:function(){0==n&&e()}},inputRule:function(o){n=!1,utils.each(o.getNodesByTagName("p"),function(o){var r=o.getAttr("data-background");r&&(n=!0,e(t(r)),o.parentNode.removeChild(o))})},outputRule:function(t){var e=this,n=(utils.cssRule(r,e.document)||"").replace(/[\n\r]+/g,"").match(u);n&&t.appendChild(UE.uNode.createElement('<p style="display:none;" data-background="'+utils.trim(n[1].replace(/"/g,"").replace(/[\s]+/g," "))+'"><br/></p>'))},commands:{background:{execCommand:function(t,n){e(n)},queryCommandValue:function(){var e=this,n=(utils.cssRule(r,e.document)||"").replace(/[\n\r]+/g,"").match(u);return n?t(n[1]):null},notNeedUndo:!0}}}});