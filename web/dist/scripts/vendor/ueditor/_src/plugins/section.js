UE.plugin.register("section",function(){function e(e){this.tag="",this.level=-1,this.dom=null,this.nextSection=null,this.previousSection=null,this.parentSection=null,this.startAddress=[],this.endAddress=[],this.children=[]}function t(t){var n=new e;return utils.extend(n,t)}function n(e,t){for(var n=t,s=0;s<e.length;s++){if(!n.childNodes)return null;n=n.childNodes[e[s]]}return n}var s=this;return{bindMultiEvents:{type:"aftersetcontent afterscencerestore",handler:function(){s.fireEvent("updateSections")}},bindEvents:{ready:function(){s.fireEvent("updateSections"),domUtils.on(s.body,"drop paste",function(){s.fireEvent("updateSections")})},afterexeccommand:function(e,t){"paragraph"==t&&s.fireEvent("updateSections")},keyup:function(e,t){var n=this,s=n.selection.getRange();if(1!=s.collapsed)n.fireEvent("updateSections");else{var r=t.keyCode||t.which;(13==r||8==r||46==r)&&n.fireEvent("updateSections")}}},commands:{getsections:{execCommand:function(e,n){function s(e){for(var t=0;t<d.length;t++)if(d[t](e))return t;return-1}function r(e,n){for(var d,o,l,a=null,u=e.childNodes,f=0,h=u.length;h>f;f++)if(l=u[f],d=s(l),d>=0){var v=i.selection.getRange().selectNode(l).createAddress(!0).startAddress,m=t({tag:l.tagName,title:l.innerText||l.textContent||"",level:d,dom:l,startAddress:utils.clone(v,[]),endAddress:utils.clone(v,[]),children:[]});for(c.nextSection=m,m.previousSection=c,o=c;d<=o.level;)o=o.parentSection;m.parentSection=o,o.children.push(m),a=c=m}else 1===l.nodeType&&r(l,n),a&&a.endAddress[a.endAddress.length-1]++}for(var d=n||["h1","h2","h3","h4","h5","h6"],o=0;o<d.length;o++)"string"==typeof d[o]?d[o]=function(e){return function(t){return t.tagName==e.toUpperCase()}}(d[o]):"function"!=typeof d[o]&&(d[o]=function(e){return null});var i=this,l=t({level:-1,title:"root"}),c=l;return r(i.body,l),l},notNeedUndo:!0},movesection:{execCommand:function(e,t,s,r){function d(e,t,n){for(var s=!1,r=!1,d=0;d<e.length&&!(d>=n.length);d++){if(n[d]>e[d]){s=!0;break}if(n[d]<e[d])break}for(var d=0;d<t.length&&!(d>=n.length);d++){if(n[d]<e[d]){r=!0;break}if(n[d]>e[d])break}return s&&r}var o,i,l=this;if(t&&s&&-1!=s.level&&(o=r?s.endAddress:s.startAddress,i=n(o,l.body),o&&i&&!d(t.startAddress,t.endAddress,o))){var c,a,u=n(t.startAddress,l.body),f=n(t.endAddress,l.body);if(r)for(c=f;c&&!(domUtils.getPosition(u,c)&domUtils.POSITION_FOLLOWING)&&(a=c.previousSibling,domUtils.insertAfter(i,c),c!=u);)c=a;else for(c=u;c&&!(domUtils.getPosition(c,f)&domUtils.POSITION_FOLLOWING)&&(a=c.nextSibling,i.parentNode.insertBefore(c,i),c!=f);)c=a;l.fireEvent("updateSections")}}},deletesection:{execCommand:function(e,t,n){function s(e){for(var t=r.body,n=0;n<e.length;n++){if(!t.childNodes)return null;t=t.childNodes[e[n]]}return t}var r=this;if(t){var d,o=s(t.startAddress),i=s(t.endAddress),l=o;if(n)domUtils.remove(l);else for(;l&&domUtils.inDoc(i,r.document)&&!(domUtils.getPosition(l,i)&domUtils.POSITION_FOLLOWING);)d=l.nextSibling,domUtils.remove(l),l=d;r.fireEvent("updateSections")}}},selectsection:{execCommand:function(e,t){if(!t&&!t.dom)return!1;var n=this,s=n.selection.getRange(),r={startAddress:utils.clone(t.startAddress,[]),endAddress:utils.clone(t.endAddress,[])};return r.endAddress[r.endAddress.length-1]++,s.moveToAddress(r).select().scrollToView(),!0},notNeedUndo:!0},scrolltosection:{execCommand:function(e,t){if(!t&&!t.dom)return!1;var n=this,s=n.selection.getRange(),r={startAddress:t.startAddress,endAddress:t.endAddress};return r.endAddress[r.endAddress.length-1]++,s.moveToAddress(r).scrollToView(),!0},notNeedUndo:!0}}}});