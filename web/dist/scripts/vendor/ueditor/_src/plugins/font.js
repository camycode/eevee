UE.plugins.font=function(){function e(e){for(var t;(t=e.parentNode)&&"SPAN"==t.tagName&&1==domUtils.getChildCount(t,function(e){return!domUtils.isBookmarkNode(e)&&!domUtils.isBr(e)});)t.style.cssText+=e.style.cssText,domUtils.remove(e,!0),e=t}function t(e,t,o){if(n[t]&&(e.adjustmentBoundary(),!e.collapsed&&1==e.startContainer.nodeType)){var s=e.startContainer.childNodes[e.startOffset];if(s&&domUtils.isTagNode(s,"span")){var r=e.createBookmark();utils.each(domUtils.getElementsByTagName(s,"span"),function(e){e.parentNode&&!domUtils.isBookmarkNode(e)&&("backcolor"!=t||domUtils.getComputedStyle(e,"background-color").toLowerCase()!==o)&&(domUtils.removeStyle(e,n[t]),0==e.style.cssText.replace(/^\s+$/,"").length&&domUtils.remove(e,!0))}),e.moveToBookmark(r)}}}function o(o,s,r){var a,n=o.collapsed,i=o.createBookmark();if(n)for(a=i.start.parentNode;dtd.$inline[a.tagName];)a=a.parentNode;else a=domUtils.getCommonAncestor(i.start,i.end);utils.each(domUtils.getElementsByTagName(a,"span"),function(t){if(t.parentNode&&!domUtils.isBookmarkNode(t)){if(/\s*border\s*:\s*none;?\s*/i.test(t.style.cssText))return void(/^\s*border\s*:\s*none;?\s*$/.test(t.style.cssText)?domUtils.remove(t,!0):domUtils.removeStyle(t,"border"));if(/border/i.test(t.style.cssText)&&"SPAN"==t.parentNode.tagName&&/border/i.test(t.parentNode.style.cssText)&&(t.style.cssText=t.style.cssText.replace(/border[^:]*:[^;]+;?/gi,"")),"fontborder"!=s||"none"!=r)for(var o=t.nextSibling;o&&1==o.nodeType&&"SPAN"==o.tagName;)if(domUtils.isBookmarkNode(o)&&"fontborder"==s)t.appendChild(o),o=t.nextSibling;else{if(o.style.cssText==t.style.cssText&&(domUtils.moveChild(o,t),domUtils.remove(o)),t.nextSibling===o)break;o=t.nextSibling}if(e(t),browser.ie&&browser.version>8){var a=domUtils.findParent(t,function(e){return"SPAN"==e.tagName&&/background-color/.test(e.style.cssText)});a&&!/background-color/.test(t.style.cssText)&&(t.style.backgroundColor=a.style.backgroundColor)}}}),o.moveToBookmark(i),t(o,s,r)}var s=this,r={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family",underline:"text-decoration",strikethrough:"text-decoration",fontborder:"border"},a={underline:1,strikethrough:1,fontborder:1},n={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"};s.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"}],fontsize:[10,11,12,14,16,18,20,24,36]}),s.addInputRule(function(e){utils.each(e.getNodesByTagName("u s del font strike"),function(e){if("font"==e.tagName){var t=[];for(var o in e.attrs)switch(o){case"size":t.push("font-size:"+({1:"10",2:"12",3:"16",4:"18",5:"24",6:"32",7:"48"}[e.attrs[o]]||e.attrs[o])+"px");break;case"color":t.push("color:"+e.attrs[o]);break;case"face":t.push("font-family:"+e.attrs[o]);break;case"style":t.push(e.attrs[o])}e.attrs={style:t.join(";")}}else{var s="u"==e.tagName?"underline":"line-through";e.attrs={style:(e.getAttr("style")||"")+"text-decoration:"+s+";"}}e.tagName="span"})});for(var i in r)!function(e,t){UE.commands[e]={execCommand:function(s,r){r=r||(this.queryCommandState(s)?"none":"underline"==s?"underline":"fontborder"==s?"1px solid #000":"line-through");var n,i=this,l=this.selection.getRange();if("default"==r)l.collapsed&&(n=i.document.createTextNode("font"),l.insertNode(n).select()),i.execCommand("removeFormat","span,a",t),n&&(l.setStartBefore(n).collapse(!0),domUtils.remove(n)),o(l,s,r),l.select();else if(l.collapsed){var d=domUtils.findParentByTagName(l.startContainer,"span",!0);if(n=i.document.createTextNode("font"),!d||d.children.length||d[browser.ie?"innerText":"textContent"].replace(fillCharReg,"").length){if(l.insertNode(n),l.selectNode(n).select(),d=l.document.createElement("span"),a[e]){if(domUtils.findParentByTagName(n,"a",!0))return l.setStartBefore(n).setCursor(),void domUtils.remove(n);i.execCommand("removeFormat","span,a",t)}if(d.style.cssText=t+":"+r,n.parentNode.insertBefore(d,n),!browser.ie||browser.ie&&9==browser.version)for(var m=d.parentNode;!domUtils.isBlockElm(m);)"SPAN"==m.tagName&&(d.style.cssText=m.style.cssText+";"+d.style.cssText),m=m.parentNode;opera?setTimeout(function(){l.setStart(d,0).collapse(!0),o(l,s,r),l.select()}):(l.setStart(d,0).collapse(!0),o(l,s,r),l.select())}else l.insertNode(n),a[e]&&(l.selectNode(n).select(),i.execCommand("removeFormat","span,a",t,null),d=domUtils.findParentByTagName(n,"span",!0),l.setStartBefore(n)),d&&(d.style.cssText+=";"+t+":"+r),l.collapse(!0).select();domUtils.remove(n)}else a[e]&&i.queryCommandValue(e)&&i.execCommand("removeFormat","span,a",t),l=i.selection.getRange(),l.applyInlineStyle("span",{style:t+":"+r}),o(l,s,r),l.select();return!0},queryCommandValue:function(e){var o=this.selection.getStart();if("underline"==e||"strikethrough"==e){for(var s,r=o;r&&!domUtils.isBlockElm(r)&&!domUtils.isBody(r);){if(1==r.nodeType&&(s=domUtils.getComputedStyle(r,t),"none"!=s))return s;r=r.parentNode}return"none"}if("fontborder"==e){for(var a,n=o;n&&dtd.$inline[n.tagName];){if((a=domUtils.getComputedStyle(n,"border"))&&/1px/.test(a)&&/solid/.test(a))return a;n=n.parentNode}return""}if("FontSize"==e){var i=domUtils.getComputedStyle(o,t),n=/^([\d\.]+)(\w+)$/.exec(i);return n?Math.floor(n[1])+n[2]:i}return domUtils.getComputedStyle(o,t)},queryCommandState:function(e){if(!a[e])return 0;var t=this.queryCommandValue(e);return"fontborder"==e?/1px/.test(t)&&/solid/.test(t):"underline"==e?/underline/.test(t):/line\-through/.test(t)}}}(i,r[i])};