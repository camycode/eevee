UE.plugins.table=function(){function e(e){}function t(e,t){n(e,"width",!0),n(e,"height",!0)}function n(e,t,n){e.style[t]&&(n&&e.setAttribute(t,parseInt(e.style[t],10)),e.style[t]="")}function i(e){if("TD"==e.tagName||"TH"==e.tagName)return e;var t;return(t=domUtils.findParentByTagName(e,"td",!0)||domUtils.findParentByTagName(e,"th",!0))?t:null}function o(e){var t=new RegExp(domUtils.fillChar,"g");if(e[browser.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(t,"").length>0)return 0;for(var n in dtd.$isNotEmpty)if(e.getElementsByTagName(n).length)return 0;return 1}function l(e){return e.pageX||e.pageY?{x:e.pageX,y:e.pageY}:{x:e.clientX+M.document.body.scrollLeft-M.document.body.clientLeft,y:e.clientY+M.document.body.scrollTop-M.document.body.clientTop}}function a(t){if(!E())try{var n,o=i(t.target||t.srcElement);if(K&&(M.body.style.webkitUserSelect="none",(Math.abs(z.x-t.clientX)>O||Math.abs(z.y-t.clientY)>O)&&(y(),K=!1,q=0,x(t))),ne&&re)return q=0,M.body.style.webkitUserSelect="none",M.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"](),n=l(t),f(M,!0,ne,n,o),void("h"==ne?ae.style.left=c(re,t)+"px":"v"==ne&&(ae.style.top=u(re,t)+"px"));if(o){if(M.fireEvent("excludetable",o)===!0)return;n=l(t);var a=m(o,n),s=domUtils.findParentByTagName(o,"table",!0);if(d(s,o,t,!0)){if(M.fireEvent("excludetable",s)===!0)return;M.body.style.cursor="url("+M.options.cursorpath+"h.png),pointer"}else if(d(s,o,t)){if(M.fireEvent("excludetable",s)===!0)return;M.body.style.cursor="url("+M.options.cursorpath+"v.png),pointer"}else{M.body.style.cursor="text";/\d/.test(a)&&(a=a.replace(/\d/,""),o=G(o).getPreviewCell(o,"v"==a)),f(M,o?!!a:!1,o?a:"",n,o)}}else r(!1,s,M)}catch(g){e(g)}}function r(e,t,n){if(e)s(t,n);else{if(le)return;ue=setTimeout(function(){!le&&oe&&oe.parentNode&&oe.parentNode.removeChild(oe)},2e3)}}function s(e,t){function n(n,i){clearTimeout(a),a=setTimeout(function(){t.fireEvent("tableClicked",e,i)},300)}function i(n){clearTimeout(a);var i=G(e),o=e.rows[0].cells[0],l=i.getLastCell(),r=i.getCellsRange(o,l);t.selection.getRange().setStart(o,0).setCursor(!1,!0),i.setSelected(r)}var o=domUtils.getXY(e),l=e.ownerDocument;if(oe&&oe.parentNode)return oe;oe=l.createElement("div"),oe.contentEditable=!1,oe.innerHTML="",oe.style.cssText="width:15px;height:15px;background-image:url("+t.options.UEDITOR_HOME_URL+"dialogs/table/dragicon.png);position: absolute;cursor:move;top:"+(o.y-15)+"px;left:"+o.x+"px;",domUtils.unSelectable(oe),oe.onmouseover=function(e){le=!0},oe.onmouseout=function(e){le=!1},domUtils.on(oe,"click",function(e,t){n(t,this)}),domUtils.on(oe,"dblclick",function(e,t){i(t)}),domUtils.on(oe,"dragstart",function(e,t){domUtils.preventDefault(t)});var a;l.body.appendChild(oe)}function d(e,t,n,i){var o=l(n),a=m(t,o);if(i){var r=e.getElementsByTagName("caption")[0],s=r?r.offsetHeight:0;return"v1"==a&&o.y-domUtils.getXY(e).y-s<8}return"h1"==a&&o.x-domUtils.getXY(e).x<8}function c(e,t){var n=G(e);if(n){var i=n.getSameEndPosCells(e,"x")[0],o=n.getSameStartPosXCells(e)[0],a=l(t).x,r=(i?domUtils.getXY(i).x:domUtils.getXY(n.table).x)+20,s=o?domUtils.getXY(o).x+o.offsetWidth-20:M.body.offsetWidth+5||parseInt(domUtils.getComputedStyle(M.body,"width"),10);return r+=V,s-=V,r>a?r:a>s?s:a}}function u(t,n){try{var i=domUtils.getXY(t).y,o=l(n).y;return i>o?i:o}catch(a){e(a)}}function f(t,n,i,o,l){try{t.body.style.cursor="h"==i?"col-resize":"v"==i?"row-resize":"text",browser.ie&&(!i||se||J(t)?W(t):(k(t,t.document),H(i,l))),ie=n}catch(a){e(a)}}function m(e,t){var n=domUtils.getXY(e);return n?n.x+e.offsetWidth-t.x<F?"h":t.x-n.x<F?"h1":n.y+e.offsetHeight-t.y<F?"v":t.y-n.y<F?"v1":"":""}function g(e,t){if(!E())if(z={x:t.clientX,y:t.clientY},2==t.button){var n=J(M),i=!1;if(n){var o=_(M,t);utils.each(n.selectedTds,function(e){e===o&&(i=!0)}),i?(o=n.selectedTds[0],setTimeout(function(){M.selection.getRange().setStart(o,0).setCursor(!1,!0)},0)):(Z(domUtils.getElementsByTagName(M.body,"th td")),n.clearSelected())}}else h(t)}function b(e){q=0,e=e||M.window.event;var t=i(e.target||e.srcElement);if(t){var n;if(n=m(t,l(e))){if(W(M),"h1"==n)if(n="h",d(domUtils.findParentByTagName(t,"table"),t,e))M.execCommand("adaptbywindow");else if(t=G(t).getPreviewCell(t)){var o=M.selection.getRange();o.selectNodeContents(t).setCursor(!0,!0)}if("h"==n){var a=G(t),r=a.table,s=B(t,r,!0);s=p(s,"left"),a.width=a.offsetWidth;var c=[],u=[];utils.each(s,function(e){c.push(e.offsetWidth)}),utils.each(s,function(e){e.removeAttribute("width")}),window.setTimeout(function(){var e=!0;utils.each(s,function(t,n){var i=t.offsetWidth;return i>c[n]?(e=!1,!1):void u.push(i)});var t=e?u:c;utils.each(s,function(e,n){e.width=t[n]-P()})},0)}}}}function h(e){if(Z(domUtils.getElementsByTagName(M.body,"td th")),utils.each(M.document.getElementsByTagName("table"),function(e){e.ueTable=null}),ee=_(M,e)){var t=domUtils.findParentByTagName(ee,"table",!0);ut=G(t),ut&&ut.clearSelected(),ie?v(e):(M.document.body.style.webkitUserSelect="",se=!0,M.addListener("mouseover",C))}}function v(e){browser.ie&&(e=T(e)),y(),K=!0,X=setTimeout(function(){x(e)},$)}function p(e,t){for(var n=[],i=null,o=0,l=e.length;l>o;o++)i=e[o][t],i&&n.push(i);return n}function y(){X&&clearTimeout(X),X=null}function T(e){var t=["pageX","pageY","clientX","clientY","srcElement","target"],n={};if(e)for(var i,o,l=0;i=t[l];l++)o=e[i],o&&(n[i]=o);return n}function x(e){if(K=!1,ee=e.target||e.srcElement){var t=m(ee,l(e));/\d/.test(t)&&(t=t.replace(/\d/,""),ee=G(ee).getPreviewCell(ee,"v"==t)),W(M),k(M,M.document),M.fireEvent("saveScene"),H(t,ee),se=!0,ne=t,re=ee}}function w(e,t){if(!E()){if(y(),K=!1,ie&&(q=++q%3,z={x:t.clientX,y:t.clientY},Y=setTimeout(function(){q>0&&q--},$),2===q))return q=0,void b(t);if(2!=t.button){var n=this,i=n.selection.getRange(),o=domUtils.findParentByTagName(i.startContainer,"table",!0),l=domUtils.findParentByTagName(i.endContainer,"table",!0);if((o||l)&&(o===l?(o=domUtils.findParentByTagName(i.startContainer,["td","th","caption"],!0),l=domUtils.findParentByTagName(i.endContainer,["td","th","caption"],!0),o!==l&&n.selection.clearRange()):n.selection.clearRange()),se=!1,n.document.body.style.webkitUserSelect="",ne&&re&&(n.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"](),q=0,ae=n.document.getElementById("ue_tableDragLine"))){var a=domUtils.getXY(re),r=domUtils.getXY(ae);switch(ne){case"h":N(re,r.x-a.x);break;case"v":S(re,r.y-a.y-re.offsetHeight)}return ne="",re=null,W(n),void n.fireEvent("saveScene")}if(ee){var s=G(ee),d=s?s.selectedTds[0]:null;if(d)i=new dom.Range(n.document),domUtils.isEmptyBlock(d)?i.setStart(d,0).setCursor(!1,!0):i.selectNodeContents(d).shrinkBoundary().setCursor(!1,!0);else if(i=n.selection.getRange().shrinkBoundary(),!i.collapsed){var o=domUtils.findParentByTagName(i.startContainer,["td","th"],!0),l=domUtils.findParentByTagName(i.endContainer,["td","th"],!0);(o&&!l||!o&&l||o&&l&&o!==l)&&i.setCursor(!1,!0)}ee=null,n.removeListener("mouseover",C)}else{var c=domUtils.findParentByTagName(t.target||t.srcElement,"td",!0);if(c||(c=domUtils.findParentByTagName(t.target||t.srcElement,"th",!0)),c&&("TD"==c.tagName||"TH"==c.tagName)){if(n.fireEvent("excludetable",c)===!0)return;i=new dom.Range(n.document),i.setStart(c,0).setCursor(!1,!0)}}n._selectionChange(250,t)}}}function C(e,t){if(!E()){var n=this,i=t.target||t.srcElement;if(te=domUtils.findParentByTagName(i,"td",!0)||domUtils.findParentByTagName(i,"th",!0),ee&&te&&("TD"==ee.tagName&&"TD"==te.tagName||"TH"==ee.tagName&&"TH"==te.tagName)&&domUtils.findParentByTagName(ee,"table")==domUtils.findParentByTagName(te,"table")){var o=G(te);if(ee!=te){n.document.body.style.webkitUserSelect="none",n.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"]();var l=o.getCellsRange(ee,te);o.setSelected(l)}else n.document.body.style.webkitUserSelect="",o.clearSelected()}t.preventDefault?t.preventDefault():t.returnValue=!1}}function U(e,t,n){var i=parseInt(domUtils.getComputedStyle(e,"line-height"),10),o=n+t;t=i>o?i:o,e.style.height&&(e.style.height=""),1==e.rowSpan?e.setAttribute("height",t):e.removeAttribute&&e.removeAttribute("height")}function N(e,t){var n=G(e);if(n){var i=n.table,o=B(e,i);if(i.style.width="",i.removeAttribute("width"),t=A(t,e,o),e.nextSibling){utils.each(o,function(e){e.left.width=+e.left.width+t,e.right&&(e.right.width=+e.right.width-t)})}else utils.each(o,function(e){e.left.width-=-t})}}function E(){return"false"===M.body.contentEditable}function S(e,t){if(!(Math.abs(t)<10)){var n=G(e);if(n)for(var i,o=n.getSameEndPosCells(e,"y"),l=o[0]?o[0].offsetHeight:0,a=0;i=o[a++];)U(i,t,l)}}function B(e,t,n){if(t||(t=domUtils.findParentByTagName(e,"table")),!t)return null;for(var i=(domUtils.getNodeIndex(e),e),o=t.rows,l=0;i;)1===i.nodeType&&(l+=i.colSpan||1),i=i.previousSibling;i=null;var a=[];return utils.each(o,function(e){var t=e.cells,i=0;utils.each(t,function(e){return i+=e.colSpan||1,i===l?(a.push({left:e,right:e.nextSibling||null}),!1):i>l?(n&&a.push({left:e}),!1):void 0})}),a}function A(e,t,n){if(e-=P(),0>e)return 0;e-=L(t);var i=0>e?"left":"right";return e=Math.abs(e),utils.each(n,function(t){var n=t[i];n&&(e=Math.min(e,L(n)-V))}),e=0>e?0:e,"left"===i?-e:e}function L(e){var t=0,t=e.offsetWidth-P();e.nextSibling||(t-=R(e)),t=0>t?0:t;try{e.width=t}catch(n){}return t}function R(e){if(tab=domUtils.findParentByTagName(e,"table",!1),void 0===tab.offsetVal){var t=e.previousSibling;t?tab.offsetVal=e.offsetWidth-t.offsetWidth===j.borderWidth?j.borderWidth:0:tab.offsetVal=0}return tab.offsetVal}function P(){if(void 0===j.tabcellSpace){var e=M.document.createElement("table"),t=M.document.createElement("tbody"),n=M.document.createElement("tr"),i=M.document.createElement("td"),o=null;i.style.cssText="border: 0;",i.width=1,n.appendChild(i),n.appendChild(o=i.cloneNode(!1)),t.appendChild(n),e.appendChild(t),e.style.cssText="visibility: hidden;",M.body.appendChild(e),j.paddingSpace=i.offsetWidth-1;var l=e.offsetWidth;i.style.cssText="",o.style.cssText="",j.borderWidth=(e.offsetWidth-l)/3,j.tabcellSpace=j.paddingSpace+j.borderWidth,M.body.removeChild(e)}return P=function(){return j.tabcellSpace},j.tabcellSpace}function k(e,t){se||(ae=e.document.createElement("div"),domUtils.setAttributes(ae,{id:"ue_tableDragLine",unselectable:"on",contenteditable:!1,onresizestart:"return false",ondragstart:"return false",onselectstart:"return false",style:"background-color:blue;position:absolute;padding:0;margin:0;background-image:none;border:0px none;opacity:0;filter:alpha(opacity=0)"}),e.body.appendChild(ae))}function W(e){if(!se)for(var t;t=e.document.getElementById("ue_tableDragLine");)domUtils.remove(t)}function H(e,t){if(t){var n,i=domUtils.findParentByTagName(t,"table"),o=i.getElementsByTagName("caption"),l=i.offsetWidth,a=i.offsetHeight-(o.length>0?o[0].offsetHeight:0),r=domUtils.getXY(i),s=domUtils.getXY(t);switch(e){case"h":n="height:"+a+"px;top:"+(r.y+(o.length>0?o[0].offsetHeight:0))+"px;left:"+(s.x+t.offsetWidth),ae.style.cssText=n+"px;position: absolute;display:block;background-color:blue;width:1px;border:0; color:blue;opacity:.3;filter:alpha(opacity=30)";break;case"v":n="width:"+l+"px;left:"+r.x+"px;top:"+(s.y+t.offsetHeight),ae.style.cssText=n+"px;overflow:hidden;position: absolute;display:block;background-color:blue;height:1px;border:0;color:blue;opacity:.2;filter:alpha(opacity=20)"}}}function I(e,t){for(var n,i,o=domUtils.getElementsByTagName(e.body,"table"),l=0;i=o[l++];){var a=domUtils.getElementsByTagName(i,"td");a[0]&&(t?(n=a[0].style.borderColor.replace(/\s/g,""),/(#ffffff)|(rgb\(255,255,255\))/gi.test(n)&&domUtils.addClass(i,"noBorderTable")):domUtils.removeClasses(i,"noBorderTable"))}}function D(e,t,n){var i=e.body;return i.offsetWidth-(t?2*parseInt(domUtils.getComputedStyle(i,"margin-left"),10):0)-2*n.tableBorder-(e.options.offsetWidth||0)}function _(e,t){var n=domUtils.findParentByTagName(t.target||t.srcElement,["td","th"],!0),i=null;if(!n)return null;if(i=m(n,l(t)),!n)return null;if("h1"===i&&n.previousSibling){var o=domUtils.getXY(n),a=n.offsetWidth;Math.abs(o.x+a-t.clientX)>a/3&&(n=n.previousSibling)}else if("v1"===i&&n.parentNode.previousSibling){var o=domUtils.getXY(n),r=n.offsetHeight;Math.abs(o.y+r-t.clientY)>r/3&&(n=n.parentNode.previousSibling.firstChild)}return n&&e.fireEvent("excludetable",n)!==!0?n:null}var M=this,X=null,Y=null,V=5,K=!1,F=5,O=10,q=0,z=null,$=360,j=UE.UETable,G=function(e){return j.getUETable(e)},J=function(e){return j.getUETableBySelected(e)},Q=function(e,t){return j.getDefaultValue(e,t)},Z=function(e){return j.removeSelectedClass(e)};M.ready(function(){var e=this,t=e.selection.getText;e.selection.getText=function(){var n=J(e);if(n){var i="";return utils.each(n.selectedTds,function(e){i+=e[browser.ie?"innerText":"textContent"]}),i}return t.call(e.selection)}});var ee=null,te=null,ne="",ie=!1,oe=null,le=!1,ae=null,re=null,se=!1,de=!0;M.setOpt({maxColNum:20,maxRowNum:100,defaultCols:5,defaultRows:5,tdvalign:"top",cursorpath:M.options.UEDITOR_HOME_URL+"themes/default/images/cursor_",tableDragable:!1,classList:["ue-table-interlace-color-single","ue-table-interlace-color-double"]}),M.getUETable=G;var ce={deletetable:1,inserttable:1,cellvalign:1,insertcaption:1,deletecaption:1,inserttitle:1,deletetitle:1,mergeright:1,mergedown:1,mergecells:1,insertrow:1,insertrownext:1,deleterow:1,insertcol:1,insertcolnext:1,deletecol:1,splittocells:1,splittorows:1,splittocols:1,adaptbytext:1,adaptbywindow:1,adaptbycustomer:1,insertparagraph:1,insertparagraphbeforetable:1,averagedistributecol:1,averagedistributerow:1};M.ready(function(){utils.cssRule("table",".selectTdClass{background-color:#edf5fa !important}table.noBorderTable td,table.noBorderTable th,table.noBorderTable caption{border:1px dashed #ddd !important}table{margin-bottom:10px;border-collapse:collapse;display:table;}td,th{padding: 5px 10px;border: 1px solid #DDD;}caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}th{border-top:1px solid #BBB;background-color:#F7F7F7;}table tr.firstRow th{border-top-width:2px;}.ue-table-interlace-color-single{ background-color: #fcfcfc; } .ue-table-interlace-color-double{ background-color: #f7faff; }td p{margin:0;padding:0;}",M.document);var e,n,l;M.addListener("keydown",function(t,i){var a=this,r=i.keyCode||i.which;if(8==r){var s=J(a);s&&s.selectedTds.length&&(s.isFullCol()?a.execCommand("deletecol"):s.isFullRow()?a.execCommand("deleterow"):a.fireEvent("delcells"),domUtils.preventDefault(i));var d=domUtils.findParentByTagName(a.selection.getStart(),"caption",!0),c=a.selection.getRange();if(c.collapsed&&d&&o(d)){a.fireEvent("saveScene");var u=d.parentNode;domUtils.remove(d),u&&c.setStart(u.rows[0].cells[0],0).setCursor(!1,!0),a.fireEvent("saveScene")}}if(46==r&&(s=J(a))){a.fireEvent("saveScene");for(var f,m=0;f=s.selectedTds[m++];)domUtils.fillNode(a.document,f);a.fireEvent("saveScene"),domUtils.preventDefault(i)}if(13==r){var g=a.selection.getRange(),d=domUtils.findParentByTagName(g.startContainer,"caption",!0);if(d){var u=domUtils.findParentByTagName(d,"table");return g.collapsed?d&&g.setStart(u.rows[0].cells[0],0).setCursor(!1,!0):(g.deleteContents(),a.fireEvent("saveScene")),void domUtils.preventDefault(i)}if(g.collapsed){var u=domUtils.findParentByTagName(g.startContainer,"table");if(u){var b=u.rows[0].cells[0],h=domUtils.findParentByTagName(a.selection.getStart(),["td","th"],!0),v=u.previousSibling;if(b===h&&(!v||1==v.nodeType&&"TABLE"==v.tagName)&&domUtils.isStartInblock(g)){var p=domUtils.findParent(a.selection.getStart(),function(e){return domUtils.isBlockElm(e)},!0);p&&(/t(h|d)/i.test(p.tagName)||p===h.firstChild)&&(a.execCommand("insertparagraphbeforetable"),domUtils.preventDefault(i))}}}}if((i.ctrlKey||i.metaKey)&&"67"==i.keyCode){e=null;var s=J(a);if(s){var y=s.selectedTds;n=s.isFullCol(),l=s.isFullRow(),e=[[s.cloneCell(y[0],null,!0)]];for(var f,m=1;f=y[m];m++)f.parentNode!==y[m-1].parentNode?e.push([s.cloneCell(f,null,!0)]):e[e.length-1].push(s.cloneCell(f,null,!0))}}}),M.addListener("tablehasdeleted",function(){f(this,!1,"",null),oe&&domUtils.remove(oe)}),M.addListener("beforepaste",function(i,a){var r=this,s=r.selection.getRange();if(domUtils.findParentByTagName(s.startContainer,"caption",!0)){var d=r.document.createElement("div");return d.innerHTML=a.html,void(a.html=d[browser.ie9below?"innerText":"textContent"])}var c=J(r);if(e){r.fireEvent("saveScene");var u,f,s=r.selection.getRange(),m=domUtils.findParentByTagName(s.startContainer,["td","th"],!0);if(m){var g=G(m);if(l){var b=g.getCellInfo(m).rowIndex;"TH"==m.tagName&&b++;for(var h,v=0;h=e[v++];){for(var p,y=g.insertRow(b++,"td"),T=0;p=h[T];T++){var x=y.cells[T];x||(x=y.insertCell(T)),x.innerHTML=p.innerHTML,p.getAttribute("width")&&x.setAttribute("width",p.getAttribute("width")),p.getAttribute("vAlign")&&x.setAttribute("vAlign",p.getAttribute("vAlign")),p.getAttribute("align")&&x.setAttribute("align",p.getAttribute("align")),p.style.cssText&&(x.style.cssText=p.style.cssText)}for(var p,T=0;(p=y.cells[T])&&h[T];T++)p.innerHTML=h[T].innerHTML,h[T].getAttribute("width")&&p.setAttribute("width",h[T].getAttribute("width")),h[T].getAttribute("vAlign")&&p.setAttribute("vAlign",h[T].getAttribute("vAlign")),h[T].getAttribute("align")&&p.setAttribute("align",h[T].getAttribute("align")),h[T].style.cssText&&(p.style.cssText=h[T].style.cssText)}}else{if(n){U=g.getCellInfo(m);for(var p,w=0,T=0,h=e[0];p=h[T++];)w+=p.colSpan||1;for(r.__hasEnterExecCommand=!0,v=0;w>v;v++)r.execCommand("insertcol");r.__hasEnterExecCommand=!1,m=g.table.rows[0].cells[U.cellIndex],"TH"==m.tagName&&(m=g.table.rows[1].cells[U.cellIndex])}for(var h,v=0;h=e[v++];){u=m;for(var p,T=0;p=h[T++];)if(m)m.innerHTML=p.innerHTML,p.getAttribute("width")&&m.setAttribute("width",p.getAttribute("width")),p.getAttribute("vAlign")&&m.setAttribute("vAlign",p.getAttribute("vAlign")),p.getAttribute("align")&&m.setAttribute("align",p.getAttribute("align")),p.style.cssText&&(m.style.cssText=p.style.cssText),f=m,m=m.nextSibling;else{var C=p.cloneNode(!0);domUtils.removeAttributes(C,["class","rowSpan","colSpan"]),f.parentNode.appendChild(C)}if(m=g.getNextCell(u,!0,!0),!e[v])break;if(!m){var U=g.getCellInfo(u);g.table.insertRow(g.table.rows.length),g.update(),m=g.getVSideCell(u,!0)}}}g.update()}else{c=r.document.createElement("table");for(var h,v=0;h=e[v++];){for(var p,y=c.insertRow(c.rows.length),T=0;p=h[T++];)C=j.cloneCell(p,null,!0),domUtils.removeAttributes(C,["class"]),y.appendChild(C);2==T&&C.rowSpan>1&&(C.rowSpan=1)}var N=Q(r),E=r.body.offsetWidth-(de?2*parseInt(domUtils.getComputedStyle(r.body,"margin-left"),10):0)-2*N.tableBorder-(r.options.offsetWidth||0);r.execCommand("insertHTML","<table  "+(n&&l?'width="'+E+'"':"")+">"+c.innerHTML.replace(/>\s*</g,"><").replace(/\bth\b/gi,"td")+"</table>")}return r.fireEvent("contentchange"),r.fireEvent("saveScene"),a.html="",!0}var S,d=r.document.createElement("div");d.innerHTML=a.html,S=d.getElementsByTagName("table"),domUtils.findParentByTagName(r.selection.getStart(),"table")?(utils.each(S,function(e){domUtils.remove(e)}),domUtils.findParentByTagName(r.selection.getStart(),"caption",!0)&&(d.innerHTML=d[browser.ie?"innerText":"textContent"])):utils.each(S,function(e){t(e,!0),domUtils.removeAttributes(e,["style","border"]),utils.each(domUtils.getElementsByTagName(e,"td"),function(e){o(e)&&domUtils.fillNode(r.document,e),t(e,!0)})}),a.html=d.innerHTML}),M.addListener("afterpaste",function(){utils.each(domUtils.getElementsByTagName(M.body,"table"),function(e){if(e.offsetWidth>M.body.offsetWidth){var t=Q(M,e);e.style.width=M.body.offsetWidth-(de?2*parseInt(domUtils.getComputedStyle(M.body,"margin-left"),10):0)-2*t.tableBorder-(M.options.offsetWidth||0)+"px"}})}),M.addListener("blur",function(){e=null});var s;M.addListener("keydown",function(){clearTimeout(s),s=setTimeout(function(){var e=M.selection.getRange(),t=domUtils.findParentByTagName(e.startContainer,["th","td"],!0);if(t){var n=t.parentNode.parentNode.parentNode;n.offsetWidth>n.getAttribute("width")&&(t.style.wordBreak="break-all")}},100)}),M.addListener("selectionchange",function(){f(M,!1,"",null)}),M.addListener("contentchange",function(){var e=this;if(W(e),!J(e)){var t=e.selection.getRange(),n=t.startContainer;n=domUtils.findParentByTagName(n,["td","th"],!0),utils.each(domUtils.getElementsByTagName(e.document,"table"),function(t){e.fireEvent("excludetable",t)!==!0&&(t.ueTable=new j(t),t.onmouseover=function(){e.fireEvent("tablemouseover",t)},t.onmousemove=function(){e.fireEvent("tablemousemove",t),e.options.tableDragable&&r(!0,this,e),utils.defer(function(){e.fireEvent("contentchange",50)},!0)},t.onmouseout=function(){e.fireEvent("tablemouseout",t),f(e,!1,"",null),W(e)},t.onclick=function(t){t=e.window.event||t;var n=i(t.target||t.srcElement);if(n){var o,l=G(n),a=l.table,r=l.getCellInfo(n),s=e.selection.getRange();if(d(a,n,t,!0)){var c=l.getCell(l.indexTable[l.rowsNum-1][r.colIndex].rowIndex,l.indexTable[l.rowsNum-1][r.colIndex].cellIndex);return void(t.shiftKey&&l.selectedTds.length?l.selectedTds[0]!==c?(o=l.getCellsRange(l.selectedTds[0],c),l.setSelected(o)):s&&s.selectNodeContents(c).select():n!==c?(o=l.getCellsRange(n,c),l.setSelected(o)):s&&s.selectNodeContents(c).select())}if(d(a,n,t)){var u=l.getCell(l.indexTable[r.rowIndex][l.colsNum-1].rowIndex,l.indexTable[r.rowIndex][l.colsNum-1].cellIndex);t.shiftKey&&l.selectedTds.length?l.selectedTds[0]!==u?(o=l.getCellsRange(l.selectedTds[0],u),l.setSelected(o)):s&&s.selectNodeContents(u).select():n!==u?(o=l.getCellsRange(n,u),l.setSelected(o)):s&&s.selectNodeContents(u).select()}}})}),I(e,!0)}}),domUtils.on(M.document,"mousemove",a),domUtils.on(M.document,"mouseout",function(e){var t=e.target||e.srcElement;"TABLE"==t.tagName&&f(M,!1,"",null)}),M.addListener("interlacetable",function(e,t,n){if(t)for(var i=this,o=t.rows,l=o.length,a=function(e,t,n){return e[t]?e[t]:n?e[t%e.length]:""},r=0;l>r;r++)o[r].className=a(n||i.options.classList,r,!0)}),M.addListener("uninterlacetable",function(e,t){if(t)for(var n=this,i=t.rows,o=n.options.classList,l=i.length,a=0;l>a;a++)domUtils.removeClasses(i[a],o)}),M.addListener("mousedown",g),M.addListener("mouseup",w),domUtils.on(M.body,"dragstart",function(e){w.call(M,"dragstart",e)}),M.addOutputRule(function(e){utils.each(e.getNodesByTagName("div"),function(e){"ue_tableDragLine"==e.getAttr("id")&&e.parentNode.removeChild(e)})});var c=0;M.addListener("mousedown",function(){c=0}),M.addListener("tabkeydown",function(){var e=this.selection.getRange(),t=e.getCommonAncestor(!0,!0),n=domUtils.findParentByTagName(t,"table");if(n){if(domUtils.findParentByTagName(t,"caption",!0)){var i=domUtils.getElementsByTagName(n,"th td");i&&i.length&&e.setStart(i[0],0).setCursor(!1,!0)}else{var i=domUtils.findParentByTagName(t,["td","th"],!0),l=G(i);c=i.rowSpan>1?c:l.getCellInfo(i).rowIndex;var a=l.getTabNextCell(i,c);a?o(a)?e.setStart(a,0).setCursor(!1,!0):e.selectNodeContents(a).select():(M.fireEvent("saveScene"),M.__hasEnterExecCommand=!0,this.execCommand("insertrownext"),M.__hasEnterExecCommand=!1,e=this.selection.getRange(),e.setStart(n.rows[n.rows.length-1].cells[0],0).setCursor(),M.fireEvent("saveScene"))}return!0}}),browser.ie&&M.addListener("selectionchange",function(){f(this,!1,"",null)}),M.addListener("keydown",function(e,t){var n=this,i=t.keyCode||t.which;if(8!=i&&46!=i){var o=!(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey);o&&Z(domUtils.getElementsByTagName(n.body,"td"));var l=J(n);l&&o&&l.clearSelected()}}),M.addListener("beforegetcontent",function(){I(this,!1),browser.ie&&utils.each(this.document.getElementsByTagName("caption"),function(e){domUtils.isEmptyNode(e)&&(e.innerHTML="&nbsp;")})}),M.addListener("aftergetcontent",function(){I(this,!0)}),M.addListener("getAllHtml",function(){Z(M.document.getElementsByTagName("td"))}),M.addListener("fullscreenchanged",function(e,t){if(!t){var n=this.body.offsetWidth/document.body.offsetWidth,i=domUtils.getElementsByTagName(this.body,"table");utils.each(i,function(e){if(e.offsetWidth<M.body.offsetWidth)return!1;var t=domUtils.getElementsByTagName(e,"td"),i=[];utils.each(t,function(e){i.push(e.offsetWidth)});for(var o,l=0;o=t[l];l++)o.setAttribute("width",Math.floor(i[l]*n));e.setAttribute("width",Math.floor(D(M,de,Q(M))))})}});var u=M.execCommand;M.execCommand=function(e,t){var n=this;arguments;e=e.toLowerCase();var i,l,a=J(n),r=new dom.Range(n.document),s=n.commands[e]||UE.commands[e];if(s){if(!a||ce[e]||s.notNeedUndo||n.__hasEnterExecCommand)l=u.apply(n,arguments);else{n.__hasEnterExecCommand=!0,n.fireEvent("beforeexeccommand",e),i=a.selectedTds;for(var d,c,f,m=-2,g=-2,b=0;f=i[b];b++)o(f)?r.setStart(f,0).setCursor(!1,!0):r.selectNode(f).select(!0),c=n.queryCommandState(e),d=n.queryCommandValue(e),-1!=c&&((m!==c||g!==d)&&(n._ignoreContentChange=!0,l=u.apply(n,arguments),n._ignoreContentChange=!1),m=n.queryCommandState(e),g=n.queryCommandValue(e),domUtils.isEmptyBlock(f)&&domUtils.fillNode(n.document,f));r.setStart(i[0],0).shrinkBoundary(!0).setCursor(!1,!0),n.fireEvent("contentchange"),n.fireEvent("afterexeccommand",e),n.__hasEnterExecCommand=!1,n._selectionChange()}return l}}});var ue};