!function(){var e={textarea:function(e,t){var r=t.ownerDocument.createElement("textarea");return r.style.cssText="position:absolute;resize:none;width:100%;height:100%;border:0;padding:0;margin:0;overflow-y:auto;",browser.ie&&browser.version<8&&(r.style.width=t.offsetWidth+"px",r.style.height=t.offsetHeight+"px",t.onresize=function(){r.style.width=t.offsetWidth+"px",r.style.height=t.offsetHeight+"px"}),t.appendChild(r),{setContent:function(e){r.value=e},getContent:function(){return r.value},select:function(){var e;browser.ie?(e=r.createTextRange(),e.collapse(!0),e.select()):(r.setSelectionRange(0,0),r.focus())},dispose:function(){t.removeChild(r),t.onresize=null,r=null,t=null}}},codemirror:function(e,t){var r=window.CodeMirror(t,{mode:"text/html",tabMode:"indent",lineNumbers:!0,lineWrapping:!0}),o=r.getWrapperElement();return o.style.cssText='position:absolute;left:0;top:0;width:100%;height:100%;font-family:consolas,"Courier new",monospace;font-size:13px;',r.getScrollerElement().style.cssText="position:absolute;left:0;top:0;width:100%;height:100%;",r.refresh(),{getCodeMirror:function(){return r},setContent:function(e){r.setValue(e)},getContent:function(){return r.getValue()},select:function(){r.focus()},dispose:function(){t.removeChild(o),o=null,r=null}}}};UE.plugins.source=function(){function t(t){return e["codemirror"==i.sourceEditor&&window.CodeMirror?"codemirror":"textarea"](n,t)}var r,o,n=this,i=this.options,s=!1;i.sourceEditor=browser.ie?"textarea":i.sourceEditor||"codemirror",n.setOpt({sourceEditorFirst:!1});var c,a,l;n.commands.source={execCommand:function(){if(s=!s){l=n.selection.getRange().createAddress(!1,!0),n.undoManger&&n.undoManger.save(!0),browser.gecko&&(n.body.contentEditable=!1),c=n.iframe.style.cssText,n.iframe.style.cssText+="position:absolute;left:-32768px;top:-32768px;",n.fireEvent("beforegetcontent");var e=UE.htmlparser(n.body.innerHTML);n.filterOutputRule(e),e.traversal(function(e){if("element"==e.type)switch(e.tagName){case"td":case"th":case"caption":e.children&&1==e.children.length&&"br"==e.firstChild().tagName&&e.removeChild(e.firstChild());break;case"pre":e.innerText(e.innerText().replace(/&nbsp;/g," "))}}),n.fireEvent("aftergetcontent");var i=e.toHtml(!0);r=t(n.iframe.parentNode),r.setContent(i),o=n.setContent,n.setContent=function(e){var t=UE.htmlparser(e);n.filterInputRule(t),e=t.toHtml(),r.setContent(e)},setTimeout(function(){r.select(),n.addListener("fullscreenchanged",function(){try{r.getCodeMirror().refresh()}catch(e){}})}),a=n.getContent,n.getContent=function(){return r.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>"}}else{n.iframe.style.cssText=c;var d=r.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";d=d.replace(new RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(e,t){return t&&!dtd.$inlineWithA[t.toLowerCase()]?e.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,""):e.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")}),n.setContent=o,n.setContent(d),r.dispose(),r=null,n.getContent=a;var u=n.body.firstChild;if(u||(n.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",u=n.body.firstChild),n.undoManger&&n.undoManger.save(!0),browser.gecko){var f=document.createElement("input");f.style.cssText="position:absolute;left:0;top:-32768px",document.body.appendChild(f),n.body.contentEditable=!1,setTimeout(function(){domUtils.setViewportOffset(f,{left:-32768,top:0}),f.focus(),setTimeout(function(){n.body.contentEditable=!0,n.selection.getRange().moveToAddress(l).select(!0),domUtils.remove(f)})})}else try{n.selection.getRange().moveToAddress(l).select(!0)}catch(p){}}this.fireEvent("sourcemodechanged",s)},queryCommandState:function(){return 0|s},notNeedUndo:1};var d=n.queryCommandState;n.queryCommandState=function(e){return e=e.toLowerCase(),s?e in{source:1,fullscreen:1}?1:-1:d.apply(this,arguments)},"codemirror"==i.sourceEditor&&n.addListener("ready",function(){utils.loadFile(document,{src:i.codeMirrorJsUrl||i.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.js",tag:"script",type:"text/javascript",defer:"defer"},function(){i.sourceEditorFirst&&setTimeout(function(){n.execCommand("source")},0)}),utils.loadFile(document,{tag:"link",rel:"stylesheet",type:"text/css",href:i.codeMirrorCssUrl||i.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.css"})})}}();