!function(){function e(e){this.initOptions(e),this.initEditorUI()}var t=baidu.editor.utils,i=baidu.editor.ui.uiUtils,o=baidu.editor.ui.UIBase,n=baidu.editor.dom.domUtils,a=[];e.prototype={uiName:"editor",initEditorUI:function(){function e(e,t){e.setOpt({wordCount:!0,maximumWords:1e4,wordCountMsg:e.options.wordCountMsg||e.getLang("wordCountMsg"),wordOverFlowMsg:e.options.wordOverFlowMsg||e.getLang("wordOverFlowMsg")});var i=e.options,o=i.maximumWords,n=i.wordCountMsg,a=i.wordOverFlowMsg,s=t.getDom("wordcount");if(i.wordCount){var l=e.getContentLength(!0);l>o?(s.innerHTML=a,e.fireEvent("wordcountoverflow")):s.innerHTML=n.replace("{#leave}",o-l).replace("{#count}",l)}}this.editor.ui=this,this._dialogs={},this.initUIBase(),this._initToolbars();var t=this.editor,i=this;t.addListener("ready",function(){function o(){e(t,i),n.un(t.document,"click",arguments.callee)}t.getDialog=function(e){return t.ui._dialogs[e+"Dialog"]},n.on(t.window,"scroll",function(e){baidu.editor.ui.Popup.postHide(e)}),t.ui._actualFrameWidth=t.options.initialFrameWidth,UE.browser.ie&&6===UE.browser.version&&t.container.ownerDocument.execCommand("BackgroundImageCache",!1,!0),t.options.elementPathEnabled&&(t.ui.getDom("elementpath").innerHTML='<div class="edui-editor-breadcrumb">'+t.getLang("elementPathTip")+":</div>"),t.options.wordCount&&(n.on(t.document,"click",o),t.ui.getDom("wordcount").innerHTML=t.getLang("wordCountTip")),t.ui._scale(),t.options.scaleEnabled?(t.autoHeightEnabled&&t.disableAutoHeight(),i.enableScale()):i.disableScale(),t.options.elementPathEnabled||t.options.wordCount||t.options.scaleEnabled||(t.ui.getDom("elementpath").style.display="none",t.ui.getDom("wordcount").style.display="none",t.ui.getDom("scale").style.display="none"),t.selection.isFocus()&&t.fireEvent("selectionchange",!1,!0)}),t.addListener("mousedown",function(e,t){var i=t.target||t.srcElement;baidu.editor.ui.Popup.postHide(t,i),baidu.editor.ui.ShortCutMenu.postHide(t)}),t.addListener("delcells",function(){UE.ui.edittip&&new UE.ui.edittip(t),t.getDialog("edittip").open()});var o,a,s=!1;t.addListener("afterpaste",function(){t.queryCommandState("pasteplain")||(baidu.editor.ui.PastePicker&&(o=new baidu.editor.ui.Popup({content:new baidu.editor.ui.PastePicker({editor:t}),editor:t,className:"edui-wordpastepop"}),o.render()),s=!0)}),t.addListener("afterinserthtml",function(){clearTimeout(a),a=setTimeout(function(){if(o&&(s||t.ui._isTransfer)){if(o.isHidden()){var e=n.createElement(t.document,"span",{style:"line-height:0px;",innerHTML:"\ufeff"}),i=t.selection.getRange();i.insertNode(e);var a=getDomNode(e,"firstChild","previousSibling");a&&o.showAnchor(3==a.nodeType?a.parentNode:a),n.remove(e)}else o.show();delete t.ui._isTransfer,s=!1}},200)}),t.addListener("contextmenu",function(e,t){baidu.editor.ui.Popup.postHide(t)}),t.addListener("keydown",function(e,t){o&&o.dispose(t);var i=t.keyCode||t.which;t.altKey&&90==i&&UE.ui.buttons.fullscreen.onclick()}),t.addListener("wordcount",function(t){e(this,i)}),t.addListener("selectionchange",function(){t.options.elementPathEnabled&&i[(-1==t.queryCommandState("elementpath")?"dis":"en")+"ableElementPath"](),t.options.scaleEnabled&&i[(-1==t.queryCommandState("scale")?"dis":"en")+"ableScale"]()});var l=new baidu.editor.ui.Popup({editor:t,content:"",className:"edui-bubble",_onEditButtonClick:function(){this.hide(),t.ui._dialogs.linkDialog.open()},_onImgEditButtonClick:function(e){this.hide(),t.ui._dialogs[e]&&t.ui._dialogs[e].open()},_onImgSetFloat:function(e){this.hide(),t.execCommand("imagefloat",e)},_setIframeAlign:function(e){var t=l.anchorEl,i=t.cloneNode(!0);switch(e){case-2:i.setAttribute("align","");break;case-1:i.setAttribute("align","left");break;case 1:i.setAttribute("align","right")}t.parentNode.insertBefore(i,t),n.remove(t),l.anchorEl=i,l.showAnchor(l.anchorEl)},_updateIframe:function(){var e=t._iframe=l.anchorEl;n.hasClass(e,"ueditor_baidumap")?(t.selection.getRange().selectNode(e).select(),t.ui._dialogs.mapDialog.open(),l.hide()):(t.ui._dialogs.insertframeDialog.open(),l.hide())},_onRemoveButtonClick:function(e){t.execCommand(e),this.hide()},queryAutoHide:function(e){return e&&e.ownerDocument==t.document&&("img"==e.tagName.toLowerCase()||n.findParentByTagName(e,"a",!0))?e!==l.anchorEl:baidu.editor.ui.Popup.prototype.queryAutoHide.call(this,e)}});l.render(),t.options.imagePopup&&(t.addListener("mouseover",function(e,i){i=i||window.event;var o=i.target||i.srcElement;if(t.ui._dialogs.insertframeDialog&&/iframe/gi.test(o.tagName)){var n=l.formatHtml("<nobr>"+t.getLang("property")+': <span onclick=$$._setIframeAlign(-2) class="edui-clickable">'+t.getLang("default")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(-1) class="edui-clickable">'+t.getLang("justifyleft")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(1) class="edui-clickable">'+t.getLang("justifyright")+'</span>&nbsp;&nbsp; <span onclick="$$._updateIframe( this);" class="edui-clickable">'+t.getLang("modify")+"</span></nobr>");n?(l.getDom("content").innerHTML=n,l.anchorEl=o,l.showAnchor(l.anchorEl)):l.hide()}}),t.addListener("selectionchange",function(e,i){if(i){var o="",a="",s=t.selection.getRange().getClosedNode(),r=t.ui._dialogs;if(s&&"IMG"==s.tagName){var d="insertimageDialog";if((-1!=s.className.indexOf("edui-faked-video")||-1!=s.className.indexOf("edui-upload-video"))&&(d="insertvideoDialog"),-1!=s.className.indexOf("edui-faked-webapp")&&(d="webappDialog"),-1!=s.src.indexOf("http://api.map.baidu.com")&&(d="mapDialog"),-1!=s.className.indexOf("edui-faked-music")&&(d="musicDialog"),-1!=s.src.indexOf("http://maps.google.com/maps/api/staticmap")&&(d="gmapDialog"),s.getAttribute("anchorname")&&(d="anchorDialog",o=l.formatHtml("<nobr>"+t.getLang("property")+': <span onclick=$$._onImgEditButtonClick("anchorDialog") class="edui-clickable">'+t.getLang("modify")+"</span>&nbsp;&nbsp;<span onclick=$$._onRemoveButtonClick('anchor') class=\"edui-clickable\">"+t.getLang("delete")+"</span></nobr>")),s.getAttribute("word_img")&&(t.word_img=[s.getAttribute("word_img")],d="wordimageDialog"),(n.hasClass(s,"loadingclass")||n.hasClass(s,"loaderrorclass"))&&(d=""),!r[d])return;a="<nobr>"+t.getLang("property")+': <span onclick=$$._onImgSetFloat("none") class="edui-clickable">'+t.getLang("default")+'</span>&nbsp;&nbsp;<span onclick=$$._onImgSetFloat("left") class="edui-clickable">'+t.getLang("justifyleft")+'</span>&nbsp;&nbsp;<span onclick=$$._onImgSetFloat("right") class="edui-clickable">'+t.getLang("justifyright")+'</span>&nbsp;&nbsp;<span onclick=$$._onImgSetFloat("center") class="edui-clickable">'+t.getLang("justifycenter")+"</span>&nbsp;&nbsp;<span onclick=\"$$._onImgEditButtonClick('"+d+'\');" class="edui-clickable">'+t.getLang("modify")+"</span></nobr>",!o&&(o=l.formatHtml(a))}if(t.ui._dialogs.linkDialog){var c,u=t.queryCommandValue("link");if(u&&(c=u.getAttribute("_href")||u.getAttribute("href",2))){var m=c;c.length>30&&(m=c.substring(0,20)+"..."),o&&(o+='<div style="height:5px;"></div>'),o+=l.formatHtml("<nobr>"+t.getLang("anthorMsg")+': <a target="_blank" href="'+c+'" title="'+c+'" >'+m+'</a> <span class="edui-clickable" onclick="$$._onEditButtonClick();">'+t.getLang("modify")+'</span> <span class="edui-clickable" onclick="$$._onRemoveButtonClick(\'unlink\');"> '+t.getLang("clear")+"</span></nobr>"),l.showAnchor(u)}}o?(l.getDom("content").innerHTML=o,l.anchorEl=s||u,l.showAnchor(l.anchorEl)):l.hide()}}))},_initToolbars:function(){for(var e=this.editor,i=this.toolbars||[],o=[],n=0;n<i.length;n++){for(var a=i[n],s=new baidu.editor.ui.Toolbar({theme:e.options.theme}),l=0;l<a.length;l++){var r=a[l],d=null;if("string"==typeof r){if(r=r.toLowerCase(),"|"==r&&(r="Separator"),"||"==r&&(r="Breakline"),baidu.editor.ui[r]&&(d=new baidu.editor.ui[r](e)),"fullscreen"==r){o&&o[0]?o[0].items.splice(0,0,d):d&&s.items.splice(0,0,d);continue}}else d=r;d&&d.id&&s.add(d)}o[n]=s}t.each(UE._customizeUI,function(t,i){var o,n;return t.id&&t.id!=e.key?!1:(o=t.execFn.call(e,e,i),void(o&&(n=t.index,void 0===n&&(n=s.items.length),s.add(o,n))))}),this.toolbars=o},getHtmlTpl:function(){return'<div id="##" class="%%"><div id="##_toolbarbox" class="%%-toolbarbox">'+(this.toolbars.length?'<div id="##_toolbarboxouter" class="%%-toolbarboxouter"><div class="%%-toolbarboxinner">'+this.renderToolbarBoxHtml()+"</div></div>":"")+'<div id="##_toolbarmsg" class="%%-toolbarmsg" style="display:none;"><div id = "##_upload_dialog" class="%%-toolbarmsg-upload" onclick="$$.showWordImageDialog();">'+this.editor.getLang("clickToUpload")+'</div><div class="%%-toolbarmsg-close" onclick="$$.hideToolbarMsg();">x</div><div id="##_toolbarmsg_label" class="%%-toolbarmsg-label"></div><div style="height:0;overflow:hidden;clear:both;"></div></div><div id="##_message_holder" class="%%-messageholder"></div></div><div id="##_iframeholder" class="%%-iframeholder"></div><div id="##_bottombar" class="%%-bottomContainer"><table><tr><td id="##_elementpath" class="%%-bottombar"></td><td id="##_wordcount" class="%%-wordcount"></td><td id="##_scale" class="%%-scale"><div class="%%-icon"></div></td></tr></table></div><div id="##_scalelayer"></div></div>'},showWordImageDialog:function(){this._dialogs.wordimageDialog.open()},renderToolbarBoxHtml:function(){for(var e=[],t=0;t<this.toolbars.length;t++)e.push(this.toolbars[t].renderHtml());return e.join("")},setFullScreen:function(e){var t=this.editor,i=t.container.parentNode.parentNode;if(this._fullscreen!=e){if(this._fullscreen=e,this.editor.fireEvent("beforefullscreenchange",e),baidu.editor.browser.gecko)var o=t.selection.getRange().createBookmark();if(e){for(;"BODY"!=i.tagName;){var n=baidu.editor.dom.domUtils.getComputedStyle(i,"position");a.push(n),i.style.position="static",i=i.parentNode}this._bakHtmlOverflow=document.documentElement.style.overflow,this._bakBodyOverflow=document.body.style.overflow,this._bakAutoHeight=this.editor.autoHeightEnabled,this._bakScrollTop=Math.max(document.documentElement.scrollTop,document.body.scrollTop),this._bakEditorContaninerWidth=t.iframe.parentNode.offsetWidth,this._bakAutoHeight&&(t.autoHeightEnabled=!1,this.editor.disableAutoHeight()),document.documentElement.style.overflow="hidden",window.scrollTo(0,window.scrollY),this._bakCssText=this.getDom().style.cssText,this._bakCssText1=this.getDom("iframeholder").style.cssText,t.iframe.parentNode.style.width="",this._updateFullScreen()}else{for(;"BODY"!=i.tagName;)i.style.position=a.shift(),i=i.parentNode;this.getDom().style.cssText=this._bakCssText,this.getDom("iframeholder").style.cssText=this._bakCssText1,this._bakAutoHeight&&(t.autoHeightEnabled=!0,this.editor.enableAutoHeight()),document.documentElement.style.overflow=this._bakHtmlOverflow,document.body.style.overflow=this._bakBodyOverflow,t.iframe.parentNode.style.width=this._bakEditorContaninerWidth+"px",window.scrollTo(0,this._bakScrollTop)}if(browser.gecko&&"true"===t.body.contentEditable){var s=document.createElement("input");document.body.appendChild(s),t.body.contentEditable=!1,setTimeout(function(){s.focus(),setTimeout(function(){t.body.contentEditable=!0,t.fireEvent("fullscreenchanged",e),t.selection.getRange().moveToBookmark(o).select(!0),baidu.editor.dom.domUtils.remove(s),e&&window.scroll(0,0)},0)},0)}"true"===t.body.contentEditable&&(this.editor.fireEvent("fullscreenchanged",e),this.triggerLayout())}},_updateFullScreen:function(){if(this._fullscreen){var e=i.getViewportRect();if(this.getDom().style.cssText="border:0;position:absolute;left:0;top:"+(this.editor.options.topOffset||0)+"px;width:"+e.width+"px;height:"+e.height+"px;z-index:"+(1*this.getDom().style.zIndex+100),i.setViewportOffset(this.getDom(),{left:0,top:this.editor.options.topOffset||0}),this.editor.setHeight(e.height-this.getDom("toolbarbox").offsetHeight-this.getDom("bottombar").offsetHeight-(this.editor.options.topOffset||0),!0),browser.gecko)try{window.onresize()}catch(t){}}},_updateElementPath:function(){var e,t=this.getDom("elementpath");if(this.elementPathEnabled&&(e=this.editor.queryCommandValue("elementpath"))){for(var i,o=[],n=0;i=e[n];n++)o[n]=this.formatHtml('<span unselectable="on" onclick="$$.editor.execCommand(&quot;elementpath&quot;, &quot;'+n+'&quot;);">'+i+"</span>");t.innerHTML='<div class="edui-editor-breadcrumb" onmousedown="return false;">'+this.editor.getLang("elementPathTip")+": "+o.join(" &gt; ")+"</div>"}else t.style.display="none"},disableElementPath:function(){var e=this.getDom("elementpath");e.innerHTML="",e.style.display="none",this.elementPathEnabled=!1},enableElementPath:function(){var e=this.getDom("elementpath");e.style.display="",this.elementPathEnabled=!0,this._updateElementPath()},_scale:function(){function e(){g=n.getXY(l),p||(p=s.options.minFrameHeight+d.offsetHeight+c.offsetHeight),m.style.cssText="position:absolute;left:0;display:;top:0;background-color:#41ABFF;opacity:0.4;filter: Alpha(opacity=40);width:"+l.offsetWidth+"px;height:"+l.offsetHeight+"px;z-index:"+(s.options.zIndex+1),n.on(a,"mousemove",t),n.on(r,"mouseup",i),n.on(a,"mouseup",i)}function t(e){o();var t=e||window.event;b=t.pageX||a.documentElement.scrollLeft+t.clientX,y=t.pageY||a.documentElement.scrollTop+t.clientY,v=b-g.x,w=y-g.y,v>=f&&(h=!0,m.style.width=v+"px"),w>=p&&(h=!0,m.style.height=w+"px")}function i(){h&&(h=!1,s.ui._actualFrameWidth=m.offsetWidth-2,l.style.width=s.ui._actualFrameWidth+"px",s.setHeight(m.offsetHeight-c.offsetHeight-d.offsetHeight-2,!0)),m&&(m.style.display="none"),o(),n.un(a,"mousemove",t),n.un(r,"mouseup",i),n.un(a,"mouseup",i)}function o(){browser.ie?a.selection.clear():window.getSelection().removeAllRanges()}var a=document,s=this.editor,l=s.container,r=s.document,d=this.getDom("toolbarbox"),c=this.getDom("bottombar"),u=this.getDom("scale"),m=this.getDom("scalelayer"),h=!1,g=null,p=0,f=s.options.minFrameWidth,b=0,y=0,v=0,w=0,_=this;this.editor.addListener("fullscreenchanged",function(e,t){if(t)_.disableScale();else if(_.editor.options.scaleEnabled){_.enableScale();var i=_.editor.document.createElement("span");_.editor.body.appendChild(i),_.editor.body.style.height=Math.max(n.getXY(i).y,_.editor.iframe.offsetHeight-20)+"px",n.remove(i)}}),this.enableScale=function(){1!=s.queryCommandState("source")&&(u.style.display="",this.scaleEnabled=!0,n.on(u,"mousedown",e))},this.disableScale=function(){u.style.display="none",this.scaleEnabled=!1,n.un(u,"mousedown",e)}},isFullScreen:function(){return this._fullscreen},postRender:function(){o.prototype.postRender.call(this);for(var e=0;e<this.toolbars.length;e++)this.toolbars[e].postRender();var t,i=this,n=baidu.editor.dom.domUtils,a=function(){clearTimeout(t),t=setTimeout(function(){i._updateFullScreen()})};n.on(window,"resize",a),i.addListener("destroy",function(){n.un(window,"resize",a),clearTimeout(t)})},showToolbarMsg:function(e,t){if(this.getDom("toolbarmsg_label").innerHTML=e,this.getDom("toolbarmsg").style.display="",!t){var i=this.getDom("upload_dialog");i.style.display="none"}},hideToolbarMsg:function(){this.getDom("toolbarmsg").style.display="none"},mapUrl:function(e){return e?e.replace("~/",this.editor.options.UEDITOR_HOME_URL||""):""},triggerLayout:function(){var e=this.getDom();"1"==e.style.zoom?e.style.zoom="100%":e.style.zoom="1"}},t.inherits(e,baidu.editor.ui.UIBase);var s={};UE.ui.Editor=function(i){var o=new UE.Editor(i);o.options.editor=o,t.loadFile(document,{href:o.options.themePath+o.options.theme+"/_css/ueditor.css",tag:"link",type:"text/css",rel:"stylesheet"});var a=o.render;return o.render=function(i){i.constructor===String&&(o.key=i,s[i]=o),t.domReady(function(){function t(){if(o.setOpt({labelMap:o.options.labelMap||o.getLang("labelMap")}),new e(o.options),i&&(i.constructor===String&&(i=document.getElementById(i)),i&&i.getAttribute("name")&&(o.options.textarea=i.getAttribute("name")),i&&/script|textarea/gi.test(i.tagName))){var t=document.createElement("div");i.parentNode.insertBefore(t,i);var s=i.value||i.innerHTML;o.options.initialContent=/^[\t\r\n ]*$/.test(s)?o.options.initialContent:s.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><"),i.className&&(t.className=i.className),i.style.cssText&&(t.style.cssText=i.style.cssText),/textarea/i.test(i.tagName)?(o.textarea=i,o.textarea.style.display="none"):i.parentNode.removeChild(i),i.id&&(t.id=i.id,n.removeAttributes(i,"id")),i=t,i.innerHTML=""}n.addClass(i,"edui-"+o.options.theme),o.ui.render(i);var l=o.options;o.container=o.ui.getDom();for(var r,d=n.findParents(i,!0),c=[],u=0;r=d[u];u++)c[u]=r.style.display,r.style.display="block";if(l.initialFrameWidth)l.minFrameWidth=l.initialFrameWidth;else{l.minFrameWidth=l.initialFrameWidth=i.offsetWidth;var m=i.style.width;/%$/.test(m)&&(l.initialFrameWidth=m)}l.initialFrameHeight?l.minFrameHeight=l.initialFrameHeight:l.initialFrameHeight=l.minFrameHeight=i.offsetHeight;for(var r,u=0;r=d[u];u++)r.style.display=c[u];i.style.height&&(i.style.height=""),o.container.style.width=l.initialFrameWidth+(/%$/.test(l.initialFrameWidth)?"":"px"),o.container.style.zIndex=l.zIndex,a.call(o,o.ui.getDom("iframeholder")),o.fireEvent("afteruiready")}o.langIsReady?t():o.addListener("langReady",t)})},o},UE.getEditor=function(e,t){var i=s[e];return i||(i=s[e]=new UE.ui.Editor(t),i.render(e)),i},UE.delEditor=function(e){var t;(t=s[e])&&(t.key&&t.destroy(),delete s[e])},UE.registerUI=function(e,i,o,n){t.each(e.split(/\s+/),function(e){UE._customizeUI[e]={id:n,execFn:i,index:o}})}}();