!function(){function t(t,e,i){return t.push(f),e+(i?1:-1)}function e(t,e){for(var i=0;e>i;i++)t.push(u)}function i(l,a,s,d){switch(l.type){case"root":for(var c,o=0;c=l.children[o++];)s&&"element"==c.type&&!dtd.$inlineWithA[c.tagName]&&o>1&&(t(a,d,!0),e(a,d)),i(c,a,s,d);break;case"text":r(l,a);break;case"element":n(l,a,s,d);break;case"comment":h(l,a,s)}return a}function r(t,e){"pre"==t.parentNode.tagName?e.push(t.data):e.push(o[t.parentNode.tagName]?utils.html(t.data):t.data.replace(/[ ]{2}/g," &nbsp;"))}function n(r,n,h,l){var a="";if(r.attrs){a=[];var s=r.attrs;for(var d in s)a.push(d+(void 0!==s[d]?'="'+(c[d]?utils.html(s[d]).replace(/["]/g,function(t){return"&quot;"}):utils.unhtml(s[d]))+'"':""));a=a.join(" ")}if(n.push("<"+r.tagName+(a?" "+a:"")+(dtd.$empty[r.tagName]?"/":"")+">"),h&&!dtd.$inlineWithA[r.tagName]&&"pre"!=r.tagName&&r.children&&r.children.length&&(l=t(n,l,!0),e(n,l)),r.children&&r.children.length)for(var o,u=0;o=r.children[u++];)h&&"element"==o.type&&!dtd.$inlineWithA[o.tagName]&&u>1&&(t(n,l),e(n,l)),i(o,n,h,l);dtd.$empty[r.tagName]||(h&&!dtd.$inlineWithA[r.tagName]&&"pre"!=r.tagName&&r.children&&r.children.length&&(l=t(n,l),e(n,l)),n.push("</"+r.tagName+">"))}function h(t,e){e.push("<!--"+t.data+"-->")}function l(t,e){var i;if("element"==t.type&&t.getAttr("id")==e)return t;if(t.children&&t.children.length)for(var r,n=0;r=t.children[n++];)if(i=l(r,e))return i}function a(t,e,i){if("element"==t.type&&t.tagName==e&&i.push(t),t.children&&t.children.length)for(var r,n=0;r=t.children[n++];)a(r,e,i)}function s(t,e){if(t.children&&t.children.length)for(var i,r=0;i=t.children[r];)s(i,e),i.parentNode&&(i.children&&i.children.length&&e(i),i.parentNode&&r++);else e(t)}var d=UE.uNode=function(t){this.type=t.type,this.data=t.data,this.tagName=t.tagName,this.parentNode=t.parentNode,this.attrs=t.attrs||{},this.children=t.children},c={href:1,src:1,_src:1,_href:1,cdata_data:1},o={style:1,script:1},u="    ",f="\n";d.createElement=function(t){return/[<>]/.test(t)?UE.htmlparser(t).children[0]:new d({type:"element",children:[],tagName:t})},d.createText=function(t,e){return new UE.uNode({type:"text",data:e?t:utils.unhtml(t||"")})},d.prototype={toHtml:function(t){var e=[];return i(this,e,t,0),e.join("")},innerHTML:function(t){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(utils.isString(t)){if(this.children)for(var e,i=0;e=this.children[i++];)e.parentNode=null;this.children=[];for(var e,r=UE.htmlparser(t),i=0;e=r.children[i++];)this.children.push(e),e.parentNode=this;return this}var r=new UE.uNode({type:"root",children:this.children});return r.toHtml()},innerText:function(t,e){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(t){if(this.children)for(var i,r=0;i=this.children[r++];)i.parentNode=null;return this.children=[],this.appendChild(d.createText(t,e)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return"element"==this.type?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){for(var t,e=this.parentNode,i=0;t=e.children[i];i++)if(t===this)return 0==i?null:e.children[i-1]},nextSibling:function(){for(var t,e=this.parentNode,i=0;t=e.children[i++];)if(t===this)return e.children[i]},replaceChild:function(t,e){if(this.children){t.parentNode&&t.parentNode.removeChild(t);for(var i,r=0;i=this.children[r];r++)if(i===e)return this.children.splice(r,1,t),e.parentNode=null,t.parentNode=this,t}},appendChild:function(t){if("root"==this.type||"element"==this.type&&!dtd.$empty[this.tagName]){this.children||(this.children=[]),t.parentNode&&t.parentNode.removeChild(t);for(var e,i=0;e=this.children[i];i++)if(e===t){this.children.splice(i,1);break}return this.children.push(t),t.parentNode=this,t}},insertBefore:function(t,e){if(this.children){t.parentNode&&t.parentNode.removeChild(t);for(var i,r=0;i=this.children[r];r++)if(i===e)return this.children.splice(r,0,t),t.parentNode=this,t}},insertAfter:function(t,e){if(this.children){t.parentNode&&t.parentNode.removeChild(t);for(var i,r=0;i=this.children[r];r++)if(i===e)return this.children.splice(r+1,0,t),t.parentNode=this,t}},removeChild:function(t,e){if(this.children)for(var i,r=0;i=this.children[r];r++)if(i===t){if(this.children.splice(r,1),i.parentNode=null,e&&i.children&&i.children.length)for(var n,h=0;n=i.children[h];h++)this.children.splice(r+h,0,n),n.parentNode=this;return i}},getAttr:function(t){return this.attrs&&this.attrs[t.toLowerCase()]},setAttr:function(t,e){if(!t)return void delete this.attrs;if(this.attrs||(this.attrs={}),utils.isObject(t))for(var i in t)t[i]?this.attrs[i.toLowerCase()]=t[i]:delete this.attrs[i];else e?this.attrs[t.toLowerCase()]=e:delete this.attrs[t]},getIndex:function(){for(var t,e=this.parentNode,i=0;t=e.children[i];i++)if(t===this)return i;return-1},getNodeById:function(t){var e;if(this.children&&this.children.length)for(var i,r=0;i=this.children[r++];)if(e=l(i,t))return e},getNodesByTagName:function(t){t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");var e=[],i=this;return utils.each(t,function(t){if(i.children&&i.children.length)for(var r,n=0;r=i.children[n++];)a(r,t,e)}),e},getStyle:function(t){var e=this.getAttr("style");if(!e)return"";var i=new RegExp("(^|;)\\s*"+t+":([^;]+)","i"),r=e.match(i);return r&&r[0]?r[2]:""},setStyle:function(t,e){function i(t,e){var i=new RegExp("(^|;)\\s*"+t+":([^;]+;?)","gi");r=r.replace(i,"$1"),e&&(r=t+":"+utils.unhtml(e)+";"+r)}var r=this.getAttr("style");if(r||(r=""),utils.isObject(t))for(var n in t)i(n,t[n]);else i(t,e);this.setAttr("style",utils.trim(r))},traversal:function(t){return this.children&&this.children.length&&s(this,t),this}}}();