UE.commands.inserthtml={execCommand:function(e,t,i){var l,o,s=this;if(t&&s.fireEvent("beforeinserthtml",t)!==!0){if(l=s.selection.getRange(),o=l.document.createElement("div"),o.style.display="inline",!i){var r=UE.htmlparser(t);s.options.filterRules&&UE.filterNode(r,s.options.filterRules),s.filterInputRule(r),t=r.toHtml()}if(o.innerHTML=utils.trim(t),!l.collapsed){var n=l.startContainer;if(domUtils.isFillChar(n)&&l.setStartBefore(n),n=l.endContainer,domUtils.isFillChar(n)&&l.setEndAfter(n),l.txtToElmBoundary(),l.endContainer&&1==l.endContainer.nodeType&&(n=l.endContainer.childNodes[l.endOffset],n&&domUtils.isBr(n)&&l.setEndAfter(n)),0==l.startOffset&&(n=l.startContainer,domUtils.isBoundaryNode(n,"firstChild")&&(n=l.endContainer,l.endOffset==(3==n.nodeType?n.nodeValue.length:n.childNodes.length)&&domUtils.isBoundaryNode(n,"lastChild")&&(s.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",l.setStart(s.body.firstChild,0).collapse(!0)))),!l.collapsed&&l.deleteContents(),1==l.startContainer.nodeType){var d,a=l.startContainer.childNodes[l.startOffset];if(a&&domUtils.isBlockElm(a)&&(d=a.previousSibling)&&domUtils.isBlockElm(d)){for(l.setEnd(d,d.childNodes.length).collapse();a.firstChild;)d.appendChild(a.firstChild);domUtils.remove(a)}}}var a,m,d,f,c,h=0;l.inFillChar()&&(a=l.startContainer,domUtils.isFillChar(a)?(l.setStartBefore(a).collapse(!0),domUtils.remove(a)):domUtils.isFillChar(a,!0)&&(a.nodeValue=a.nodeValue.replace(fillCharReg,""),l.startOffset--,l.collapsed&&l.collapse(!0)));var p=domUtils.findParentByTagName(l.startContainer,"li",!0);if(p){for(var C,U;a=o.firstChild;){for(;a&&(3==a.nodeType||!domUtils.isBlockElm(a)||"HR"==a.tagName);)C=a.nextSibling,l.insertNode(a).collapse(),U=a,a=C;if(a)if(/^(ol|ul)$/i.test(a.tagName)){for(;a.firstChild;)U=a.firstChild,domUtils.insertAfter(p,a.firstChild),p=p.nextSibling;domUtils.remove(a)}else{var g;C=a.nextSibling,g=s.document.createElement("li"),domUtils.insertAfter(p,g),g.appendChild(a),U=a,a=C,p=g}}p=domUtils.findParentByTagName(l.startContainer,"li",!0),domUtils.isEmptyBlock(p)&&domUtils.remove(p),U&&l.setStartAfter(U).collapse(!0).select(!0)}else{for(;a=o.firstChild;){if(h){for(var E=s.document.createElement("p");a&&(3==a.nodeType||!dtd.$block[a.tagName]);)c=a.nextSibling,E.appendChild(a),a=c;E.firstChild&&(a=E)}if(l.insertNode(a),c=a.nextSibling,!h&&a.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(a)&&(m=domUtils.findParent(a,function(e){return domUtils.isBlockElm(e)}),m&&"body"!=m.tagName.toLowerCase()&&(!dtd[m.tagName][a.nodeName]||a.parentNode!==m))){if(dtd[m.tagName][a.nodeName])for(f=a.parentNode;f!==m;)d=f,f=f.parentNode;else d=m;domUtils.breakParent(a,d||f);var d=a.previousSibling;domUtils.trimWhiteTextNode(d),d.childNodes.length||domUtils.remove(d),!browser.ie&&(C=a.nextSibling)&&domUtils.isBlockElm(C)&&C.lastChild&&!domUtils.isBr(C.lastChild)&&C.appendChild(s.document.createElement("br")),h=1}var C=a.nextSibling;if(!o.firstChild&&C&&domUtils.isBlockElm(C)){l.setStart(C,0).collapse(!0);break}l.setEndAfter(a).collapse()}if(a=l.startContainer,c&&domUtils.isBr(c)&&domUtils.remove(c),domUtils.isBlockElm(a)&&domUtils.isEmptyNode(a))if(c=a.nextSibling)domUtils.remove(a),1==c.nodeType&&dtd.$block[c.tagName]&&l.setStart(c,0).collapse(!0).shrinkBoundary();else try{a.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(N){l.setStartBefore(a),domUtils.remove(a)}try{l.select(!0)}catch(N){}}setTimeout(function(){l=s.selection.getRange(),l.scrollToView(s.autoHeightEnabled,s.autoHeightEnabled?domUtils.getXY(s.iframe).y:0),s.fireEvent("afterinserthtml",t)},200)}}};